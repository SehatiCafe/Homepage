(()=>{var e={470:function(e,t,i){var n;n=function(){function e(e){function t(t){var i=e.match(t);return i&&i.length>1&&i[1]||""}var i,n,o,s=t(/(ipod|iphone|ipad)/i).toLowerCase(),r=!/like android/i.test(e)&&/android/i.test(e),a=/nexus\s*[0-6]\s*/i.test(e),l=!a&&/nexus\s*[0-9]+/i.test(e),d=/CrOS/.test(e),c=/silk/i.test(e),u=/sailfish/i.test(e),h=/tizen/i.test(e),p=/(web|hpw)os/i.test(e),g=/windows phone/i.test(e),m=(/SamsungBrowser/i.test(e),!g&&/windows/i.test(e)),f=!s&&!c&&/macintosh/i.test(e),v=!r&&!u&&!h&&!p&&/linux/i.test(e),$=t(/edge\/(\d+(\.\d+)?)/i),b=t(/version\/(\d+(\.\d+)?)/i),y=/tablet/i.test(e)&&!/tablet pc/i.test(e),S=!y&&/[^-]mobi/i.test(e),w=/xbox/i.test(e);/opera/i.test(e)?i={name:"Opera",opera:!0,version:b||t(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(e)?i={name:"Opera",opera:!0,version:t(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||b}:/SamsungBrowser/i.test(e)?i={name:"Samsung Internet for Android",samsungBrowser:!0,version:b||t(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(e)?i={name:"Opera Coast",coast:!0,version:b||t(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(e)?i={name:"Yandex Browser",yandexbrowser:!0,version:b||t(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(e)?i={name:"UC Browser",ucbrowser:!0,version:t(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(e)?i={name:"Maxthon",maxthon:!0,version:t(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(e)?i={name:"Epiphany",epiphany:!0,version:t(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(e)?i={name:"Puffin",puffin:!0,version:t(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(e)?i={name:"Sleipnir",sleipnir:!0,version:t(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(e)?i={name:"K-Meleon",kMeleon:!0,version:t(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:g?(i={name:"Windows Phone",windowsphone:!0},$?(i.msedge=!0,i.version=$):(i.msie=!0,i.version=t(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(e)?i={name:"Internet Explorer",msie:!0,version:t(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:d?i={name:"Chrome",chromeos:!0,chromeBook:!0,chrome:!0,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(e)?i={name:"Microsoft Edge",msedge:!0,version:$}:/vivaldi/i.test(e)?i={name:"Vivaldi",vivaldi:!0,version:t(/vivaldi\/(\d+(\.\d+)?)/i)||b}:u?i={name:"Sailfish",sailfish:!0,version:t(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?i={name:"SeaMonkey",seamonkey:!0,version:t(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(e)?(i={name:"Firefox",firefox:!0,version:t(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(i.firefoxos=!0)):c?i={name:"Amazon Silk",silk:!0,version:t(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(e)?i={name:"PhantomJS",phantom:!0,version:t(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(e)?i={name:"SlimerJS",slimer:!0,version:t(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?i={name:"BlackBerry",blackberry:!0,version:b||t(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:p?(i={name:"WebOS",webos:!0,version:b||t(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(i.touchpad=!0)):/bada/i.test(e)?i={name:"Bada",bada:!0,version:t(/dolfin\/(\d+(\.\d+)?)/i)}:h?i={name:"Tizen",tizen:!0,version:t(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||b}:/qupzilla/i.test(e)?i={name:"QupZilla",qupzilla:!0,version:t(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||b}:/chromium/i.test(e)?i={name:"Chromium",chromium:!0,version:t(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||b}:/chrome|crios|crmo/i.test(e)?i={name:"Chrome",chrome:!0,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:r?i={name:"Android",version:b}:/safari|applewebkit/i.test(e)?(i={name:"Safari",safari:!0},b&&(i.version=b)):s?(i={name:"iphone"==s?"iPhone":"ipad"==s?"iPad":"iPod"},b&&(i.version=b)):i=/googlebot/i.test(e)?{name:"Googlebot",googlebot:!0,version:t(/googlebot\/(\d+(\.\d+))/i)||b}:{name:t(/^(.*)\/(.*) /),version:(n=/^(.*)\/(.*) /,(o=e.match(n))&&o.length>1&&o[2]||"")},!i.msedge&&/(apple)?webkit/i.test(e)?(/(apple)?webkit\/537\.36/i.test(e)?(i.name=i.name||"Blink",i.blink=!0):(i.name=i.name||"Webkit",i.webkit=!0),!i.version&&b&&(i.version=b)):!i.opera&&/gecko\//i.test(e)&&(i.name=i.name||"Gecko",i.gecko=!0,i.version=i.version||t(/gecko\/(\d+(\.\d+)?)/i)),i.windowsphone||i.msedge||!r&&!i.silk?i.windowsphone||i.msedge||!s?f?i.mac=!0:w?i.xbox=!0:m?i.windows=!0:v&&(i.linux=!0):(i[s]=!0,i.ios=!0):i.android=!0;var I="";i.windows?I=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(t(/Windows ((NT|XP)( \d\d?.\d)?)/i)):i.windowsphone?I=t(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):i.mac?I=(I=t(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):s?I=(I=t(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):r?I=t(/android[ \/-](\d+(\.\d+)*)/i):i.webos?I=t(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):i.blackberry?I=t(/rim\stablet\sos\s(\d+(\.\d+)*)/i):i.bada?I=t(/bada\/(\d+(\.\d+)*)/i):i.tizen&&(I=t(/tizen[\/\s](\d+(\.\d+)*)/i)),I&&(i.osversion=I);var C=!i.windows&&I.split(".")[0];return y||l||"ipad"==s||r&&(3==C||C>=4&&!S)||i.silk?i.tablet=!0:(S||"iphone"==s||"ipod"==s||r||a||i.blackberry||i.webos||i.bada)&&(i.mobile=!0),i.msedge||i.msie&&i.version>=10||i.yandexbrowser&&i.version>=15||i.vivaldi&&i.version>=1||i.chrome&&i.version>=20||i.samsungBrowser&&i.version>=4||i.firefox&&i.version>=20||i.safari&&i.version>=6||i.opera&&i.version>=10||i.ios&&i.osversion&&i.osversion.split(".")[0]>=6||i.blackberry&&i.version>=10.1||i.chromium&&i.version>=20?i.a=!0:i.msie&&i.version<10||i.chrome&&i.version<20||i.firefox&&i.version<20||i.safari&&i.version<6||i.opera&&i.version<10||i.ios&&i.osversion&&i.osversion.split(".")[0]<6||i.chromium&&i.version<20?i.c=!0:i.x=!0,i}var t=e("undefined"!=typeof navigator&&navigator.userAgent||"");function i(e){return e.split(".").length}function n(e,t){var i,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(i=0;i<e.length;i++)n.push(t(e[i]));return n}function o(e){for(var t=Math.max(i(e[0]),i(e[1])),o=n(e,function(e){var o=t-i(e);return n((e+=Array(o+1).join(".0")).split("."),function(e){return Array(20-e.length).join("0")+e}).reverse()});--t>=0;){if(o[0][t]>o[1][t])return 1;if(o[0][t]!==o[1][t])return -1;if(0===t)return 0}}function s(i,n,s){var r=t;"string"==typeof n&&(s=n,n=void 0),void 0===n&&(n=!1),s&&(r=e(s));var a=""+r.version;for(var l in i)if(i.hasOwnProperty(l)&&r[l]){if("string"!=typeof i[l])throw Error("Browser version in the minVersion map should be a string: "+l+": "+String(i));return 0>o([a,i[l]])}return n}return t.test=function(e){for(var i=0;i<e.length;++i){var n=e[i];if("string"==typeof n&&n in t)return!0}return!1},t.isUnsupportedBrowser=s,t.compareVersions=o,t.check=function(e,t,i){return!s(e,t,i)},t._detect=e,t},e.exports?e.exports=n():i.amdD("bowser",n)},365(e){e.exports=function(e,n,o){"function"==typeof n&&(o=n,n={}),n||(n={});var s,r,a=n.prefix||"__jp",l=n.name||a+t++,d=n.param||"callback",c=null!=n.timeout?n.timeout:6e4,u=encodeURIComponent,h=document.getElementsByTagName("script")[0]||document.head;function p(){s.parentNode&&s.parentNode.removeChild(s),window[l]=i,r&&clearTimeout(r)}return c&&(r=setTimeout(function(){p(),o&&o(Error("Timeout"))},c)),window[l]=function(e){p(),o&&o(null,e)},e=(e+=(~e.indexOf("?")?"&":"?")+d+"="+u(l)).replace("?&","?"),(s=document.createElement("script")).src=e,h.parentNode.insertBefore(s,h),function(){window[l]&&p()}};var t=0;function i(){}},894(e,t,i){"use strict";var n,o;i.d(t,{Q:()=>n}),(o=n||(n={})).Identity="identity",o.Properties="properties",o.PushSubscriptions="pushSubscriptions",o.EmailSubscriptions="emailSubscriptions",o.SmsSubscriptions="smsSubscriptions"},608(e,t,i){"use strict";i.d(t,{Z:()=>iB});var n,o,s,r,a,l,d,c,u,h,p,g,m,f,v,$,b,y,S,w=i(655),I=i(470),C=i.n(I);(S=y||(y={})).Safari="safari",S.Firefox="firefox",S.Chrome="chrome",S.Opera="opera",S.Edge="edge",S.Other="other";var E=i(50),P=i(450);class O{static getEnvironmentInfo(){return{browserType:this.getBrowser(),browserVersion:this.getBrowserVersion(),isBrowserAndSupportsServiceWorkers:this.supportsServiceWorkers(),requiresUserInteraction:this.requiresUserInteraction(),osVersion:this.getOsVersion()}}static getBrowser(){return"chrome"===(0,P.M)().name?y.Chrome:"msedge"===(0,P.M)().name?y.Edge:"opera"===(0,P.M)().name?y.Opera:"firefox"===(0,P.M)().name?y.Firefox:this.isMacOSSafari()?y.Safari:y.Other}static isMacOSSafari(){return void 0!==window.safari}static getBrowserVersion(){return E.Z.parseVersionString((0,P.M)().version)}static supportsServiceWorkers(){return window.navigator&&"serviceWorker"in window.navigator}static requiresUserInteraction(){return"firefox"===this.getBrowser()&&this.getBrowserVersion()>=72||"safari"===this.getBrowser()&&this.getBrowserVersion()>=12.1}static getOsVersion(){return C().osversion}}var T,k,x=i(365),N=i.n(x),A=i(326),_=i(468);(k=T||(T={})).ChromePush="ChromePush",k.SafariPush="SafariPush",k.SafariLegacyPush="SafariLegacyPush",k.FirefoxPush="FirefoxPush",k.Email="Email",k.SMS="SMS";var M,D,Z=i(271);(D=M||(M={}))[D.NoNativePermission=0]="NoNativePermission",D[D.Subscribed=1]="Subscribed",D[D.UserOptedOut=-2]="UserOptedOut",D[D.NotSubscribed=-10]="NotSubscribed",D[D.TemporaryWebRecord=-20]="TemporaryWebRecord",D[D.PermissionRevoked=-21]="PermissionRevoked",D[D.PushSubscriptionRevoked=-22]="PushSubscriptionRevoked",D[D.ServiceWorkerStatus403=-23]="ServiceWorkerStatus403",D[D.ServiceWorkerStatus404=-24]="ServiceWorkerStatus404";var U,G,B=i(930);(G=U||(U={}))[G.ChromeLike=5]="ChromeLike",G[G.SafariLegacy=7]="SafariLegacy",G[G.Firefox=8]="Firefox",G[G.Email=11]="Email",G[G.Edge=12]="Edge",G[G.SMS=14]="SMS",G[G.SafariVapid=17]="SafariVapid";class F{constructor(e){let t=O.getEnvironmentInfo();this.token=this._getToken(e),this.type=F.getSubscriptionType(),this.notificationTypes=M.Subscribed,this.sdk=String(160200),this.deviceModel=navigator.platform,this.deviceOs=isNaN(t.browserVersion)?-1:t.browserVersion,this.webAuth=e.w3cAuth,this.webp256=e.w3cP256dh}_getToken(e){return e.w3cEndpoint?e.w3cEndpoint.toString():e.safariDeviceToken}serialize(){return{type:this.type,token:this.token,enabled:this.enabled,notification_types:this.notificationTypes,sdk:this.sdk,device_model:this.deviceModel,device_os:this.deviceOs,web_auth:this.webAuth,web_p256:this.webp256}}static getSubscriptionType(){return Z.Z.redetectBrowserUserAgent().firefox?T.FirefoxPush:B.Z.useSafariVapidPush()?T.SafariPush:B.Z.useSafariLegacyPush()?T.SafariLegacyPush:T.ChromePush}static getDeviceType(){switch(this.getSubscriptionType()){case T.FirefoxPush:return U.Firefox;case T.SafariLegacyPush:return U.SafariLegacy;case T.SafariPush:return U.SafariVapid}return U.ChromeLike}}class L{constructor(e,t){this.label=e,this.id=t}}L.ONESIGNAL_ID="onesignal_id",L.EXTERNAL_ID="external_id";var W,V,R=i(752);(V=W||(W={}))[V.MissingAppId=0]="MissingAppId",V[V.RetryLimitReached=1]="RetryLimitReached";class H extends R.Z{constructor(e){let t;switch(e){case W.MissingAppId:t="The API call is missing an app ID.";break;case W.RetryLimitReached:t="The API call has reached the retry limit."}super(t),Object.setPrototypeOf(this,H.prototype)}}var Q=i(107);function q(e){return new Promise(t=>setTimeout(t,e))}var j=i(353);let K={5:1e4,4:2e4,3:3e4,2:3e4,1:3e4};class z{static get(e,t,i){return z.call("GET",e,t,i)}static post(e,t,i){return z.call("POST",e,t,i)}static put(e,t,i){return z.call("PUT",e,t,i)}static delete(e,t,i){return z.call("DELETE",e,t,i)}static patch(e,t,i){return z.call("PATCH",e,t,i)}static call(e,t,i,n){if(!this.requestHasAppId(t,i))return Promise.reject(new H(W.MissingAppId));let o=new Headers;if(o.append("Origin",A.Z.getOrigin()),o.append("SDK-Version",`onesignal/web/${B.Z.version()}`),o.append("Content-Type","application/json;charset=UTF-8"),n)for(let s of Object.keys(n))o.append(s,n[s]);let r={method:e||"NO_METHOD_SPECIFIED",headers:o,cache:"no-cache"};i&&(r.body=JSON.stringify(i));let a=`${A.Z.getOneSignalApiUrl(void 0,t).toString()}/${t}`;return z.executeFetch(a,r)}static executeFetch(e,t,i=5){return(0,w.mG)(this,void 0,void 0,function*(){if(0===i)return Promise.reject(new H(W.RetryLimitReached));try{let n=yield fetch(e,t),{status:o}=n;return{result:yield n.json(),status:o}}catch(s){if("TypeError"===s.name)return yield q(K[i]),Q.Z.error(`OneSignal: Network timed out while calling ${e}. Retrying...`),z.executeFetch(e,t,i-1);throw new R.Z(`OneSignalApiBase: failed to execute HTTP call: ${s}`)}})}static requestHasAppId(e,t){if(e.startsWith("apps/")){let i=e.split("/");return(0,j.TP)(i[1])}return!(!t||"string"!=typeof t.app_id)&&(0,j.TP)(t.app_id)}}let J=z;function Y(e){return encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)}(ef=eI||(eI={}))[ef.InvalidAppId=0]="InvalidAppId",ef[ef.AppNotConfiguredForWebPush=1]="AppNotConfiguredForWebPush",ef[ef.WrongSiteUrl=2]="WrongSiteUrl",ef[ef.MultipleInitialization=3]="MultipleInitialization",ef[ef.MissingSafariWebId=4]="MissingSafariWebId",ef[ef.Unknown=5]="Unknown";class X extends R.Z{constructor(e,t){let i;switch(e){case eI.InvalidAppId:i="OneSignal: This app ID does not match any existing app. Double check your app ID.";break;case eI.AppNotConfiguredForWebPush:i="OneSignal: This app ID does not have any web platforms enabled. Double check your app ID, or see step 1 on our setup guide (https://tinyurl.com/2x5jzk83).";break;case eI.WrongSiteUrl:i=t&&t.siteUrl?`OneSignal: This web push config can only be used on ${new URL(t.siteUrl).origin}. Your current origin is ${location.origin}.`:"OneSignal: This web push config can not be used on the current site.";break;case eI.MultipleInitialization:i="OneSignal: The OneSignal web SDK can only be initialized once. Extra initializations are ignored. Please remove calls initializing the SDK more than once.";break;case eI.MissingSafariWebId:i="OneSignal: Safari browser support on Mac OS X requires the Safari web platform to be enabled. Please see the Safari Support steps in our web setup guide.";break;case eI.Unknown:i="OneSignal: An unknown initialization error occurred."}super(i),this.reason=eI[e],Object.setPrototypeOf(this,X.prototype)}}class ee{static createUser(e,t){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:i,subscriptionId:n}=e,o=n?{"OneSignal-Subscription-Id":n}:void 0,s={};return o&&(s=Object.assign(Object.assign({},s),o)),e.jwtHeader&&(s=Object.assign(Object.assign({},s),e.jwtHeader)),t.refresh_device_metadata=!0,J.post(`apps/${i}/users`,t,s)})}static getUser(e,t){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:i}=e;return J.get(`apps/${i}/users/by/${t.label}/${t.id}`,e.jwtHeader)})}static updateUser(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:n,subscriptionId:o}=e;if(!Z.Z.isValidUuid(n))throw new X(eI.InvalidAppId);let s=o?{"OneSignal-Subscription-Id":o}:void 0,r={};s&&(r=Object.assign(Object.assign({},r),s)),e.jwtHeader&&(r=Object.assign(Object.assign({},r),e.jwtHeader));let a=Y(t.label),l=Y(t.id);return J.patch(`apps/${n}/users/by/${a}/${l}`,i,r)})}static deleteUser(e,t){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:i}=e;return J.delete(`apps/${i}/users/by/${t.label}/${t.id}`,e.jwtHeader)})}static addAlias(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:n}=e;return J.patch(`apps/${n}/users/by/${t.label}/${t.id}/identity`,{identity:i},e.jwtHeader)})}static getUserIdentity(e,t){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:i}=e;return J.get(`apps/${i}/users/by/${t.label}/${t.id}/identity`,e.jwtHeader)})}static deleteAlias(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:n}=e;return J.delete(`apps/${n}/users/by/${t.label}/${t.id}/identity/${i}`,e.jwtHeader)})}static createSubscription(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:n}=e;return J.post(`apps/${n}/users/by/${t.label}/${t.id}/subscriptions`,i,e.jwtHeader)})}static updateSubscription(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:n}=e;return J.patch(`apps/${n}/subscriptions/${t}`,{subscription:i})})}static deleteSubscription(e,t){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:i}=e;return J.delete(`apps/${i}/subscriptions/${t}`)})}static fetchAliasesForSubscription(e,t){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:i}=e;return J.get(`apps/${i}/subscriptions/${t}/identity`)})}static identifyUserForSubscription(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:n}=e;return J.patch(`apps/${n}/users/by/subscriptions/${t}/identity`,{identity:i},e.jwtHeader)})}static transferSubscription(e,t,i,n){return(0,w.mG)(this,void 0,void 0,function*(){let{appId:o}=e;return J.patch(`apps/${o}/subscriptions/${t}/owner`,{identity:Object.assign({},i),retain_previous_owner:n},e.jwtHeader)})}}(ev=eC||(eC={}))[ev.Direct=1]="Direct",ev[ev.Indirect=2]="Indirect",ev[ev.Unattributed=3]="Unattributed",ev[ev.NotSupported=4]="NotSupported";class et{static sendNotification(e,t,i,n,o,s,r,a){let l={app_id:e,contents:n,include_player_ids:t,isAnyWeb:!0,data:r,web_buttons:a};return i&&(l.headings=i),o&&(l.url=o),s&&(l.chrome_web_icon=s,l.firefox_icon=s),E.Z.trimUndefined(l),J.post("notifications",l)}static sendOutcome(e){return(0,w.mG)(this,void 0,void 0,function*(){Q.Z.info("Outcome payload:",e);try{yield J.post("outcomes/measure",e)}catch(t){Q.Z.error("sendOutcome",t)}})}}let ei=class{static downloadServerAppConfig(e){return(0,w.mG)(this,void 0,void 0,function*(){E.Z.enforceAppId(e);let t=yield z.get(`sync/${e}/web`,null);return null==t?void 0:t.result})}static getUserIdFromSubscriptionIdentifier(e,t,i){return E.Z.enforceAppId(e),z.post("players",{app_id:e,device_type:t,identifier:i,notification_types:M.TemporaryWebRecord}).then(e=>e&&e.id?e.id:null).catch(e=>(Q.Z.debug("Error getting user ID from subscription identifier:",e),null))}static updateUserSession(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){let n=new L(L.ONESIGNAL_ID,t);E.Z.enforceAppId(e),E.Z.enforceAlias(n);try{yield ee.updateUser({appId:e,subscriptionId:i},n,{refresh_device_metadata:!0,deltas:{session_count:1}})}catch(o){Q.Z.debug("Error updating user session:",o)}})}static sendSessionDuration(e,t,i,n,o){return(0,w.mG)(this,void 0,void 0,function*(){let s=new L(L.ONESIGNAL_ID,t),r={id:"os__session_duration",app_id:e,session_time:n,notification_ids:o.notificationIds,subscription:{id:i,type:F.getSubscriptionType()},onesignal_id:t};r.direct=o.type===eC.Direct;try{yield ee.updateUser({appId:e,subscriptionId:i},s,{refresh_device_metadata:!0,deltas:{session_time:n}}),r.notification_ids&&r.notification_ids.length>0&&(yield et.sendOutcome(r))}catch(a){Q.Z.debug("Error sending session duration:",a)}})}};class en{static sendNotification(e,t,i,n,o,s,r,a){return et.sendNotification(e,t,i,n,o,s,r,a)}static jsonpLib(e,t){N()(e,null,t)}static downloadServerAppConfig(e){return(0,w.mG)(this,void 0,void 0,function*(){return A.Z.getWindowEnv()===_.Q.Host?yield new Promise((t,i)=>{en.jsonpLib(`${A.Z.getOneSignalApiUrl().toString()}/sync/${e}/web`,(e,n)=>{e?i(e):n.success?t(n):i(n)})}):yield ei.downloadServerAppConfig(e)})}}(e$=eE||(eE={})).Native="native",e$.Push="push",e$.Category="category",e$.Sms="sms",e$.Email="email",e$.SmsAndEmail="smsAndEmail";let eo={pageViews:1,timeDelay:0},es="We'd like to show you notifications for the latest news and updates.",er="Allow",ea="Cancel",el="Try Again",ed={updateMessage:"Update your push notification subscription preferences.",positiveUpdateButton:"Save Preferences",negativeUpdateButton:"Cancel"},ec={type:eE.Push,text:{actionMessage:es,acceptButton:er,cancelButton:ea},autoPrompt:!1,delay:eo};class eu{static convertTagsApiToBooleans(e){let t={};return Object.keys(e).forEach(i=>{t[i]="1"===e[i]}),t}static convertTagsBooleansToApi(e){let t={};return Object.keys(e).forEach(i=>{t[i]=!0===e[i]?"1":"0"}),t}static getObjectDifference(e,t){let i={};return Object.keys(e).forEach(n=>{t[n]!==e[n]&&(i[n]=e[n])}),i}static markAllTagsAsSpecified(e,t){e.forEach(e=>{e.checked=t})}static isTagObjectEmpty(e){return 0===Object.keys(e).length}static getCheckedTagCategories(e,t){if(!t)return e;if(eu.isTagObjectEmpty(t)){let i=(0,j.p$)(e);return eu.markAllTagsAsSpecified(i,!0),i}return(0,j.p$)(e).map(e=>{let i=t[e.tag];return e.checked=eu.getCheckedStatusForTagValue(i),e})}static getCheckedStatusForTagValue(e){return void 0===e||e}static limitCategoriesToMaxCount(e,t){return(0,j.p$)(e),e.slice(0,t)}}class eh{static isCategorySlidedownConfigured(e){if(!e)return!1;let t=eh.getFirstSlidedownPromptOptionsWithType(e,eE.Category);return!!t&&!!t.categories&&t.categories.length>0}static isCategorySlidedownConfiguredVersion1(e){var t,i;return((null===(i=null===(t=null==e?void 0:e.categories)||void 0===t?void 0:t.tags)||void 0===i?void 0:i.length)||0)>0}static getFirstSlidedownPromptOptionsWithType(e,t){return e?e.filter(e=>e.type===t)[0]:void 0}static isSlidedownAutoPromptConfigured(e){if(!e)return!1;for(let t=0;t<e.length;t++)if(e[t].autoPrompt)return!0;return!1}static isSlidedownPushDependent(e){return e===eE.Push||e===eE.Category}}class ep{static upgradeConfigToVersionTwo(e){var t,i,n;ep.isPromptOptionsVersion0(e.promptOptions)&&(e.promptOptions=ep.convertConfigToVersionOne(e.promptOptions)),ep.isSlidedownConfigVersion1(null===(t=e.promptOptions)||void 0===t?void 0:t.slidedown)&&(null===(i=e.promptOptions)||void 0===i?void 0:i.slidedown)&&(e.promptOptions.slidedown=ep.convertConfigToVersionTwo(null===(n=e.promptOptions)||void 0===n?void 0:n.slidedown))}static convertConfigToVersionOne(e){e.slidedown||(e.slidedown={});let{acceptButtonText:t,cancelButtonText:i,actionMessage:n}=e.slidedown,o=e.acceptButtonText||e.acceptButton,s=e.cancelButtonText||e.cancelButton;return e.slidedown.acceptButtonText=t||o,e.slidedown.cancelButtonText=i||s,e.slidedown.actionMessage=n||e.actionMessage,e}static convertConfigToVersionTwo(e){var t,i,n,o;let s=eh.isCategorySlidedownConfiguredVersion1(e)?eE.Category:eE.Push,r,a;return s===eE.Category&&(r=null===(t=e.categories)||void 0===t?void 0:t.positiveUpdateButton,a=null===(i=e.categories)||void 0===i?void 0:i.negativeUpdateButton),{prompts:[...e.prompts||[],{type:s,autoPrompt:e.autoPrompt,text:{actionMessage:e.actionMessage,acceptButton:e.acceptButton||e.acceptButtonText,cancelButton:e.cancelButton||e.cancelButtonText,positiveUpdateButton:r,negativeUpdateButton:a,updateMessage:null===(n=null==e?void 0:e.categories)||void 0===n?void 0:n.updateMessage},delay:{pageViews:e.pageViews,timeDelay:e.timeDelay},categories:null===(o=null==e?void 0:e.categories)||void 0===o?void 0:o.tags}]}}static isPromptOptionsVersion0(e){if(e){let t=["acceptButtonText","cancelButtonText","actionMessage"];for(let i=0;i<t.length;i++)if(e.hasOwnProperty(t[i]))return!0}return!1}static isSlidedownConfigVersion1(e){if(e){let t=["enabled","autoPrompt","pageViews","timeDelay","acceptButton","acceptButtonText","cancelButton","cancelButtonText","actionMessage","customizeTextEnabled","categories"];for(let i=0;i<t.length;i++)if(e.hasOwnProperty(t[i]))return!0}return!1}}(eb=eP||(eP={})).TypicalSite="typical",eb.WordPress="wordpress",eb.Shopify="shopify",eb.Blogger="blogger",eb.Magento="magento",eb.Drupal="drupal",eb.SquareSpace="squarespace",eb.Joomla="joomla",eb.Weebly="weebly",eb.Wix="wix",eb.Custom="custom",(ey=eO||(eO={})).Exact="exact",ey.Origin="origin",(eS=eT||(eT={})).Navigate="navigate",eS.Focus="focus",(ew=ek||(ek={}))[ew.Dashboard=0]="Dashboard",ew[ew.JavaScript=1]="JavaScript";class eg{static getAppConfig(e,t){return(0,w.mG)(this,void 0,void 0,function*(){try{if(!e||!e.appId||!Z.Z.isValidUuid(e.appId))throw new X(eI.InvalidAppId);let i=yield t(e.appId);ep.upgradeConfigToVersionTwo(e);let n=this.getMergedConfig(e,i);return this.checkUnsupportedSubdomain(n),this.checkRestrictedOrigin(n),n}catch(o){if(o){if(1===o.code)throw new X(eI.InvalidAppId);if(2===o.code)throw new X(eI.AppNotConfiguredForWebPush)}throw o}})}static checkUnsupportedSubdomain(e){let t=!window.isSecureContext;if(e.hasUnsupportedSubdomain||t)throw t?Error("OneSignalSDK: HTTP sites are no longer supported starting with version 16 (User Model), your public site must start with https://. Please visit the OneSignal dashboard's Settings > Web Configuration to find this option."):Error('OneSignalSDK: The "My site is not fully HTTPS" option is no longer supported starting with version 16 (User Model) of the OneSignal SDK. Please visit the OneSignal dashboard\'s Settings > Web Configuration to find this option.')}static checkRestrictedOrigin(e){if(e.restrictedOriginEnabled&&A.Z.getWindowEnv()===_.Q.Host&&!this.doesCurrentOriginMatchConfigOrigin(e.origin))throw new X(eI.WrongSiteUrl,{siteUrl:e.origin})}static doesCurrentOriginMatchConfigOrigin(e){try{return location.origin===new URL(e).origin}catch(t){return!1}}static getIntegrationCapabilities(e){switch(e){case eP.Custom:case eP.WordPress:return{configuration:ek.JavaScript};default:return{configuration:ek.Dashboard}}}static getMergedConfig(e,t){let i=this.getConfigIntegrationKind(t),n=this.hasUnsupportedSubdomainForConfigIntegrationKind(i,e,t),o=this.getUserConfigForConfigIntegrationKind(i,e,t);return{appId:t.app_id,hasUnsupportedSubdomain:n,siteName:t.config.siteInfo.name,origin:t.config.origin,restrictedOriginEnabled:t.features.restrict_origin&&t.features.restrict_origin.enable,safariWebId:t.config.safari_web_id,vapidPublicKey:t.config.vapid_public_key,onesignalVapidPublicKey:t.config.onesignal_vapid_public_key,userConfig:o,enableOnSession:E.Z.valueOrDefault(t.features.enable_on_session,!1),sessionThreshold:E.Z.valueOrDefault(t.features.session_threshold,30),enableSessionDuration:E.Z.valueOrDefault(t.features.web_on_focus_enabled,!0)}}static getConfigIntegrationKind(e){return e.config.integration?e.config.integration.kind:eP.Custom}static getCustomLinkConfig(e){let t={enabled:!1,style:"button",size:"medium",unsubscribeEnabled:!1,text:{explanation:"",subscribe:"",unsubscribe:""},color:{button:"",text:""}};if(!(e&&e.config&&e.config.staticPrompts&&e.config.staticPrompts.customlink&&e.config.staticPrompts.customlink.enabled))return t;let i=e.config.staticPrompts.customlink;return{enabled:i.enabled,style:i.style,size:i.size,unsubscribeEnabled:i.unsubscribeEnabled,text:i.text?{subscribe:i.text.subscribe,unsubscribe:i.text.unsubscribe,explanation:i.text.explanation}:t.text,color:i.color?{button:i.color.button,text:i.color.text}:t.color}}static injectDefaultsIntoPromptOptions(e,t,i){var n,o;let s={enabled:!1};e&&e.customlink&&(s=e.customlink);let r=t.customlink,a=Object.assign(Object.assign({},e),{customlink:{enabled:E.Z.getValueOrDefault(s.enabled,r.enabled),style:E.Z.getValueOrDefault(s.style,r.style),size:E.Z.getValueOrDefault(s.size,r.size),unsubscribeEnabled:E.Z.getValueOrDefault(s.unsubscribeEnabled,r.unsubscribeEnabled),text:{subscribe:E.Z.getValueOrDefault(s.text?s.text.subscribe:void 0,r.text.subscribe),unsubscribe:E.Z.getValueOrDefault(s.text?s.text.unsubscribe:void 0,r.text.unsubscribe),explanation:E.Z.getValueOrDefault(s.text?s.text.explanation:void 0,r.text.explanation)},color:{button:E.Z.getValueOrDefault(s.color?s.color.button:void 0,r.color.button),text:E.Z.getValueOrDefault(s.color?s.color.text:void 0,r.color.text)}}});return a.slidedown?a.slidedown.prompts=null===(o=null===(n=a.slidedown)||void 0===n?void 0:n.prompts)||void 0===o?void 0:o.map(e=>{var t,i,n,o,s,r,a,l,d;if(e.type=E.Z.getValueOrDefault(e.type,eE.Push),e.type===eE.Category&&(e.text=Object.assign(Object.assign({},e.text),{positiveUpdateButton:E.Z.getValueOrDefault(null===(t=e.text)||void 0===t?void 0:t.positiveUpdateButton,ed.positiveUpdateButton),negativeUpdateButton:E.Z.getValueOrDefault(null===(i=e.text)||void 0===i?void 0:i.negativeUpdateButton,ed.negativeUpdateButton),updateMessage:E.Z.getValueOrDefault(null===(n=e.text)||void 0===n?void 0:n.updateMessage,ed.updateMessage)})),e.text=Object.assign(Object.assign({},e.text),{actionMessage:E.Z.getValueOrDefault(null===(o=e.text)||void 0===o?void 0:o.actionMessage,es),acceptButton:E.Z.getValueOrDefault(null===(s=e.text)||void 0===s?void 0:s.acceptButton,er),cancelButton:E.Z.getValueOrDefault(null===(r=e.text)||void 0===r?void 0:r.cancelButton,ea),confirmMessage:E.Z.getValueOrDefault(null===(a=e.text)||void 0===a?void 0:a.confirmMessage,"Thank You!")}),e.autoPrompt=E.Z.getValueOrDefault(e.autoPrompt,!0),e.delay={pageViews:E.Z.getValueOrDefault(null===(l=e.delay)||void 0===l?void 0:l.pageViews,eo.pageViews),timeDelay:E.Z.getValueOrDefault(null===(d=e.delay)||void 0===d?void 0:d.timeDelay,eo.timeDelay)},e.categories){let{categories:c}=e;e.categories=eu.limitCategoriesToMaxCount(c,10)}return e}):(a.slidedown={prompts:[]},a.slidedown.prompts=[ec]),a.native?(a.native.enabled=!!a.native.enabled,a.native.autoPrompt=a.native.hasOwnProperty("autoPrompt")?!!a.native.enabled&&!!a.native.autoPrompt:!!a.native.enabled,a.native.pageViews=E.Z.getValueOrDefault(a.native.pageViews,eo.pageViews),a.native.timeDelay=E.Z.getValueOrDefault(a.native.timeDelay,eo.timeDelay)):a.native={enabled:!1,autoPrompt:!1,pageViews:eo.pageViews,timeDelay:eo.timeDelay},!0===i.autoRegister&&(a.native.enabled=!0,a.native.autoPrompt=!0),a.autoPrompt=a.native.autoPrompt||eh.isSlidedownAutoPromptConfigured(a.slidedown.prompts),a}static getPromptOptionsForDashboardConfiguration(e){let t=e.config.staticPrompts,i=t.native?{enabled:t.native.enabled,autoPrompt:t.native.enabled&&!1!==t.native.autoPrompt,pageViews:E.Z.getValueOrDefault(t.native.pageViews,eo.pageViews),timeDelay:E.Z.getValueOrDefault(t.native.timeDelay,eo.timeDelay)}:{enabled:!1,autoPrompt:!1,pageViews:eo.pageViews,timeDelay:eo.timeDelay},{prompts:n}=t.slidedown;return{autoPrompt:i.autoPrompt||eh.isSlidedownAutoPromptConfigured(n),native:i,slidedown:{prompts:n},fullscreen:{enabled:t.fullscreen.enabled,actionMessage:t.fullscreen.actionMessage,acceptButton:t.fullscreen.acceptButton,cancelButton:t.fullscreen.cancelButton,title:t.fullscreen.title,message:t.fullscreen.message,caption:t.fullscreen.caption,autoAcceptTitle:t.fullscreen.autoAcceptTitle},customlink:this.getCustomLinkConfig(e)}}static getUserConfigForConfigIntegrationKind(e,t,i){switch(this.getIntegrationCapabilities(e).configuration){case ek.Dashboard:return{appId:i.app_id,autoRegister:!1,autoResubscribe:i.config.autoResubscribe,path:i.config.serviceWorker.path,serviceWorkerPath:i.config.serviceWorker.workerName,serviceWorkerParam:{scope:i.config.serviceWorker.registrationScope},subdomainName:i.config.siteInfo.proxyOrigin,promptOptions:this.getPromptOptionsForDashboardConfiguration(i),welcomeNotification:{disable:!i.config.welcomeNotification.enable,title:i.config.welcomeNotification.title,message:i.config.welcomeNotification.message,url:i.config.welcomeNotification.url},notifyButton:{enable:i.config.staticPrompts.bell.enabled,displayPredicate:i.config.staticPrompts.bell.hideWhenSubscribed?()=>!OneSignal.User.PushSubscription.optedIn:null,size:i.config.staticPrompts.bell.size,position:i.config.staticPrompts.bell.location,showCredit:!1,offset:{bottom:`${i.config.staticPrompts.bell.offset.bottom}px`,left:`${i.config.staticPrompts.bell.offset.left}px`,right:`${i.config.staticPrompts.bell.offset.right}px`},colors:{"circle.background":i.config.staticPrompts.bell.color.main,"circle.foreground":i.config.staticPrompts.bell.color.accent,"badge.background":"black","badge.foreground":"white","badge.bordercolor":"black","pulse.color":i.config.staticPrompts.bell.color.accent,"dialog.button.background.hovering":i.config.staticPrompts.bell.color.main,"dialog.button.background.active":i.config.staticPrompts.bell.color.main,"dialog.button.background":i.config.staticPrompts.bell.color.main,"dialog.button.foreground":"white"},text:{"tip.state.unsubscribed":i.config.staticPrompts.bell.tooltip.unsubscribed,"tip.state.subscribed":i.config.staticPrompts.bell.tooltip.subscribed,"tip.state.blocked":i.config.staticPrompts.bell.tooltip.blocked,"message.prenotify":i.config.staticPrompts.bell.tooltip.unsubscribed,"message.action.subscribing":i.config.staticPrompts.bell.message.subscribing,"message.action.subscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.resubscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.unsubscribed":i.config.staticPrompts.bell.message.unsubscribing,"dialog.main.title":i.config.staticPrompts.bell.dialog.main.title,"dialog.main.button.subscribe":i.config.staticPrompts.bell.dialog.main.subscribeButton,"dialog.main.button.unsubscribe":i.config.staticPrompts.bell.dialog.main.unsubscribeButton,"dialog.blocked.title":i.config.staticPrompts.bell.dialog.blocked.title,"dialog.blocked.message":i.config.staticPrompts.bell.dialog.blocked.message}},persistNotification:i.config.notificationBehavior?i.config.notificationBehavior.display.persist:void 0,webhooks:{cors:i.config.webhooks.corsEnable,"notification.willDisplay":i.config.webhooks.notificationWillDisplayHook,"notification.clicked":i.config.webhooks.notificationClickedHook,"notification.dismissed":i.config.webhooks.notificationDismissedHook},notificationClickHandlerMatch:i.config.notificationBehavior?i.config.notificationBehavior.click.match:void 0,notificationClickHandlerAction:i.config.notificationBehavior?i.config.notificationBehavior.click.action:void 0,allowLocalhostAsSecureOrigin:i.config.setupBehavior?i.config.setupBehavior.allowLocalhostAsSecureOrigin:void 0,outcomes:{direct:i.config.outcomes.direct,indirect:{enabled:i.config.outcomes.indirect.enabled,influencedTimePeriodMin:i.config.outcomes.indirect.notification_attribution.minutes_since_displayed,influencedNotificationsLimit:i.config.outcomes.indirect.notification_attribution.limit},unattributed:i.config.outcomes.unattributed}};case ek.JavaScript:{let n=Object.assign(Object.assign(Object.assign(Object.assign({},t),{promptOptions:this.injectDefaultsIntoPromptOptions(t.promptOptions,i.config.staticPrompts,t)}),{serviceWorkerParam:t.serviceWorkerParam?t.serviceWorkerParam:{scope:"/"},serviceWorkerPath:t.serviceWorkerPath?t.serviceWorkerPath:"OneSignalSDKWorker.js",path:t.path?t.path:"/"}),{outcomes:{direct:i.config.outcomes.direct,indirect:{enabled:i.config.outcomes.indirect.enabled,influencedTimePeriodMin:i.config.outcomes.indirect.notification_attribution.minutes_since_displayed,influencedNotificationsLimit:i.config.outcomes.indirect.notification_attribution.limit},unattributed:i.config.outcomes.unattributed}});return t.hasOwnProperty("autoResubscribe")?n.autoResubscribe=!!t.autoResubscribe:t.hasOwnProperty("autoRegister")?n.autoResubscribe=!!t.autoRegister:n.autoResubscribe=!!i.config.autoResubscribe,n}}}static hasUnsupportedSubdomainForConfigIntegrationKind(e,t,i){switch(this.getIntegrationCapabilities(e).configuration){case ek.Dashboard:return i.config.siteInfo.proxyOriginEnabled;case ek.JavaScript:return!!t.subdomainName}}}class em{getAppConfig(e){return(0,w.mG)(this,void 0,void 0,function*(){return yield eg.getAppConfig(e,en.downloadServerAppConfig)})}getMergedConfig(e,t){return eg.getMergedConfig(e,t)}}var ef,ev,e$,eb,ey,eS,ew,eI,eC,eE,eP,eO,eT,ek,ex,eN=i(86);class eA{static getRegistration(e){return(0,w.mG)(this,void 0,void 0,function*(){try{let t=location.origin+e;return yield navigator.serviceWorker.getRegistration(t)}catch(i){return Q.Z.warn("[Service Worker Status] Error Checking service worker registration",e,i),null}})}static getAvailableServiceWorker(e){let t=e.active||e.installing||e.waiting;return t||Q.Z.warn("Could not find an available ServiceWorker instance!"),t}static waitUntilActive(e){return new Promise(t=>{let i=e.installing||e.waiting;i&&i.addEventListener("statechange",()=>{Q.Z.debug("OneSignal Service Worker state changed:",i.state),e.active&&t()}),e.active&&t()})}}(e4=ex||(ex={})).WorkerVersion="GetWorkerVersion",e4.Subscribe="Subscribe",e4.SubscribeNew="SubscribeNew",e4.AmpSubscriptionState="amp-web-push-subscription-state",e4.AmpSubscribe="amp-web-push-subscribe",e4.AmpUnsubscribe="amp-web-push-unsubscribe",e4.NotificationWillDisplay="notification.willDisplay",e4.NotificationClicked="notification.clicked",e4.NotificationDismissed="notification.dismissed",e4.RedirectPage="command.redirect",e4.SessionUpsert="os.session.upsert",e4.SessionDeactivate="os.session.deactivate",e4.AreYouVisible="os.page_focused_request",e4.AreYouVisibleResponse="os.page_focused_response",e4.SetLogging="os.set_sw_logging";class e_{constructor(){this.cache={}}getCache(){return Object.assign({},this.cache)}loadSdkStylesheet(){return(0,w.mG)(this,void 0,void 0,function*(){let e=A.Z.getOneSignalResourceUrlPath(),t=A.Z.getOneSignalCssFileName();return yield this.loadIfNew(0,new URL(`${e}/${t}?v=${B.Z.getSdkStylesVersionHash()}`))})}loadFetchPolyfill(){return(0,w.mG)(this,void 0,void 0,function*(){return yield this.loadIfNew(1,new URL("https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"))})}loadIfNew(e,t){return(0,w.mG)(this,void 0,void 0,function*(){return this.cache[t.toString()]||(this.cache[t.toString()]=e_.load(e,t)),yield this.cache[t.toString()]})}static load(e,t){return(0,w.mG)(this,void 0,void 0,function*(){try{let i;return yield new Promise((n,o)=>{var s;switch(e){case 1:(i=document.createElement("script")).setAttribute("type","text/javascript"),i.setAttribute("async","async"),i.setAttribute("src",t.toString());break;case 0:(i=document.createElement("link")).setAttribute("rel","stylesheet"),i.setAttribute("href",t.toString())}i.onerror=o,i.onload=n,null===(s=document.querySelector("head"))||void 0===s||s.appendChild(i)}),0}catch(n){return 1}})}}let eM="os_pageViews",eD="requiresPrivacyConsent";class eZ{static removeLegacySubscriptionOptions(){localStorage.removeItem("isOptedOut"),localStorage.removeItem("isPushNotificationsEnabled")}static setConsentRequired(e){localStorage.setItem(eD,e.toString())}static getConsentRequired(){return"true"===localStorage.getItem(eD)}static setLocalPageViewCount(e){localStorage.setItem(eM,e.toString())}static getLocalPageViewCount(){return Number(localStorage.getItem(eM))}}class e8{constructor(){this.incrementedPageViewCount=!1}getPageViewCount(){try{let e=sessionStorage.getItem(e8.SESSION_STORAGE_KEY_NAME),t=e?parseInt(e):0;return isNaN(t)?0:t}catch(i){return 0}}setPageViewCount(e){try{sessionStorage.setItem(e8.SESSION_STORAGE_KEY_NAME,e.toString())}catch(t){}}incrementPageViewCount(){if(this.incrementedPageViewCount)return;let e=this.getPageViewCount()+1,t=this.getLocalPageViewCount()+1;this.setPageViewCount(e),this.setLocalPageViewCount(t),this.incrementedPageViewCount=!0,Q.Z.debug(`Incremented page view count: newCountSingleTab: ${e},
      newCountAccrossTabs: ${t}.`)}simulatePageNavigationOrRefresh(){this.incrementedPageViewCount=!1}isFirstPageView(){return 1===this.getPageViewCount()}getLocalPageViewCount(){return eZ.getLocalPageViewCount()}setLocalPageViewCount(e){eZ.setLocalPageViewCount(e)}}e8.SESSION_STORAGE_KEY_NAME="onesignal-pageview-count";class eU{static get STORED_PERMISSION_KEY(){return"storedNotificationPermission"}getPermissionStatus(){return(0,w.mG)(this,void 0,void 0,function*(){if(!OneSignal.context)throw new R.Z("OneSignal.context is undefined. Make sure to call OneSignal.init() before calling getPermissionStatus().");return yield OneSignal.context.permissionManager.getNotificationPermission(OneSignal.config.safariWebId)})}getNotificationPermission(e){return(0,w.mG)(this,void 0,void 0,function*(){return B.Z.useSafariLegacyPush()?eU.getLegacySafariNotificationPermission(e):this.getW3cNotificationPermission()})}static getLegacySafariNotificationPermission(e){if(e)return window.safari.pushNotification.permission(e).permission;throw new eN.R("safariWebId",eN.Q.Empty)}getW3cNotificationPermission(){return Notification.permission}}class eG{constructor(e){if(!e)throw new eN.R("path",eN.Q.Empty);this.path=e.trim()}getQueryString(){let e=this.path.indexOf("?");return -1===e?null:this.path.length>e?this.path.substring(e+1):null}getWithoutQueryString(){return this.path.split(eG.QUERY_STRING)[0]}getFileName(){var e;return null===(e=this.getWithoutQueryString().split("\\").pop())||void 0===e?void 0:e.split("/").pop()}getFileNameWithQuery(){var e;return null===(e=this.path.split("\\").pop())||void 0===e?void 0:e.split("/").pop()}getFullPath(){return this.path}getPathWithoutFileName(){let e=this.getWithoutQueryString(),t=e.lastIndexOf(this.getFileName()),i;return e.substring(0,t).replace(/[\\/]$/,"")}}eG.QUERY_STRING="?";var eB=i(934),e1=i(644);class eF extends R.Z{constructor(e,t){super("Registration of a Service Worker failed."),this.status=e,this.statusText=t,Object.setPrototypeOf(this,eF.prototype)}}let eL=eF;class eW{static debug(...e){self.shouldLog&&console.debug(...e)}static trace(...e){self.shouldLog&&console.trace(...e)}static info(...e){self.shouldLog&&console.info(...e)}static warn(...e){self.shouldLog&&console.warn(...e)}static error(...e){self.shouldLog&&console.error(...e)}}let eV=()=>{eW.debug("Do nothing")};function eR(e,t){let i=1e3*t,n,o,s=new Promise((t,s)=>{let r=!1;n=self.setTimeout(()=>(0,w.mG)(this,void 0,void 0,function*(){r=!0;try{yield e(),t()}catch(i){eW.error("Failed to execute callback",i),s()}}),i),o=()=>{eW.debug("Cancel called"),self.clearTimeout(n),r||t()}});return o?{promise:s,cancel:o}:(eW.warn("clearTimeoutHandle was not assigned."),{promise:s,cancel:eV})}class e0{constructor(e,t,i,n){this.outcomeName=i,this.config=t,this.appId=e,this.isUnique=n}getAttribution(){return(0,w.mG)(this,void 0,void 0,function*(){return yield e0.getAttribution(this.config)})}beforeOutcomeSend(){return(0,w.mG)(this,void 0,void 0,function*(){let e=this.isUnique?"sendUniqueOutcome":"sendOutcome";return((0,j.tI)(e,this.outcomeName),this.config)?this.outcomeName?(yield(0,j.JX)(),!!(yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled())||(Q.Z.warn("Reporting outcomes is supported only for subscribed users."),!1)):(Q.Z.error("Outcome name is required"),!1):(Q.Z.debug("Outcomes feature not supported by main application yet."),!1)})}getAttributedNotifsByUniqueOutcomeName(){return(0,w.mG)(this,void 0,void 0,function*(){return(yield eB.ZP.getAll("SentUniqueOutcome")).filter(e=>e.outcomeName===this.outcomeName).reduce((e,t)=>[...e,...t.notificationIds||[]],[])})}getNotifsToAttributeWithUniqueOutcome(e){return(0,w.mG)(this,void 0,void 0,function*(){let t=yield this.getAttributedNotifsByUniqueOutcomeName();return e.filter(e=>-1===t.indexOf(e))})}shouldSendUnique(e,t){return e.type===eC.Unattributed||t.length>0}saveSentUniqueOutcome(e){return(0,w.mG)(this,void 0,void 0,function*(){let t=this.outcomeName,i=yield eB.ZP.get("SentUniqueOutcome",t),n=yield eB.ZP.getCurrentSession(),o=[...i?i.notificationIds:[],...e],s=n?n.startTimestamp:null;yield eB.ZP.put("SentUniqueOutcome",{outcomeName:t,notificationIds:o,sentDuringSession:s})})}wasSentDuringSession(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield eB.ZP.get("SentUniqueOutcome",this.outcomeName);if(!e)return!1;let t=yield eB.ZP.getCurrentSession(),i=t&&e.sentDuringSession===t.startTimestamp,n=!t&&!!e.sentDuringSession;return i||n})}send(e){return(0,w.mG)(this,void 0,void 0,function*(){let{type:t,notificationIds:i,weight:n}=e;switch(t){case eC.Direct:return this.isUnique&&(yield this.saveSentUniqueOutcome(i)),void(yield OneSignal.context.updateManager.sendOutcomeDirect(this.appId,i,this.outcomeName,n));case eC.Indirect:return this.isUnique&&(yield this.saveSentUniqueOutcome(i)),void(yield OneSignal.context.updateManager.sendOutcomeInfluenced(this.appId,i,this.outcomeName,n));case eC.Unattributed:if(this.isUnique){if(yield this.wasSentDuringSession())return void Q.Z.warn("(Unattributed) unique outcome was already sent during this session");yield this.saveSentUniqueOutcome([])}return void(yield OneSignal.context.updateManager.sendOutcomeUnattributed(this.appId,this.outcomeName,n));default:return void Q.Z.warn("You are on a free plan. Please upgrade to use this functionality.")}})}static getAttribution(e){return(0,w.mG)(this,void 0,void 0,function*(){if(e.direct&&e.direct.enabled){let t=yield eB.ZP.getAllNotificationClickedForOutcomes();if(t.length>0)return{type:eC.Direct,notificationIds:[t[0].notificationId]}}if(e.indirect&&e.indirect.enabled){let i=60*e.indirect.influencedTimePeriodMin*1e3,n=new Date((new Date).getTime()-i).getTime(),o=yield eB.ZP.getAllNotificationReceivedForOutcomes();if(Q.Z.debug(`	Found total of ${o.length} received notifications`),o.length>0){let s=e.indirect.influencedNotificationsLimit,r=E.c.sortArrayOfObjects(o,e=>e.timestamp,!0,!1),a=r.filter(e=>e.timestamp>=n).slice(0,s).map(e=>e.notificationId);Q.Z.debug(`	Total of ${a.length} received notifications are within reporting window.`);let l=r.filter(e=>-1===a.indexOf(e.notificationId)).map(e=>e.notificationId);if(l.forEach(e=>eB.ZP.remove(eB.H4,e)),Q.Z.debug(`	${l.length} received notifications will be deleted.`),a.length>0)return{type:eC.Indirect,notificationIds:a}}}return e.unattributed&&e.unattributed.enabled?{type:eC.Unattributed,notificationIds:[]}:{type:eC.NotSupported,notificationIds:[]}})}}var e4,e3,e2=i(392);class e9{static getServiceWorkerHref(e,t,i){return e9.appendServiceWorkerParams(e.workerPath.getFullPath(),t,i)}static appendServiceWorkerParams(e,t,i){return`${new URL(e,Z.Q.getBaseUrl()).href}?${E.Z.encodeHashAsUriComponent({appId:t})}&${E.Z.encodeHashAsUriComponent({sdkVersion:i})}`}static upsertSession(e,t,i,n,o,s,r){return(0,w.mG)(this,void 0,void 0,function*(){let a=yield eB.ZP.getCurrentSession();if(!a){let l=(0,e2.I0)({appId:e}),d=yield eB.ZP.getLastNotificationClickedForOutcomes(e);return d&&(l.notificationId=d.notificationId),yield eB.ZP.upsertSession(l),void(yield e9.sendOnSessionCallIfNotPlayerCreate(e,t,i,s,l))}if(a.status===e2.$y.Active)return void eW.debug("Session already active",a);if(!a.lastDeactivatedTimestamp)return void eW.debug("Session is in invalid state",a);let c=(new Date).getTime();if(e9.timeInSecondsBetweenTimestamps(c,a.lastDeactivatedTimestamp)<=n)return a.status=e2.$y.Active,a.lastActivatedTimestamp=c,a.lastDeactivatedTimestamp=null,void(yield eB.ZP.upsertSession(a));yield e9.finalizeSession(e,t,i,a,o,r);let u=(0,e2.I0)({appId:e});yield eB.ZP.upsertSession(u),yield e9.sendOnSessionCallIfNotPlayerCreate(e,t,i,s,u)})}static deactivateSession(e,t,i,n,o,s){return(0,w.mG)(this,void 0,void 0,function*(){let r=yield eB.ZP.getCurrentSession();if(!r)return void eW.debug("No active session found. Cannot deactivate.");let a=()=>e9.finalizeSession(e,t,i,r,o,s);if(r.status===e2.$y.Inactive)return eR(a,n);if(r.status!==e2.$y.Active)return void eW.warn(`Session in invalid state ${r.status}. Cannot deactivate.`);let l=(new Date).getTime(),d=e9.timeInSecondsBetweenTimestamps(l,r.lastActivatedTimestamp);r.lastDeactivatedTimestamp=l,r.accumulatedDuration+=d,r.status=e2.$y.Inactive;let c=eR(a,n);return yield eB.ZP.upsertSession(r),c})}static sendOnSessionCallIfNotPlayerCreate(e,t,i,n,o){return(0,w.mG)(this,void 0,void 0,function*(){n!==e2.eB.UserCreate&&(eB.ZP.upsertSession(o),eB.ZP.resetSentUniqueOutcomes(),yield ei.updateUserSession(e,t,i))})}static finalizeSession(e,t,i,n,o,s){return(0,w.mG)(this,void 0,void 0,function*(){if(eW.debug("Finalize session",`started: ${new Date(n.startTimestamp)}`,`duration: ${n.accumulatedDuration}s`),o){eW.debug(`send on_focus reporting session duration -> ${n.accumulatedDuration}s`);let r=yield e0.getAttribution(s);eW.debug("send on_focus with attribution",r),yield ei.sendSessionDuration(e,t,i,n.accumulatedDuration,r)}yield Promise.all([eB.ZP.cleanupCurrentSession(),eB.ZP.removeAllNotificationClickedForOutcomes()]),eW.debug("Finalize session finished",`started: ${new Date(n.startTimestamp)}`)})}static timeInSecondsBetweenTimestamps(e,t){return e<=t?0:Math.floor((e-t)/1e3)}}(th=e3||(e3={})).OneSignalWorker="OneSignal Worker",th.ThirdParty="3rd Party",th.None="None",th.Indeterminate="Indeterminate";let e6={allowButton:"onesignal-slidedown-allow-button",body:"slidedown-body",buttonIndicatorHolder:"onesignal-button-indicator-holder",cancelButton:"onesignal-slidedown-cancel-button",container:"onesignal-slidedown-container",dialog:"onesignal-slidedown-dialog",footer:"slidedown-footer",reset:"onesignal-reset",savingStateButton:"onesignal-saving-state-button",slideUp:"slide-up",slideDown:"slide-down",closeSlidedown:"close-slidedown",icon:"slidedown-body-icon",message:"slidedown-body-message",defaultIcon:"default-icon",loadingContainer:"onesignal-loading-container",clearfix:"clearfix"},e7={allowButton:"onesignal-slidedown-allow-button",body:"slidedown-body",buttonIndicatorHolder:"onesignal-button-indicator-holder",cancelButton:"onesignal-slidedown-cancel-button",container:"onesignal-slidedown-container",dialog:"onesignal-slidedown-dialog",footer:"slidedown-footer",normalSlidedown:"normal-slidedown",loadingContainer:"onesignal-loading-container"},e5="align-right",eH="slidedown-button",eQ="tagging-container",eq="tagging-container-col",ej="channel-capture-container",eK="onesignal-error-input",ez="onesignal-validation-element-hidden",eJ="sms-input-with-validation-element",eY="email-input-with-validation-element",eX="iti-onesignal-sms-input",te="onesignal-email-input",tt="onesignal-sms-validation-element",ti="onesignal-email-validation-element",tn="onesignal-customlink-subscribe",to="onesignal-customlink-explanation",ts="onesignal-reset",tr={subscribed:"state-subscribed",unsubscribed:"state-unsubscribed"},ta={containerSelector:".onesignal-customlink-container",subscribeSelector:`.${tn}`,explanationSelector:`.${to}`};class tl{constructor(e){this.config=e}initialize(){return(0,w.mG)(this,void 0,void 0,function*(){var e,t;if(!(null===(e=this.config)||void 0===e?void 0:e.enabled)||!(yield this.loadSdkStyles()))return;Q.Z.info("OneSignal: initializing customlink");let i=yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled();if((null===(t=this.config)||void 0===t?void 0:t.unsubscribeEnabled)||!i)for(let n=0;n<this.customlinkContainerElements.length;n++)yield this.injectMarkup(this.customlinkContainerElements[n]);else this.hideCustomLinkContainers()})}injectMarkup(e){return(0,w.mG)(this,void 0,void 0,function*(){e.innerHTML="",yield this.mountExplanationNode(e),yield this.mountSubscriptionNode(e)})}mountExplanationNode(e){return(0,w.mG)(this,void 0,void 0,function*(){var t;if(null===(t=this.config)||void 0===t?void 0:t.text){if(this.config.text.explanation){let i=document.createElement("p");i.textContent=this.config.text.explanation,(0,j.bF)(i,ts),(0,j.bF)(i,to),this.config.size&&(0,j.bF)(i,this.config.size),(yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled())?(0,j.bF)(i,tr.subscribed):(0,j.bF)(i,tr.unsubscribed),e.appendChild(i)}}else Q.Z.error("CustomLink: required property 'text' is missing in the config")})}mountSubscriptionNode(e){return(0,w.mG)(this,void 0,void 0,function*(){var t;if(null===(t=this.config)||void 0===t?void 0:t.text){if(this.config.text.subscribe){let i=document.createElement("button");(0,j.bF)(i,ts),(0,j.bF)(i,tn),this.config.size&&(0,j.bF)(i,this.config.size),this.config.style&&(0,j.bF)(i,this.config.style),(yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled())?(0,j.bF)(i,tr.subscribed):(0,j.bF)(i,tr.unsubscribed),this.setCustomColors(i),yield this.setTextFromPushStatus(i),i.addEventListener("click",()=>(0,w.mG)(this,void 0,void 0,function*(){Q.Z.info("CustomLink: subscribe clicked"),yield this.handleClick(i)})),e.appendChild(i)}}else Q.Z.error("CustomLink: required property 'text' is missing in the config")})}loadSdkStyles(){return(0,w.mG)(this,void 0,void 0,function*(){return 0===(yield OneSignal.context.dynamicResourceLoader.loadSdkStylesheet())||(Q.Z.debug("Not initializing custom link button because styles failed to load."),!1)})}hideElement(e){(0,j.bF)(e,"hide")}hideCustomLinkContainers(){this.customlinkContainerElements.forEach(e=>{this.hideElement(e)})}handleClick(e){return(0,w.mG)(this,void 0,void 0,function*(){var t;if(!OneSignal.User.PushSubscription.optedIn)return yield OneSignal.User.PushSubscription.optIn(),void((null===(t=this.config)||void 0===t?void 0:t.unsubscribeEnabled)||this.hideCustomLinkContainers());yield OneSignal.User.PushSubscription.optOut(),yield this.setTextFromPushStatus(e)})}setTextFromPushStatus(e){return(0,w.mG)(this,void 0,void 0,function*(){var t,i,n,o;(null===(i=null===(t=this.config)||void 0===t?void 0:t.text)||void 0===i?void 0:i.subscribe)&&((yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled())||(e.textContent=this.config.text.subscribe)),(null===(o=null===(n=this.config)||void 0===n?void 0:n.text)||void 0===o?void 0:o.unsubscribe)&&(yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled())&&(e.textContent=this.config.text.unsubscribe)})}setCustomColors(e){var t,i,n,o,s,r,a;(null===(t=this.config)||void 0===t?void 0:t.color)&&this.config.color.text&&("button"===(null===(i=this.config)||void 0===i?void 0:i.style)&&(null===(n=this.config)||void 0===n?void 0:n.color.button)?(e.style.backgroundColor=null===(o=this.config)||void 0===o?void 0:o.color.button,e.style.color=null===(s=this.config)||void 0===s?void 0:s.color.text):"link"===(null===(r=this.config)||void 0===r?void 0:r.style)&&(e.style.color=null===(a=this.config)||void 0===a?void 0:a.color.text))}get customlinkContainerElements(){let e=document.querySelectorAll(ta.containerSelector);return Array.prototype.slice.call(e)}}class td{static put(e,t){return void 0===td.store[e]&&(td.store[e]=[null,null]),td.store[e].push(t),td.store[e].length==td.LIMIT+1&&td.store[e].shift(),td.store[e]}static get(e){return void 0===td.store[e]&&(td.store[e]=[null,null]),td.store[e]}static getFirst(e){return td.get(e)[0]}static getLast(e){return td.get(e)[1]}static remove(e){delete td.store[e]}static isEmpty(e){let t=td.get(e);return null===t[0]&&null===t[1]}}td.store={},td.LIMIT=2;let tc=class{static decodeHtmlEntities(e){return"undefined"==typeof DOMParser?e:(new DOMParser).parseFromString(e,"text/html").documentElement.textContent||""}};(tp=tm||(tm={}))[tp.HttpsPermissionRequest="HTTPS permission request"]="HttpsPermissionRequest",tp[tp.SlidedownPermissionMessage="slidedown permission message"]="SlidedownPermissionMessage",tp[tp.SubscriptionBell="subscription bell"]="SubscriptionBell",(tg=tf||(tf={}))[tg.MissingAppId=0]="MissingAppId",tg[tg.RedundantPermissionMessage=1]="RedundantPermissionMessage",tg[tg.PushPermissionAlreadyGranted=2]="PushPermissionAlreadyGranted",tg[tg.UnsupportedEnvironment=3]="UnsupportedEnvironment",tg[tg.MissingDomElement=4]="MissingDomElement",tg[tg.ServiceWorkerNotActivated=5]="ServiceWorkerNotActivated";class tu extends R.Z{constructor(e,t){let i;switch(e){case tf.MissingAppId:i="Missing required app ID.";break;case tf.RedundantPermissionMessage:{let n="";t&&t.permissionPromptType&&(n=`(${tm[t.permissionPromptType]})`),i=`Another permission message ${n} is being displayed.`;break}case tf.PushPermissionAlreadyGranted:i="Push permission has already been granted.";break;case tf.UnsupportedEnvironment:i="The current environment does not support this operation.";break;case tf.ServiceWorkerNotActivated:i="The service worker must be activated first."}super(i),this.description=tf[e],this.reason=e,Object.setPrototypeOf(this,tu.prototype)}}var th,tp,tg,tm,tf,tv,t$=i(985);class tb{static checkAndTriggerNotificationPermissionChanged(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield eB.ZP.get("Options","notificationPermission"),t=yield OneSignal.context.permissionManager.getPermissionStatus();e!==t&&(yield t$.Q.triggerNotificationPermissionChanged(),yield eB.ZP.put("Options",{key:"notificationPermission",value:t}))})}static getNotificationIcons(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield tb.getAppId();if(!e)throw new tu(tf.MissingAppId);let t=`${A.Z.getOneSignalApiUrl().toString()}/apps/${e}/icon`,i=yield fetch(t),n=yield i.json();if(n.errors)throw Q.Z.error(`API call ${t}`,"failed with:",n.errors),Error("Failed to get notification icons.");return n})}static getSlidedownOptions(e){return E.Z.getValueOrDefault(e.slidedown,{prompts:[]})}static getFullscreenPermissionMessageOptions(e){return e?e.fullscreen?{autoAcceptTitle:e.fullscreen.autoAcceptTitle,actionMessage:e.fullscreen.actionMessage,exampleNotificationTitleDesktop:e.fullscreen.title,exampleNotificationTitleMobile:e.fullscreen.title,exampleNotificationMessageDesktop:e.fullscreen.message,exampleNotificationMessageMobile:e.fullscreen.message,exampleNotificationCaption:e.fullscreen.caption,acceptButton:e.fullscreen.acceptButton,cancelButton:e.fullscreen.cancelButton}:e:null}static getPromptOptionsQueryString(){let e="";if(tb.getFullscreenPermissionMessageOptions(OneSignal.config.userConfig.promptOptions)){let t=tb.getPromptOptionsPostHash();for(let i of Object.keys(t))e+="&"+i+"="+t[i]}return e}static getPromptOptionsPostHash(){let e=tb.getFullscreenPermissionMessageOptions(OneSignal.config.userConfig.promptOptions),t={};if(e){let i={exampleNotificationTitleDesktop:"exampleNotificationTitle",exampleNotificationMessageDesktop:"exampleNotificationMessage",exampleNotificationTitleMobile:"exampleNotificationTitle",exampleNotificationMessageMobile:"exampleNotificationMessage"};for(let n of Object.keys(i)){let o=i[n];e[n]&&(e[o]=e[n])}let s=["autoAcceptTitle","siteName","autoAcceptTitle","subscribeText","showGraphic","actionMessage","exampleNotificationTitle","exampleNotificationMessage","exampleNotificationCaption","acceptButton","cancelButton","timeout"];for(let r=0;r<s.length;r++){let a=s[r],l=e[a],d=encodeURIComponent(l);(l||!1===l||""===l)&&(t[a]=d)}}return t}static getAppId(){return(0,w.mG)(this,void 0,void 0,function*(){return OneSignal.config.appId?Promise.resolve(OneSignal.config.appId):yield eB.ZP.get("Ids","appId")})}static getDeviceId(){return(0,w.mG)(this,void 0,void 0,function*(){return(yield OneSignal.database.getSubscription()).deviceId||void 0})}static getCurrentPushToken(){return(0,w.mG)(this,void 0,void 0,function*(){var e,t;if(B.Z.useSafariLegacyPush()){let i=null===(t=null===(e=window.safari)||void 0===e?void 0:e.pushNotification)||void 0===t?void 0:t.permission(OneSignal.config.safariWebId).deviceToken;return(null==i?void 0:i.toLowerCase())||void 0}let n=yield OneSignal.context.serviceWorkerManager.getRegistration();if(!n)return;let o=yield n.pushManager.getSubscription();return null==o?void 0:o.endpoint})}}class ty{constructor(e,t,i,n){this.model=e,this.property=t,this.oldValue=i,this.newValue=n}}class tS{constructor(){this.subscribers=new Set}subscribe(e){return this.subscribers.add(e),()=>this.subscribers.delete(e)}broadcast(e){this.subscribers.forEach(t=>{t(e)})}}(t8=tv||(tv={})).Add="add",t8.Remove="remove",t8.Update="update",t8.Hydrate="hydrate";class tw{constructor(e,t){this.modelId=e,this.payload=t,this.type=tv.Add}}class tI{constructor(e,t){this.modelId=e,this.payload=t,this.type=tv.Remove}}class tC{constructor(e,t){this.modelId=e,this.payload=t,this.type=tv.Update}}class tE{constructor(e,t){this.modelId=e,this.payload=t,this.type=tv.Hydrate}}class tP extends tS{constructor(e,t,i){super(),this.modelName=e,this.modelId=null!=i?i:Math.random().toString(36).substring(2),this.modelName=e,this.data=t,this.onesignalId=void 0,this.awaitOneSignalIdAvailable=new Promise(e=>{this.onesignalIdAvailableCallback=e})}setOneSignalId(e){var t;(0,j.tI)("setOneSignalId",{onesignalId:e}),this.onesignalId=e,e&&(null===(t=this.onesignalIdAvailableCallback)||void 0===t||t.call(this,e))}set(e,t,i=!0){let n;if((0,j.tI)("set",{property:e,newValue:t}),this.data&&(n=this.data[e],this.data[e]=t),i){let o=new tC(this.modelId,new ty(this,e,n,t));this.broadcast(o)}}hydrate(e){(0,j.tI)("hydrate",{data:e}),this.data=e,this.broadcast(new tE(this.modelId,this))}encode(){let e=this.modelId,t=this.modelName,i=this.onesignalId;return Object.assign({modelId:e,modelName:t,onesignalId:i},this.data)}static decode(e){(0,j.tI)("decode",{encodedModel:e});let{modelId:t,modelName:i,onesignalId:n}=e,o=(0,w._T)(e,["modelId","modelName","onesignalId"]),s=new tP(i,o,t);return s.setOneSignalId(n),s}}var tO=i(894);function tT(e){return void 0!==e.property}function tk(e){return null!==e&&"object"==typeof e&&(null==e?void 0:e.constructor)===Object}function tx(e){return void 0!==(null==e?void 0:e.onesignal_id)}function tN(e){return void 0!==(null==e?void 0:e.type)&&void 0!==(null==e?void 0:e.id)}class tA{static initializeUser(e){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("initializeUser",{isTemporary:e});let t=OneSignal.coreDirector.getIdentityModel(),i=OneSignal.coreDirector.getPropertiesModel();t&&i?Q.Z.debug("User already exists, skipping initialization."):(tA.createUserPropertiesModel(),yield tA.createAnonymousUser(e))})}static resetUserMetaProperties(){let e=t_.createOrGetInstance();e.hasOneSignalId=!1,e.awaitOneSignalIdAvailable=void 0,e.isCreatingUser=!1}static createAnonymousUser(e){return(0,w.mG)(this,void 0,void 0,function*(){let t;if(e)t={};else{let i=yield tA.createUserOnServer();if(!i)return;t=i.identity,OneSignal.coreDirector.hydrateUser(i)}let n=new tP(tO.Q.Identity,t);n.setOneSignalId(t.onesignal_id),OneSignal.coreDirector.add(tO.Q.Identity,n,!1),yield this.copyOneSignalIdPromiseFromIdentityModel()})}static createUserPropertiesModel(){let e={language:B.Z.getLanguage(),timezone_id:Intl.DateTimeFormat().resolvedOptions().timeZone},t=new tP(tO.Q.Properties,e);return OneSignal.coreDirector.add(tO.Q.Properties,t,!1),t}static createUserOnServer(){return(0,w.mG)(this,void 0,void 0,function*(){let e=t_.createOrGetInstance();if(!e.isCreatingUser){e.isCreatingUser=!0;try{let t=yield tb.getAppId(),i=yield OneSignal.coreDirector.getPushSubscriptionModel(),n;tN(null==i?void 0:i.data)&&(n=null==i?void 0:i.data.id);let o=yield tA.getAllUserData(),s=yield ee.createUser({appId:t,subscriptionId:n},o);return e.isCreatingUser=!1,s.result}catch(r){Q.Z.error(r)}}})}static createAndHydrateUser(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield tA.createUserOnServer();e&&OneSignal.coreDirector.hydrateUser(e)})}static getAllUserData(){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("LoginManager.getAllUserData");let e=OneSignal.coreDirector.getIdentityModel(),t=OneSignal.coreDirector.getPropertiesModel(),i=yield OneSignal.coreDirector.getAllSubscriptionsModels(),n={};return n.identity=null==e?void 0:e.data,n.properties=null==t?void 0:t.data,n.subscriptions=null==i?void 0:i.map(e=>e.data),n})}static copyOneSignalIdPromiseFromIdentityModel(){return(0,w.mG)(this,void 0,void 0,function*(){var e;let t=t_.createOrGetInstance(),i=OneSignal.coreDirector.getIdentityModel();t.awaitOneSignalIdAvailable=null==i?void 0:i.awaitOneSignalIdAvailable,null===(e=t.awaitOneSignalIdAvailable)||void 0===e||e.then(e=>{t.hasOneSignalId=!0,t.onesignalId=e})})}static updateModelWithCurrentUserOneSignalId(e){return(0,w.mG)(this,void 0,void 0,function*(){let t=t_.createOrGetInstance();yield t.awaitOneSignalIdAvailable,e.setOneSignalId(t.onesignalId)})}}class t_{constructor(){this.hasOneSignalId=!1,this.isCreatingUser=!1}static createOrGetInstance(){return t_.singletonInstance||(t_.singletonInstance=new t_,tA.initializeUser(!0).then(()=>{tA.copyOneSignalIdPromiseFromIdentityModel().catch(e=>{console.error(e)})}).catch(e=>{console.error(e)})),t_.singletonInstance}addAlias(e,t){if((0,j.tI)("addAlias",{label:e,id:t}),"string"!=typeof e)throw new eN.R("label",eN.Q.WrongType);if("string"!=typeof t)throw new eN.R("id",eN.Q.WrongType);if(!e)throw new eN.R("label",eN.Q.Empty);if(!t)throw new eN.R("id",eN.Q.Empty);this.addAliases({[e]:t})}addAliases(e){if((0,j.tI)("addAliases",{aliases:e}),!e||0===Object.keys(e).length)throw new eN.R("aliases",eN.Q.Empty);Object.keys(e).forEach(e=>(0,w.mG)(this,void 0,void 0,function*(){if("string"!=typeof e)throw new eN.R("label",eN.Q.WrongType)})),Object.keys(e).forEach(t=>(0,w.mG)(this,void 0,void 0,function*(){let i=OneSignal.coreDirector.getIdentityModel();null==i||i.set(t,e[t])}))}removeAlias(e){if((0,j.tI)("removeAlias",{label:e}),"string"!=typeof e)throw new eN.R("label",eN.Q.WrongType);if(!e)throw new eN.R("label",eN.Q.Empty);this.removeAliases([e])}removeAliases(e){if((0,j.tI)("removeAliases",{aliases:e}),!e||0===e.length)throw new eN.R("aliases",eN.Q.Empty);e.forEach(e=>(0,w.mG)(this,void 0,void 0,function*(){let t=OneSignal.coreDirector.getIdentityModel();null==t||t.set(e,void 0)}))}addEmail(e){return(0,w.mG)(this,void 0,void 0,function*(){var t,i,n;if((0,j.tI)("addEmail",{email:e}),"string"!=typeof e)throw new eN.R("email",eN.Q.WrongType);if(!e)throw new eN.R("email",eN.Q.Empty);if(!(0,j.vV)(e))throw new eN.R("email",eN.Q.Malformed);let o={type:T.Email,token:e},s=new tP(tO.Q.EmailSubscriptions,o);(null===(t=t_.singletonInstance)||void 0===t?void 0:t.isCreatingUser)||(null===(i=t_.singletonInstance)||void 0===i?void 0:i.hasOneSignalId)?(s.setOneSignalId(null===(n=t_.singletonInstance)||void 0===n?void 0:n.onesignalId),OneSignal.coreDirector.add(tO.Q.EmailSubscriptions,s,!0)):(OneSignal.coreDirector.add(tO.Q.EmailSubscriptions,s,!1),yield tA.createAndHydrateUser()),tA.updateModelWithCurrentUserOneSignalId(s).catch(e=>{throw e})})}addSms(e){return(0,w.mG)(this,void 0,void 0,function*(){var t,i,n;if((0,j.tI)("addSms",{sms:e}),"string"!=typeof e)throw new eN.R("sms",eN.Q.WrongType);if(!e)throw new eN.R("sms",eN.Q.Empty);let o={type:T.SMS,token:e},s=new tP(tO.Q.SmsSubscriptions,o);(null===(t=t_.singletonInstance)||void 0===t?void 0:t.isCreatingUser)||(null===(i=t_.singletonInstance)||void 0===i?void 0:i.hasOneSignalId)?(s.setOneSignalId(null===(n=t_.singletonInstance)||void 0===n?void 0:n.onesignalId),OneSignal.coreDirector.add(tO.Q.SmsSubscriptions,s,!0)):(OneSignal.coreDirector.add(tO.Q.SmsSubscriptions,s,!1),yield tA.createAndHydrateUser()),tA.updateModelWithCurrentUserOneSignalId(s).catch(e=>{throw e})})}removeEmail(e){if((0,j.tI)("removeEmail",{email:e}),"string"!=typeof e)throw new eN.R("email",eN.Q.WrongType);if(!e)throw new eN.R("email",eN.Q.Empty);let t=OneSignal.coreDirector.getEmailSubscriptionModels();Object.keys(t).forEach(i=>(0,w.mG)(this,void 0,void 0,function*(){var n;(null===(n=t[i].data)||void 0===n?void 0:n.token)===e&&OneSignal.coreDirector.remove(tO.Q.EmailSubscriptions,i)}))}removeSms(e){if((0,j.tI)("removeSms",{smsNumber:e}),"string"!=typeof e)throw new eN.R("smsNumber",eN.Q.WrongType);if(!e)throw new eN.R("smsNumber",eN.Q.Empty);let t=OneSignal.coreDirector.getSmsSubscriptionModels();Object.keys(t).forEach(i=>(0,w.mG)(this,void 0,void 0,function*(){var n;(null===(n=t[i].data)||void 0===n?void 0:n.token)===e&&OneSignal.coreDirector.remove(tO.Q.SmsSubscriptions,i)}))}addTag(e,t){if((0,j.tI)("addTag",{key:e,value:t}),"string"!=typeof e)throw new eN.R("key",eN.Q.WrongType);if("string"!=typeof t)throw new eN.R("value",eN.Q.WrongType);if(!e)throw new eN.R("key",eN.Q.Empty);if(!t)throw new eN.R("value",eN.Q.Empty,"Did you mean to call removeTag?");this.addTags({[e]:t})}addTags(e){var t;if((0,j.tI)("addTags",{tags:e}),"object"!=typeof e)throw new eN.R("tags",eN.Q.WrongType);if(!e)throw new eN.R("tags",eN.Q.Empty);let i=OneSignal.coreDirector.getPropertiesModel();e=Object.assign(Object.assign({},null===(t=null==i?void 0:i.data)||void 0===t?void 0:t.tags),e),null==i||i.set("tags",e)}removeTag(e){if((0,j.tI)("removeTag",{tagKey:e}),"string"!=typeof e)throw new eN.R("tagKey",eN.Q.WrongType);if(void 0===e)throw new eN.R("tagKey",eN.Q.Empty);this.removeTags([e])}removeTags(e){var t;if((0,j.tI)("removeTags",{tagKeys:e}),!e||0===e.length)throw new eN.R("tagKeys",eN.Q.Empty);let i=OneSignal.coreDirector.getPropertiesModel(),n=JSON.parse(JSON.stringify(null===(t=null==i?void 0:i.data)||void 0===t?void 0:t.tags));n&&(e.forEach(e=>{n[e]=""}),null==i||i.set("tags",n))}getTags(){var e,t;return(0,j.tI)("getTags"),null===(t=null===(e=OneSignal.coreDirector.getPropertiesModel())||void 0===e?void 0:e.data)||void 0===t?void 0:t.tags}}t_.singletonInstance=void 0;class tM{static isValidUrl(e,t){if(t&&t.allowNull&&null===e||t&&t.allowEmpty&&null==e)return!0;try{let i=new URL(e);return!t||!t.requireHttps||"https:"===i.protocol}catch(n){return!1}}static isValidBoolean(e,t){return!(!t||!t.allowNull||null!==e)||!0===e||!1===e}static isValidArray(e,t){return!(!t||!t.allowNull||null!==e)||!(!t||!t.allowEmpty||null!=e)||e instanceof Array}}class tD{}class tZ extends tD{constructor(e,t,i){super(),e&&t?(this._optedIn=!t.optedOut,this._permission=i,this._token=t.subscriptionToken,OneSignal.coreDirector.getPushSubscriptionModel().then(e=>{e&&tN(e.data)&&(this._id=e.data.id)}).catch(e=>{Q.Z.error(e)}),OneSignal.emitter.on(OneSignal.EVENTS.SUBSCRIPTION_CHANGED,e=>(0,w.mG)(this,void 0,void 0,function*(){this._id=null==e?void 0:e.current.id,this._token=null==e?void 0:e.current.token})),OneSignal.emitter.on(OneSignal.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_STRING,e=>(0,w.mG)(this,void 0,void 0,function*(){this._permission=e}))):Q.Z.warn(`PushSubscriptionNamespace: skipping initialization. One or more required params are falsy: initialize: ${e}, subscription: ${t}`)}get id(){return this._id}get token(){return this._token}get optedIn(){return!!this._optedIn&&"granted"===this._permission}optIn(){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("optIn"),yield(0,j.JX)(),this._optedIn=!0,"granted"===(yield OneSignal.context.permissionManager.getPermissionStatus())?yield this._enable(!0):yield OneSignal.Notifications.requestPermission()})}optOut(){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("optOut"),yield(0,j.JX)(),this._optedIn=!1,yield this._enable(!1)})}addEventListener(e,t){OneSignal.emitter.on(e,t)}removeEventListener(e,t){OneSignal.emitter.off(e,t)}_enable(e){return(0,w.mG)(this,void 0,void 0,function*(){yield(0,j.JX)();let t=yield eB.ZP.getAppConfig(),i=yield eB.ZP.getSubscription();if(!t.appId)throw new tu(tf.MissingAppId);if(!tM.isValidBoolean(e))throw new eN.R("enabled",eN.Q.Malformed);i.optedOut=!e,yield eB.ZP.setSubscription(i),tL.onInternalSubscriptionSet(i.optedOut).catch(e=>{Q.Z.error(e)}),tL.checkAndTriggerSubscriptionChanged().catch(e=>{Q.Z.error(e)})})}}var t8,tU,tG,tB,t1=i(680);class tF extends tD{constructor(e,t,i){super(),this.PushSubscription=new tZ(!1),e&&(this._currentUser=t_.createOrGetInstance(),this.PushSubscription=new tZ(!0,t,i))}get onesignalId(){var e;return null===(e=this._currentUser)||void 0===e?void 0:e.onesignalId}get externalId(){var e;let t=OneSignal.coreDirector.getIdentityModel();return null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.external_id}addAlias(e,t){var i;null===(i=this._currentUser)||void 0===i||i.addAlias(e,t)}addAliases(e){var t;null===(t=this._currentUser)||void 0===t||t.addAliases(e)}removeAlias(e){var t;null===(t=this._currentUser)||void 0===t||t.removeAlias(e)}removeAliases(e){var t;null===(t=this._currentUser)||void 0===t||t.removeAliases(e)}addEmail(e){var t;null===(t=this._currentUser)||void 0===t||t.addEmail(e)}removeEmail(e){var t;null===(t=this._currentUser)||void 0===t||t.removeEmail(e)}addSms(e){var t;null===(t=this._currentUser)||void 0===t||t.addSms(e)}removeSms(e){var t;null===(t=this._currentUser)||void 0===t||t.removeSms(e)}addTag(e,t){var i;null===(i=this._currentUser)||void 0===i||i.addTag(e,t)}addTags(e){var t;null===(t=this._currentUser)||void 0===t||t.addTags(e)}removeTag(e){var t;null===(t=this._currentUser)||void 0===t||t.removeTag(e)}removeTags(e){var t;null===(t=this._currentUser)||void 0===t||t.removeTags(e)}getTags(){var e;return(null===(e=this._currentUser)||void 0===e?void 0:e.getTags())||{}}addEventListener(e,t){tF.emitter.on(e,t)}removeEventListener(e,t){tF.emitter.on(e,t)}}tF.emitter=new t1.Z;class tL{static onNotificationPermissionChange(){tL.checkAndTriggerSubscriptionChanged()}static onInternalSubscriptionSet(e){return(0,w.mG)(this,void 0,void 0,function*(){td.put("subscription.optedOut",e)})}static checkAndTriggerSubscriptionChanged(){return(0,w.mG)(this,void 0,void 0,function*(){var e;Z.Z.logMethodCall("checkAndTriggerSubscriptionChanged");let t=OneSignal.context,i=yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled(),n=yield OneSignal.context.subscriptionManager.isOptedIn(),o=yield eB.ZP.getAppState(),{lastKnownPushEnabled:s,lastKnownPushId:r,lastKnownPushToken:a,lastKnownOptedIn:l}=o,d=yield tb.getCurrentPushToken(),c=yield OneSignal.coreDirector.getPushSubscriptionModel(),u=null===(e=null==c?void 0:c.data)||void 0===e?void 0:e.id;if(!(null===s||i!==s||d!==a||u!==r))return;yield t.subscriptionManager.updateNotificationTypes(),o.lastKnownPushEnabled=i,o.lastKnownPushToken=d,o.lastKnownPushId=u,o.lastKnownOptedIn=n,yield eB.ZP.setAppState(o);let h={previous:{id:r,token:a,optedIn:null==l||l},current:{id:u,token:d,optedIn:n}};Q.Z.info("Push Subscription state changed: ",h),tL.triggerSubscriptionChanged(h)})}static _onSubscriptionChanged(e){return(0,w.mG)(this,void 0,void 0,function*(){var t,i,n;tL.onSubscriptionChanged_showWelcomeNotification(null===(t=null==e?void 0:e.current)||void 0===t?void 0:t.optedIn,null===(i=null==e?void 0:e.current)||void 0===i?void 0:i.id),tL.onSubscriptionChanged_sendCategorySlidedownTags(null===(n=null==e?void 0:e.current)||void 0===n?void 0:n.optedIn),tL.onSubscriptionChanged_evaluateNotifyButtonDisplayPredicate(),tL.onSubscriptionChanged_updateCustomLink()})}static onSubscriptionChanged_sendCategorySlidedownTags(e){return(0,w.mG)(this,void 0,void 0,function*(){var t,i;if(!0!==e)return;let n=null===(i=null===(t=OneSignal.context.appConfig.userConfig.promptOptions)||void 0===t?void 0:t.slidedown)||void 0===i?void 0:i.prompts;eh.isCategorySlidedownConfigured(n)&&(yield OneSignal.context.tagManager.sendTags())})}static onSubscriptionChanged_showWelcomeNotification(e,t){return(0,w.mG)(this,void 0,void 0,function*(){var i;if(OneSignal.__doNotShowWelcomeNotification)return void Q.Z.debug("Not showing welcome notification because user has previously subscribed.");let n=null===(i=OneSignal.config)||void 0===i?void 0:i.userConfig.welcomeNotification;if(void 0!==n&&!0===n.disable||!0!==e||!t)return;let{appId:o}=yield eB.ZP.getAppConfig(),s=void 0!==n&&void 0!==n.title&&null!==n.title?n.title:"",r=void 0!==n&&void 0!==n.message&&null!==n.message&&n.message.length>0?n.message:"Thanks for subscribing!",a=new URL(location.href).origin+"?_osp=do_not_open",l=n&&n.url&&n.url.length>0?n.url:a;s=tc.decodeHtmlEntities(s),r=tc.decodeHtmlEntities(r),Q.Z.debug("Sending welcome notification."),et.sendNotification(o,[t],{en:s},{en:r},l,null,{__isOneSignalWelcomeNotification:!0},void 0),e1.Z.trigger(OneSignal.EVENTS.WELCOME_NOTIFICATION_SENT,{title:s,message:r,url:l})})}static onSubscriptionChanged_evaluateNotifyButtonDisplayPredicate(){return(0,w.mG)(this,void 0,void 0,function*(){if(!OneSignal.config.userConfig.notifyButton)return;let e=OneSignal.config.userConfig.notifyButton.displayPredicate;e&&"function"==typeof e&&OneSignal.notifyButton&&(!1!==(yield e())?(Q.Z.debug("Showing notify button because display predicate returned true."),OneSignal.notifyButton.launcher.show()):(Q.Z.debug("Hiding notify button because display predicate returned false."),OneSignal.notifyButton.launcher.hide()))})}static onSubscriptionChanged_updateCustomLink(){return(0,w.mG)(this,void 0,void 0,function*(){OneSignal.config.userConfig.promptOptions&&new tl(OneSignal.config.userConfig.promptOptions.customlink).initialize()})}static triggerSubscriptionChanged(e){e1.Z.trigger(OneSignal.EVENTS.SUBSCRIPTION_CHANGED,e)}static triggerUserChanged(e){e1.Z.trigger(OneSignal.EVENTS.SUBSCRIPTION_CHANGED,e,tF.emitter)}static triggerNotificationClick(e){let t={notification:e.notification,result:e.result};return e1.Z.trigger(OneSignal.EVENTS.NOTIFICATION_CLICKED,t)}static fireStoredNotificationClicks(){return(0,w.mG)(this,void 0,void 0,function*(){yield(0,j.JX)();let e=OneSignal.config.pageUrl||OneSignal.config.userConfig.pageUrl||document.URL;function t(e){return(0,w.mG)(this,void 0,void 0,function*(){let t=yield eB.ZP.getAppState();t.pendingNotificationClickEvents[e.result.url]=null,yield eB.ZP.setAppState(t);let i=e.timestamp;!(i&&(Date.now()-i)/1e3/60>5)&&tL.triggerNotificationClick(e)})}let i=yield eB.ZP.getAppState();if("origin"===(yield eB.ZP.get("Options","notificationClickHandlerMatch"))){for(let n of Object.keys(i.pendingNotificationClickEvents))if(new URL(n).origin===location.origin){let o=i.pendingNotificationClickEvents[n];yield t(o)}}else{let s=i.pendingNotificationClickEvents[e];if(s)yield t(s);else if(!s&&e.endsWith("/")){let r=e.substring(0,e.length-1);(s=i.pendingNotificationClickEvents[r])&&(yield t(s))}}})}static checkAndTriggerUserChanged(){return(0,w.mG)(this,void 0,void 0,function*(){var e;Z.Z.logMethodCall("checkAndTriggerUserChanged");let t=yield eB.ZP.getUserState(),{previousOneSignalId:i,previousExternalId:n}=t,o=yield OneSignal.coreDirector.getIdentityModel(),s=null==o?void 0:o.onesignalId,r=null===(e=null==o?void 0:o.data)||void 0===e?void 0:e.external_id;if(!(s!==i||r!==n))return;t.previousOneSignalId=s,t.previousExternalId=r,yield eB.ZP.setUserState(t);let a={current:{onesignalId:s,externalId:r}};Q.Z.info("User state changed: ",a),tL.triggerUserChanged(a)})}}class tW{constructor(e,t){this.context=e,this.config=t}getRegistration(){return(0,w.mG)(this,void 0,void 0,function*(){return yield eA.getRegistration(this.config.registrationOptions.scope)})}getActiveState(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield this.context.serviceWorkerManager.getRegistration();if(!e)return e3.None;let t=tW.activeSwFileName(e);return this.swActiveStateByFileName(t)})}static activeSwFileName(e){let t=eA.getAvailableServiceWorker(e);if(!t)return null;let i=new URL(t.scriptURL).pathname,n=new eG(i).getFileName();if("akam-sw.js"==n){let o=new URLSearchParams(new URL(t.scriptURL).search).get("othersw");if(o)return Q.Z.debug("Found a ServiceWorker under Akamai's akam-sw.js?othersw=",o),new eG(new URL(o).pathname).getFileName()}return n}swActiveStateByFileName(e){return e?e==this.config.workerPath.getFileName()||"OneSignalSDK.sw.js"==e?e3.OneSignalWorker:e3.ThirdParty:e3.None}getWorkerVersion(){return(0,w.mG)(this,void 0,void 0,function*(){return new Promise(e=>(0,w.mG)(this,void 0,void 0,function*(){this.context.workerMessenger.once(ex.WorkerVersion,t=>{e(t)}),yield this.context.workerMessenger.unicast(ex.WorkerVersion)}))})}shouldInstallWorker(){return(0,w.mG)(this,void 0,void 0,function*(){if(!B.Z.supportsServiceWorkers()||!OneSignal.config)return!1;let e=yield this.getActiveState();if(Q.Z.debug("[shouldInstallWorker] workerState",e),e===e3.None||e===e3.ThirdParty){let t="granted"===(yield OneSignal.context.permissionManager.getNotificationPermission(OneSignal.config.safariWebId));return t&&Q.Z.info("[shouldInstallWorker] Notification Permissions enabled, will install ServiceWorker"),t}return!!(yield this.haveParamsChanged())||this.workerNeedsUpdate()})}haveParamsChanged(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield this.context.serviceWorkerManager.getRegistration();if(!e)return Q.Z.info("[changedServiceWorkerParams] workerRegistration not found at scope",this.config.registrationOptions.scope),!0;let t=new URL(e.scope).pathname,i=this.config.registrationOptions.scope;if(t!=i)return Q.Z.info("[changedServiceWorkerParams] ServiceWorker scope changing",{a_old:t,b_new:i}),!0;let n=eA.getAvailableServiceWorker(e),o=e9.getServiceWorkerHref(this.config,this.context.appConfig.appId,B.Z.version());return!(null==n?void 0:n.scriptURL)||o!==n.scriptURL&&(Q.Z.info("[changedServiceWorkerParams] ServiceWorker href changing:",{a_old:null==n?void 0:n.scriptURL,b_new:o}),!0)})}workerNeedsUpdate(){return(0,w.mG)(this,void 0,void 0,function*(){let e;Q.Z.info("[Service Worker Update] Checking service worker version...");try{e=yield E.c.timeoutPromise(this.getWorkerVersion(),2e3)}catch(t){return Q.Z.info("[Service Worker Update] Worker did not reply to version query; assuming older version and updating."),!0}return e!==B.Z.version()?(Q.Z.info(`[Service Worker Update] Updating service worker from ${e} --> ${B.Z.version()}.`),!0):(Q.Z.info(`[Service Worker Update] Service worker version is current at ${e} (no update required).`),!1)})}establishServiceWorkerChannel(){return(0,w.mG)(this,void 0,void 0,function*(){Q.Z.debug("establishServiceWorkerChannel");let e=this.context.workerMessenger;e.off(),e.on(ex.NotificationWillDisplay,e=>(0,w.mG)(this,void 0,void 0,function*(){Q.Z.debug(location.origin,"Received notification display event from service worker.");let t={notification:e.notification,preventDefault:function(){throw Error("Browser does not support preventing display.")}};yield e1.Z.trigger(OneSignal.EVENTS.NOTIFICATION_WILL_DISPLAY,t)})),e.on(ex.NotificationClicked,e=>(0,w.mG)(this,void 0,void 0,function*(){if(0===OneSignal.emitter.numberOfListeners(OneSignal.EVENTS.NOTIFICATION_CLICKED)){Q.Z.debug("notification.clicked event received, but no event listeners; storing event in IndexedDb for later retrieval.");let t=e.result.url;t||(t=location.href),yield eB.ZP.putNotificationClickedEventPendingUrlOpening(e)}else yield tL.triggerNotificationClick(e)})),e.on(ex.NotificationDismissed,e=>(0,w.mG)(this,void 0,void 0,function*(){yield e1.Z.trigger(OneSignal.EVENTS.NOTIFICATION_DISMISSED,e)}));let t=Z.Z.isSafari();e.on(ex.AreYouVisible,i=>(0,w.mG)(this,void 0,void 0,function*(){if(t){let n={timestamp:i.timestamp,focused:document.hasFocus()};yield e.directPostMessageToSW(ex.AreYouVisibleResponse,n)}}))})}installWorker(){return(0,w.mG)(this,void 0,void 0,function*(){if(!(yield this.shouldInstallWorker()))return this.getRegistration();Q.Z.info("Installing worker..."),(yield this.getActiveState())===e3.ThirdParty&&Q.Z.info("[Service Worker Installation] 3rd party service worker detected.");let e=e9.getServiceWorkerHref(this.config,this.context.appConfig.appId,B.Z.version()),t=`${Z.Z.getBaseUrl()}${this.config.registrationOptions.scope}`,i;Q.Z.info(`[Service Worker Installation] Installing service worker ${e} ${t}.`);try{i=yield navigator.serviceWorker.register(e,{scope:t})}catch(n){Q.Z.error(`[Service Worker Installation] Installing service worker failed ${n}`),i=yield this.fallbackToUserModelBetaWorker()}return Q.Z.debug("[Service Worker Installation] Service worker installed. Waiting for activation"),yield eA.waitUntilActive(i),Q.Z.debug("[Service Worker Installation] Service worker active"),yield this.establishServiceWorkerChannel(),i})}fallbackToUserModelBetaWorker(){return(0,w.mG)(this,void 0,void 0,function*(){let e="OneSignalSDK.sw.js",t={workerPath:new eG(`/${e}`),registrationOptions:this.config.registrationOptions},i=e9.getServiceWorkerHref(t,this.context.appConfig.appId,B.Z.version()),n=`${Z.Z.getBaseUrl()}${this.config.registrationOptions.scope}`;Q.Z.info(`[Service Worker Installation] Attempting to install v16 Beta Worker ${i} ${n}.`);try{let o=yield navigator.serviceWorker.register(i,{scope:n}),s=`
        [Service Worker Installation] Successfully installed v16 Beta Worker.
        Deprecation warning: support for the v16 beta worker name of ${e}
        will be removed May 5 2024. We have decided to keep the v15 name.
        To avoid breaking changes for your users, please host both worker files:
        OneSignalSDK.sw.js & OneSignalSDKWorker.js.
      `;return Q.Z.error(s),o}catch(r){let a=yield fetch(i);if(403===a.status||404===a.status)throw new eL(a.status,a.statusText);throw r}})}}(n=tU||(tU={})).Default="default",n.Granted="granted",n.Denied="denied";class tV extends R.Z{constructor(){super("This code is not implemented yet."),Object.setPrototypeOf(this,tV.prototype)}}(o=tG||(tG={}))[o.Blocked=0]="Blocked",o[o.Dismissed=1]="Dismissed",o[o.Default=2]="Default";class tR extends R.Z{constructor(e){let t;switch(e){case tG.Dismissed:t="The user dismissed the permission prompt.";break;case tG.Blocked:t="Notification permissions are blocked.";break;case tG.Default:t="Notification permissions have not been granted yet."}super(t),this.reason=e,Object.setPrototypeOf(this,tR.prototype)}}(s=tB||(tB={}))[s.InvalidSafariSetup=0]="InvalidSafariSetup",s[s.Blocked=1]="Blocked",s[s.Dismissed=2]="Dismissed";class t0 extends R.Z{constructor(e){let t;switch(e){case tB.InvalidSafariSetup:t="The Safari site URL, icon size, or push certificate is invalid, or Safari is in a private session.";break;case tB.Blocked:t="Notification permissions are blocked.";break;case tB.Dismissed:t="The notification permission prompt was dismissed."}super(t),Object.setPrototypeOf(this,t0.prototype)}}class t4{static setFromW3cSubscription(e){let t=new t4;if(e&&(t.w3cEndpoint=new URL(e.endpoint),e.getKey)){let i=null;try{i=e.getKey("p256dh")}catch(n){}let o=null;try{o=e.getKey("auth")}catch(s){}if(i){let r=btoa(String.fromCharCode.apply(null,new Uint8Array(i)));t.w3cP256dh=r}if(o){let a=btoa(String.fromCharCode.apply(null,new Uint8Array(o)));t.w3cAuth=a}}return t}setFromSafariSubscription(e){e&&(this.safariDeviceToken=e)}serialize(){return{w3cEndpoint:this.w3cEndpoint?this.w3cEndpoint.toString():null,w3cP256dh:this.w3cP256dh,w3cAuth:this.w3cAuth,safariDeviceToken:this.safariDeviceToken}}static deserialize(e){let t=new t4;if(!e)return t;try{t.w3cEndpoint=new URL(e.w3cEndpoint)}catch(i){}return t.w3cP256dh=e.w3cP256dh,t.w3cAuth=e.w3cAuth,t.safariDeviceToken=e.safariDeviceToken,t}}class t3{constructor(e,t){this.safariPermissionPromptFailed=!1,this.context=e,this.config=t}isPushNotificationsEnabled(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield this.getSubscriptionState();return e.subscribed&&!e.optedOut})}isOptedIn(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield this.getSubscriptionState();return"granted"===(yield OneSignal.context.permissionManager.getPermissionStatus())&&!e.optedOut})}isOptedOut(e){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("isOptedOut",e);let{optedOut:t}=yield eB.ZP.getSubscription();return(0,j.IV)(e,t),t})}subscribe(e){return(0,w.mG)(this,void 0,void 0,function*(){let t;switch(A.Z.getWindowEnv()){case _.Q.ServiceWorker:t=yield this.subscribeFcmFromWorker(e);break;case _.Q.Host:if((yield OneSignal.context.permissionManager.getPermissionStatus())===tU.Denied)throw new tR(tG.Blocked);if(B.Z.useSafariLegacyPush()){yield this._updatePushSubscriptionModelWithRawSubscription(t=yield this.subscribeSafari()),Q.Z.info("Installing SW on Safari");try{yield this.context.serviceWorkerManager.installWorker(),Q.Z.info("SW on Safari successfully installed")}catch(i){Q.Z.error("SW on Safari failed to install.")}}else yield this._updatePushSubscriptionModelWithRawSubscription(t=yield this.subscribeFcmFromPage(e));break;default:throw new tu(tf.UnsupportedEnvironment)}return t})}_updatePushSubscriptionModelWithRawSubscription(e){return(0,w.mG)(this,void 0,void 0,function*(){let t=yield OneSignal.coreDirector.getPushSubscriptionModel();if(!t)return OneSignal.coreDirector.generatePushSubscriptionModel(e),void(yield tA.createAndHydrateUser());{let i=new F(e).serialize(),n=Object.keys(i);for(let o=0;o<n.length;o++){let s=n[o];i[s]&&t.set(s,i[s])}}})}updateNotificationTypes(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield this.getNotificationTypes();yield this.updatePushSubscriptionNotificationTypes(e)})}getNotificationTypes(){return(0,w.mG)(this,void 0,void 0,function*(){let{optedOut:e}=yield eB.ZP.getSubscription();return e?M.UserOptedOut:"granted"===(yield OneSignal.context.permissionManager.getPermissionStatus())?M.Subscribed:M.NoNativePermission})}updatePushSubscriptionNotificationTypes(e){return(0,w.mG)(this,void 0,void 0,function*(){let t=yield OneSignal.coreDirector.getPushSubscriptionModel();t?(t.set("notification_types",e),t.set("enabled",e===M.Subscribed)):Q.Z.info("No Push Subscription yet to update notification_types.")})}registerSubscription(e,t){return(0,w.mG)(this,void 0,void 0,function*(){e&&(e=t4.deserialize(e)),(yield this.isAlreadyRegisteredWithOneSignal())?yield this.context.updateManager.sendPushDeviceRecordUpdate():this.context.sessionManager.upsertSession(e2.eB.UserCreate);let t=yield eB.ZP.getSubscription();return t.deviceId="99999999-9999-9999-9999-999999999999",t.optedOut=!1,e?B.Z.useSafariLegacyPush()?t.subscriptionToken=e.safariDeviceToken:t.subscriptionToken=e.w3cEndpoint?e.w3cEndpoint.toString():null:t.subscriptionToken=null,yield eB.ZP.setSubscription(t),A.Z.getWindowEnv()!==_.Q.ServiceWorker&&e1.Z.trigger(OneSignal.EVENTS.REGISTERED),"undefined"!=typeof OneSignal&&(OneSignal._sessionInitAlreadyRunning=!1),t})}static requestPresubscribeNotificationPermission(){return(0,w.mG)(this,void 0,void 0,function*(){return yield t3.requestNotificationPermission()})}unsubscribe(e){return(0,w.mG)(this,void 0,void 0,function*(){if(0===e||1!==e||A.Z.getWindowEnv()!==_.Q.ServiceWorker)throw new tV;yield eB.ZP.put("Options",{key:"optedOut",value:!0})})}static requestNotificationPermission(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield window.Notification.requestPermission();return tU[e]})}isAlreadyRegisteredWithOneSignal(){return(0,w.mG)(this,void 0,void 0,function*(){let{deviceId:e}=yield eB.ZP.getSubscription();return!!e})}subscribeSafariPromptPermission(){return(0,w.mG)(this,void 0,void 0,function*(){var e;return e=this.safariPermissionPromptFailed?`${A.Z.getOneSignalApiUrl().toString()}/safari`:`${A.Z.getOneSignalApiUrl().toString()}/safari/apps/${this.config.appId}`,new Promise(t=>{window.safari.pushNotification.requestPermission(e,this.config.safariWebId,{app_id:this.config.appId},e=>{e&&e.deviceToken?t(e.deviceToken.toLowerCase()):t(null)})})})}subscribeSafari(){return(0,w.mG)(this,void 0,void 0,function*(){let e=new t4;if(!this.config.safariWebId)throw new X(eI.MissingSafariWebId);let{deviceToken:t}=window.safari.pushNotification.permission(this.config.safariWebId);if(t)return e.setFromSafariSubscription(t.toLowerCase()),e;e1.Z.trigger(OneSignal.EVENTS.PERMISSION_PROMPT_DISPLAYED);let i=yield this.subscribeSafariPromptPermission();if(t$.Q.triggerNotificationPermissionChanged(),!i)throw this.safariPermissionPromptFailed=!0,new t0(tB.InvalidSafariSetup);return e.setFromSafariSubscription(i),e})}subscribeFcmFromPage(e){return(0,w.mG)(this,void 0,void 0,function*(){if(A.Z.getWindowEnv()===_.Q.Host&&Notification.permission===tU.Default){yield e1.Z.trigger(OneSignal.EVENTS.PERMISSION_PROMPT_DISPLAYED);let t=yield t3.requestPresubscribeNotificationPermission(),i=t===tU.Default;switch(yield t$.Q.triggerNotificationPermissionChanged(i),t){case tU.Default:throw Q.Z.debug("Exiting subscription and not registering worker because the permission was dismissed."),OneSignal._sessionInitAlreadyRunning=!1,new tR(tG.Dismissed);case tU.Denied:throw Q.Z.debug("Exiting subscription and not registering worker because the permission was blocked."),OneSignal._sessionInitAlreadyRunning=!1,new tR(tG.Blocked)}}let n;try{n=yield this.context.serviceWorkerManager.installWorker()}catch(o){throw o instanceof eL&&(403===o.status?yield this.context.subscriptionManager.registerFailedSubscription(M.ServiceWorkerStatus403,this.context):404===o.status&&(yield this.context.subscriptionManager.registerFailedSubscription(M.ServiceWorkerStatus404,this.context))),o}if(!n)throw Error("OneSignal service worker not found!");return Q.Z.debug("[Subscription Manager] Service worker is ready to continue subscribing."),yield this.subscribeWithVapidKey(n.pushManager,e)})}subscribeFcmFromWorker(e){return(0,w.mG)(this,void 0,void 0,function*(){let t=self.registration;if(!t.active&&"firefox"!==(0,P.M)().name)throw new tu(tf.ServiceWorkerNotActivated);let i=yield t.pushManager.permissionState({userVisibleOnly:!0});if("denied"===i)throw new tR(tG.Blocked);if("prompt"===i)throw new tR(tG.Default);return yield this.subscribeWithVapidKey(t.pushManager,e)})}getVapidKeyForBrowser(){let e;return(e="firefox"===(0,P.M)().name?this.config.onesignalVapidPublicKey:this.config.vapidPublicKey)?function(e){let t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),i=atob(t),n=new Uint8Array(i.length);for(let o=0;o<i.length;++o)n[o]=i.charCodeAt(o);return n}(e).buffer:void 0}subscribeWithVapidKey(e,t){return(0,w.mG)(this,void 0,void 0,function*(){let i=yield e.getSubscription();switch(t){case 0:if(!i)break;i.options?Q.Z.debug("[Subscription Manager] An existing push subscription exists and it's options is not null."):(Q.Z.debug("[Subscription Manager] An existing push subscription exists and options is null. Unsubscribing from push first now."),yield t3.doPushUnsubscribe(i));break;case 1:i&&(yield t3.doPushUnsubscribe(i))}let[n,o]=yield t3.doPushSubscribe(e,this.getVapidKeyForBrowser());return yield t3.updateSubscriptionTime(o,n.expirationTime),t4.setFromW3cSubscription(n)})}static updateSubscriptionTime(e,t){return(0,w.mG)(this,void 0,void 0,function*(){let i=yield eB.ZP.getSubscription();e&&(i.createdAt=(new Date).getTime()),i.expirationTime=t,yield eB.ZP.setSubscription(i)})}static doPushUnsubscribe(e){return(0,w.mG)(this,void 0,void 0,function*(){Q.Z.debug("[Subscription Manager] Unsubscribing existing push subscription.");let t=yield e.unsubscribe();return Q.Z.debug(`[Subscription Manager] Unsubscribing existing push subscription result: ${t}`),t})}static doPushSubscribe(e,t){return(0,w.mG)(this,void 0,void 0,function*(){if(!t)throw Error("Missing required 'applicationServerKey' to subscribe for push notifications!");let i={userVisibleOnly:!0,applicationServerKey:t};Q.Z.debug("[Subscription Manager] Subscribing to web push with these options:",i);try{let n=yield e.getSubscription();return[(yield e.subscribe(i)),!n]}catch(o){if("InvalidStateError"==o.name){Q.Z.warn("[Subscription Manager] Couldn't re-subscribe due to applicationServerKey changing, unsubscribe and attempting to subscribe with new key.",o);let s=yield e.getSubscription();return s&&(yield t3.doPushUnsubscribe(s)),[(yield e.subscribe(i)),!0]}throw o}})}isSubscriptionExpiring(){return(0,w.mG)(this,void 0,void 0,function*(){if((yield this.context.serviceWorkerManager.getActiveState())!==e3.OneSignalWorker)return!1;let e=yield this.context.serviceWorkerManager.getRegistration();if(!e||!e.pushManager)return!1;let t=yield e.pushManager.getSubscription();if(!t||!t.expirationTime)return!1;let{createdAt:i}=yield eB.ZP.getSubscription();i||(i=(new Date).getTime()+31536e6);let n=i+(t.expirationTime-i)/2;return!!t.expirationTime&&((new Date).getTime()>=t.expirationTime||(new Date).getTime()>=n)})}getSubscriptionState(){return(0,w.mG)(this,void 0,void 0,function*(){if(A.Z.getWindowEnv()===_.Q.ServiceWorker){let e=yield self.registration.pushManager.getSubscription(),{optedOut:t}=yield eB.ZP.getSubscription();return{subscribed:!!e,optedOut:!!t}}return this.getSubscriptionStateFromBrowserContext()})}getSubscriptionStateFromBrowserContext(){return(0,w.mG)(this,void 0,void 0,function*(){var e,t;let{optedOut:i,subscriptionToken:n}=yield eB.ZP.getSubscription(),o=yield OneSignal.coreDirector.getPushSubscriptionModel(),s=tN(null==o?void 0:o.data)&&!!(null==o?void 0:o.onesignalId);if(B.Z.useSafariLegacyPush()){let r=null===(t=null===(e=window.safari)||void 0===e?void 0:e.pushNotification)||void 0===t?void 0:t.permission(this.config.safariWebId);return{subscribed:!!(s&&n&&"granted"===(null==r?void 0:r.permission)&&(null==r?void 0:r.deviceToken)),optedOut:!!i}}let a=yield this.context.serviceWorkerManager.getActiveState(),l=yield this.context.serviceWorkerManager.getRegistration(),d=yield this.context.permissionManager.getNotificationPermission(this.context.appConfig.safariWebId),c=a===e3.OneSignalWorker;return l?{subscribed:!!(s&&n&&d===tU.Granted&&c),optedOut:!!i}:{subscribed:!1,optedOut:!!i}})}registerFailedSubscription(e,t){return(0,w.mG)(this,void 0,void 0,function*(){t.pageViewManager.isFirstPageView()&&(t.subscriptionManager.registerSubscription(new t4,e),t.pageViewManager.incrementPageViewCount())})}}let t2=class{static getServiceWorkerManager(e){let t=e.appConfig,i={workerPath:new eG("OneSignalSDKWorker.js"),registrationOptions:{scope:"/"}};return t.userConfig&&(t.userConfig.path&&(i.workerPath=new eG(`${t.userConfig.path}${t.userConfig.serviceWorkerPath}`)),t.userConfig.serviceWorkerParam&&(i.registrationOptions=t.userConfig.serviceWorkerParam)),new tW(e,i)}static getSubscriptionManager(e){let t=e.appConfig,i={safariWebId:t.safariWebId,appId:t.appId,vapidPublicKey:t.vapidPublicKey,onesignalVapidPublicKey:t.onesignalVapidPublicKey};return new t3(e,i)}};function t9(e){return`<svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="24px" height="24px" fill="${e}"> <g transform="rotate(0 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.916s" repeatCount="indefinite"/> </rect> </g> <g transform="rotate(30 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.833s" repeatCount="indefinite"/> </rect> </g> <g transform="rotate(60 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.75s" repeatCount="indefinite"/> </rect> </g> <g transform="rotate(90 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.666s"/> </rect> </g> <g transform="rotate(120 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.583s"/> </rect> </g> <g transform="rotate(150 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.5s"/> </rect> </g> <g transform="rotate(180 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.416s"/> </rect> </g> <g transform="rotate(210 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.333s"/> </rect> </g> <g transform="rotate(240 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.25s"/> </rect> </g> <g transform="rotate(270 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.166s"/> </rect> </g> <g transform="rotate(300 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.083s"/> </rect> </g> <g transform="rotate(330 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="0s"/> </rect> </g> </svg>`}class t6{mount(e,t){let i=this.generateHtml(e,t);(0,j.gd)(`#${e7.body}`).appendChild(i),this.taggingContainer&&this.taggingContainer.addEventListener("change",this.toggleCheckedTag);let n=(0,j.gd)(`#${e7.allowButton}`);n.disabled=!1,(0,j.BH)(n,"disabled"),(0,j.tf)(`#${e7.loadingContainer}`)}load(){let e=(0,j.gd)(`#${e7.loadingContainer}`),t=(0,j.gd)(`#${e7.allowButton}`),i=document.createElement("div");(0,j.bF)(e,`${e6.loadingContainer}`),(0,j.bF)(i,"onesignal-loading-message"),(0,j.bF)(t,"disabled"),(0,j.IM)(e,"beforeend",t9("#95A1AC")),i.innerText="Fetching your preferences",e.appendChild(i),t.disabled=!0}generateHtml(e,t){let i=eu.getCheckedTagCategories(e,t),n=i.filter(e=>i.indexOf(e)%2==0),o=i.filter(e=>i.indexOf(e)%2),s=document.createElement("div"),r=document.createElement("div"),a=document.createElement("div");return(0,j.bF)(s,eq),(0,j.bF)(r,eq),(0,j.bF)(a,eQ),a.id="tagging-container",n.forEach(e=>{s.appendChild(this.getCategoryLabelElement(e))}),o.forEach(e=>{r.appendChild(this.getCategoryLabelElement(e))}),a.appendChild(s),a.appendChild(r),a}getCategoryLabelElement(e){let{label:t}=e,i=document.createElement("label"),n=document.createElement("span"),o=document.createElement("input"),s=document.createElement("span"),r=document.createElement("div"),a=document.createElement("div");return(0,j.bF)(i,"onesignal-category-label"),(0,j.bF)(n,"onesignal-category-label-text"),(0,j.bF)(o,"onesignal-category-label-input"),(0,j.bF)(s,"onesignal-checkmark"),i.title=t,n.innerText=t,o.type="checkbox",o.value=e.tag,o.checked=!!e.checked,i.appendChild(n),i.appendChild(o),i.appendChild(s),r.setAttribute("style","clear:both"),a.appendChild(i),a.appendChild(r),a}get taggingContainer(){let e=`#${e7.body} > div.${eQ}`;return(0,j.gd)(e)}toggleCheckedTag(e){let t=e.target;if(t&&"checkbox"===t.getAttribute("type")){let i=t.checked;t.setAttribute("checked",i.toString())}}static getValuesFromTaggingContainer(){let e=`#${e7.body} > div.${eQ}> div > div > label > input[type=checkbox]`,t=document.querySelectorAll(e),i={};return t.forEach(e=>{i[e.value]=e.checked}),i}}(r=p||(p={})).Stylesheet="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/css/intlTelInput.min.css",r.Main="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/js/intlTelInput.min.js",r.Utils="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/js/utils.js",(a=g||(g={})).Stylesheet="sha512-yye/u0ehQsrVrfSd6biT17t39Rg9kNc+vENcCXZuMz2a+LWFGvXUnYuWUW6pbfYj1jcBb/C39UZw2ciQvwDDvg==",a.Main="sha512-OnkjbJ4TwPpgSmjXACCb5J4cJwi880VRe+vWpPDlr8M38/L3slN5uUAeOeWU2jN+4vN0gImCXFGdJmc0wO4Mig==",a.Utils="sha512-bUcJxlqkiGA3cmoYPuZaLRsyc5ChG9APG4ajom2AXKSlBtOmx4kLV3c8uv/6uSz43FMjI4Q2QI21+D223rT76w==";class t7{constructor(e){this.smsInputFieldIsValid=!0,this.emailInputFieldIsValid=!0,this.promptOptions=e}generateHtml(){let e=document.createElement("div"),t,i,n;switch((0,j.bF)(e,ej),e.id=ej,this.promptOptions.type){case eE.Sms:t=this.promptOptions.text.smsLabel||"Phone Number",i=this.getInputWithValidationElement(eE.Sms,t),e.appendChild(i);break;case eE.Email:t=this.promptOptions.text.emailLabel||"Email",n=this.getInputWithValidationElement(eE.Email,t),e.appendChild(n);break;case eE.SmsAndEmail:t=this.promptOptions.text.emailLabel||"Email",n=this.getInputWithValidationElement(eE.Email,t),e.appendChild(n),t=this.promptOptions.text.smsLabel||"Phone Number",i=this.getInputWithValidationElement(eE.Sms,t),e.appendChild(i)}return e}getValidationElementWithMessage(e){let t=document.createElement("div"),i=document.createElement("img"),n=document.createElement("p");return n.innerText=e,i.setAttribute("src","data:image/svg+xml;charset=UTF-8,%3csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M7.98775 -0.00114406C5.85015 0.0338508 3.81219 0.908665 2.31442 2.43419C1.565 3.18031 0.973715 4.06987 0.575897 5.04969C0.17808 6.02952 -0.0180997 7.07949 -0.000914196 8.13686C-0.00214385 9.17005 0.200528 10.1933 0.595487 11.148C0.990446 12.1028 1.56993 12.9702 2.30072 13.7005C3.03151 14.4309 3.89925 15.0098 4.85421 15.4042C5.80916 15.7986 6.83256 16.0007 7.86575 15.9989H8.00842C10.1467 15.9769 12.1889 15.1075 13.6869 13.5816C15.185 12.0557 16.0165 9.99781 15.9991 7.85952C16.0015 6.8138 15.7949 5.77814 15.3913 4.81345C14.9876 3.84876 14.3952 2.97451 13.6488 2.24213C12.9023 1.50974 12.017 0.933994 11.0448 0.548751C10.0726 0.163508 9.03324 -0.0234551 7.98775 -0.00114406ZM6.99909 11.0269C6.99428 10.8961 7.01558 10.7658 7.06175 10.6434C7.10792 10.521 7.17803 10.4091 7.26797 10.3141C7.35792 10.2191 7.4659 10.143 7.58559 10.0903C7.70529 10.0375 7.8343 10.0092 7.96509 10.0069H7.98309C8.24616 10.0074 8.49882 10.1097 8.6881 10.2924C8.87739 10.4751 8.9886 10.724 8.99842 10.9869C9.00331 11.1176 8.98207 11.248 8.93594 11.3704C8.8898 11.4928 8.8197 11.6048 8.72974 11.6998C8.63978 11.7948 8.53176 11.8709 8.41202 11.9236C8.29229 11.9763 8.16323 12.0046 8.03242 12.0069H8.01442C7.75145 12.006 7.49897 11.9036 7.30976 11.721C7.12054 11.5383 7.00923 11.2896 6.99909 11.0269ZM7.33242 8.33219V4.33219C7.33242 4.15538 7.40266 3.98581 7.52768 3.86079C7.65271 3.73576 7.82227 3.66552 7.99909 3.66552C8.1759 3.66552 8.34547 3.73576 8.47049 3.86079C8.59551 3.98581 8.66575 4.15538 8.66575 4.33219V8.33219C8.66575 8.509 8.59551 8.67857 8.47049 8.80359C8.34547 8.92862 8.1759 8.99886 7.99909 8.99886C7.82227 8.99886 7.65271 8.92862 7.52768 8.80359C7.40266 8.67857 7.33242 8.509 7.33242 8.33219Z' fill='%23E54B4D'/%3e%3c/svg%3e"),t.appendChild(i),t.appendChild(n),t}getInputWithValidationElement(e,t){let i=this.getTypeSpecificVariablesForValidationElemGeneration(e),n=document.createElement("label"),o=document.createElement("input"),s=document.createElement("div"),r=document.createElement("div"),a=this.getValidationElementWithMessage(i.message),l=document.createElement("div");return s.setAttribute("style","clear:both"),r.setAttribute("style","clear:both"),(0,j.bF)(a,ez),(0,j.bF)(a,"onesignal-validation-element"),a.id=i.validationElementId,n.title=t,n.innerText=t,n.htmlFor=i.inputElementId,o.type=i.domElementType,o.id=i.inputElementId,o.tabIndex=i.tabIndex,(0,j.bF)(o,i.inputClass),(0,j.bF)(l,"input-with-validation-element"),l.id=i.wrappingDivId,l.appendChild(n),l.appendChild(s),l.appendChild(o),l.appendChild(r),l.appendChild(a),l}getTypeSpecificVariablesForValidationElemGeneration(e){if(e===eE.Email)return{message:"Please enter a valid email",domElementType:"email",validationElementId:ti,inputElementId:te,inputClass:"onesignal-email-input",wrappingDivId:eY,tabIndex:1};if(e===eE.Sms)return{message:"Please enter a valid phone number",domElementType:"tel",validationElementId:tt,inputElementId:eX,inputClass:"iti-onesignal-sms-input",wrappingDivId:eJ,tabIndex:2};throw Error("invalid channel type for input validation")}initializePhoneInputLibrary(){let e=(0,j.gd)(`#${eX}`);e&&window.intlTelInput?this.itiOneSignal=window.intlTelInput(e,{autoPlaceholder:"off",separateDialCode:!0}):Q.Z.error("OneSignal: there was a problem initializing International Telephone Input")}addSmsInputEventListeners(){let e=(0,j.gd)(`#${eX}`);e.addEventListener("keyup",t=>{var i;this.smsInputFieldIsValid=this.itiOneSignal.isValidNumber()||""===(null==e?void 0:e.value),"Enter"===t.key&&(null===(i=document.getElementById(e7.allowButton))||void 0===i||i.click()),this.updateValidationOnSmsInputChange()}),e.addEventListener("blur",()=>{this.smsInputFieldIsValid=this.itiOneSignal.isValidNumber()||""===(null==e?void 0:e.value),this.updateValidationOnSmsInputChange()})}addEmailInputEventListeners(){let e=(0,j.gd)(`#${te}`);e.addEventListener("keyup",t=>{var i;let n=null==e?void 0:e.value;this.emailInputFieldIsValid=t7.validateEmailInputWithReturnVal(n),"Enter"===t.key&&(null===(i=document.getElementById(e7.allowButton))||void 0===i||i.click()),this.updateValidationOnEmailInputChange()})}updateValidationOnSmsInputChange(){let e=(0,j.gd)(`#${eJ}`),t=(0,j.gd)(`#${tt}`);(0,j.BH)(e,eK),(0,j.bF)(t,ez)}updateValidationOnEmailInputChange(){let e=(0,j.gd)(`#${eY}`),t=(0,j.gd)(`#${ti}`);(0,j.BH)(e,eK),(0,j.bF)(t,ez)}loadPhoneLibraryScripts(){return(0,w.mG)(this,void 0,void 0,function*(){if(OneSignal._didLoadITILibrary)return;let e=document.createElement("script"),t=document.createElement("script"),i=document.createElement("link");e.src=p.Main,t.src=p.Utils,i.href=p.Stylesheet,i.rel="stylesheet",e.integrity=g.Main,t.integrity=g.Utils,i.integrity=g.Stylesheet,e.crossOrigin="anonymous",t.crossOrigin="anonymous",i.crossOrigin="anonymous",document.head.appendChild(e),document.head.appendChild(t),document.head.appendChild(i);let n=new Promise(t=>{e.onload=()=>{t()}}),o=new Promise(e=>{t.onload=()=>{e()}});yield Promise.all([n,o]),OneSignal._didLoadITILibrary=!0})}mount(){return(0,w.mG)(this,void 0,void 0,function*(){let e=t7.isUsingSmsInputField(this.promptOptions.type),t=t7.isUsingEmailInputField(this.promptOptions.type);e&&(yield this.loadPhoneLibraryScripts());let i=this.generateHtml();(0,j.gd)(`#${e7.body}`).appendChild(i),e&&(this.initializePhoneInputLibrary(),this.addSmsInputEventListeners()),t&&this.addEmailInputEventListeners()})}isEmailInputFieldEmpty(){return""===this.getValueFromEmailInput()}isSmsInputFieldEmpty(){return""===this.getValueFromSmsInput()}getValueFromEmailInput(){let e=(0,j.gd)(`#${te}`);return(null==e?void 0:e.value)||""}getValueFromSmsInput(){return this.itiOneSignal.getNumber(intlTelInputUtils.numberFormat.E164)||""}static showSmsInputError(e){let t=document.querySelector(`#${tt}`),i=document.querySelector(`#${eJ}`);t&&i?e?(t.classList.remove(ez),i.classList.add(eK)):(t.classList.add(ez),i.classList.remove(eK)):Q.Z.error("OneSignal: couldn't find slidedown validation element")}static showEmailInputError(e){let t=document.querySelector(`#${ti}`),i=document.querySelector(`#${eY}`);t&&i?e?(t.classList.remove(ez),i.classList.add(eK)):(t.classList.add(ez),i.classList.remove(eK)):Q.Z.error("OneSignal: couldn't find slidedown validation element")}static resetInputErrorStates(e){switch(e){case eE.Sms:t7.showSmsInputError(!1);break;case eE.Email:t7.showEmailInputError(!1);break;case eE.SmsAndEmail:t7.showSmsInputError(!1),t7.showEmailInputError(!1)}}static validateEmailInputWithReturnVal(e){return/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(e||"")||""===e}static isUsingSmsInputField(e){return e===eE.Sms||e===eE.SmsAndEmail}static isUsingEmailInputField(e){return e===eE.Email||e===eE.SmsAndEmail}}(l=m||(m={}))[l.InvalidSms=0]="InvalidSms",l[l.InvalidEmail=1]="InvalidEmail",l[l.InvalidEmailAndSms=2]="InvalidEmailAndSms";class t5 extends R.Z{constructor(e){let t;switch(e){case m.InvalidEmail:t="Invalid email";break;case m.InvalidSms:t="Invalid sms";break;case m.InvalidEmailAndSms:t="Invalid email & sms"}super(t),this.description=m[e],this.reason=e,Object.setPrototypeOf(this,t5.prototype)}}class tH{constructor(e){var t,i,n;switch(this.savingButton="Saving...",this.errorButton=el,this.options=e,this.options.text.actionMessage=e.text.actionMessage.substring(0,90),this.options.text.acceptButton=e.text.acceptButton.substring(0,16),this.options.text.cancelButton=e.text.cancelButton.substring(0,16),this.notificationIcons=null,this.channelCaptureContainer=null,this.isShowingFailureState=!1,e.type){case eE.Category:this.negativeUpdateButton=null===(t=this.options.text.negativeUpdateButton)||void 0===t?void 0:t.substring(0,16),this.positiveUpdateButton=null===(i=this.options.text.positiveUpdateButton)||void 0===i?void 0:i.substring(0,16),this.updateMessage=null===(n=this.options.text.updateMessage)||void 0===n?void 0:n.substring(0,90),this.tagCategories=e.categories,this.errorButton=E.c.getValueOrDefault(this.options.text.positiveUpdateButton,el);break;case eE.Sms:case eE.Email:case eE.SmsAndEmail:this.errorButton=E.c.getValueOrDefault(this.options.text.acceptButton,el)}}create(e){return(0,w.mG)(this,void 0,void 0,function*(){if(null===this.notificationIcons){let t=yield tb.getNotificationIcons();this.notificationIcons=t,this.container.className.includes(e6.container)&&(0,j.tf)(`#${e7.container}`);let i=e&&this.tagCategories?this.positiveUpdateButton:this.options.text.acceptButton,n=e&&this.tagCategories?this.negativeUpdateButton:this.options.text.cancelButton,o=function(e){let{icon:t,messageText:i,positiveButtonText:n,negativeButtonText:o}=e,s=t===e6.defaultIcon?"data:image/svg+xml,%3Csvg fill='none' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 40'%3E%3Cg clip-path='url(%23clip0)'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M33.232 28.434a2.5 2.5 0 001.768.733 1.667 1.667 0 010 3.333H5a1.667 1.667 0 110-3.333 2.5 2.5 0 002.5-2.5v-8.104A13.262 13.262 0 0118.333 5.122V1.667a1.666 1.666 0 113.334 0v3.455A13.262 13.262 0 0132.5 18.563v8.104a2.5 2.5 0 00.732 1.767zM16.273 35h7.454a.413.413 0 01.413.37 4.167 4.167 0 11-8.28 0 .417.417 0 01.413-.37z' fill='%23BDC4CB'/%3E%3C/g%3E%3Cdefs%3E%3CclipPath id='clip0'%3E%3Cpath fill='%23fff' d='M0 0h40v40H0z'/%3E%3C/clipPath%3E%3C/defs%3E%3C/svg%3E":t,r=t===e6.defaultIcon?e6.defaultIcon:"",a=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),c=document.createElement("div"),u=document.createElement("div"),h=document.createElement("div"),p=document.createElement("button"),g=document.createElement("button"),m=document.createElement("div"),f=document.createElement("div"),v=document.createElement("img");return(0,j.bF)(l,e6.body),(0,j.bF)(c,e6.icon),(0,j.bF)(d,e6.message),(0,j.bF)(h,e6.footer),(0,j.bF)(m,e6.clearfix),(0,j.bF)(f,e6.clearfix),(0,j.bF)(p,e5),(0,j.bF)(p,"primary"),(0,j.bF)(p,eH),(0,j.bF)(g,e5),(0,j.bF)(g,"secondary"),(0,j.bF)(g,eH),a.id=e7.normalSlidedown,l.id=e7.body,u.id=e7.loadingContainer,p.id=e7.allowButton,g.id=e7.cancelButton,h.id=e7.footer,r&&(0,j.bF)(v,r),v.setAttribute("alt","notification icon"),v.setAttribute("src",s||""),d.innerText=i||"",p.innerText=n||"",g.innerText=o||"",c.appendChild(v),l.appendChild(c),l.appendChild(d),l.appendChild(m),l.appendChild(u),h.appendChild(p),h.appendChild(g),h.appendChild(f),a.appendChild(l),a.appendChild(h),a}({messageText:e&&this.tagCategories?this.updateMessage:this.options.text.actionMessage,icon:this.options.icon||this.getPlatformNotificationIcon(),positiveButtonText:i,negativeButtonText:n}),s=document.createElement("div"),r=document.createElement("div");s.id=e7.container,(0,j.bF)(s,e6.container),(0,j.bF)(s,e6.reset),(0,j.gd)("body").appendChild(s),r.id=e7.dialog,(0,j.bF)(r,e6.dialog),r.appendChild(o),this.container.appendChild(r),(0,j.bF)(this.container,(0,P.M)().mobile?e6.slideUp:e6.slideDown),this.allowButton.addEventListener("click",this.onSlidedownAllowed.bind(this)),this.cancelButton.addEventListener("click",this.onSlidedownCanceled.bind(this))}})}static triggerSlidedownEvent(e){return(0,w.mG)(this,void 0,void 0,function*(){yield e1.Z.trigger(e)})}onSlidedownAllowed(e){return(0,w.mG)(this,void 0,void 0,function*(){yield tH.triggerSlidedownEvent(tH.EVENTS.ALLOW_CLICK)})}onSlidedownCanceled(e){tH.triggerSlidedownEvent(tH.EVENTS.CANCEL_CLICK),this.close(),tH.triggerSlidedownEvent(tH.EVENTS.CLOSED)}close(){(0,j.bF)(this.container,e6.closeSlidedown),(0,j.IH)(this.dialog,"animationend",(e,t)=>{e.target!==this.dialog||"slideDownExit"!==e.animationName&&"slideUpExit"!==e.animationName||((0,j.tf)(`#${e7.container}`),t())},!0)}setSaveState(){this.allowButton.disabled=!0,this.allowButton.textContent=null,this.allowButton.insertAdjacentElement("beforeend",this.getTextSpan(this.savingButton)),this.allowButton.insertAdjacentElement("beforeend",this.getIndicatorHolder()),(0,j.IM)(this.buttonIndicatorHolder,"beforeend",t9("#FFFFFF")),(0,j.bF)(this.allowButton,"disabled"),(0,j.bF)(this.allowButton,e6.savingStateButton)}removeSaveState(){this.allowButton.textContent=this.positiveUpdateButton,(0,j.tf)(`#${e6.buttonIndicatorHolder}`),this.allowButton.disabled=!1,(0,j.BH)(this.allowButton,"disabled"),(0,j.BH)(this.allowButton,e6.savingStateButton)}setFailureState(){this.allowButton.textContent=null,this.allowButton.insertAdjacentElement("beforeend",this.getTextSpan(this.errorButton)),this.options.type===eE.Category&&(this.allowButton.insertAdjacentElement("beforeend",this.getIndicatorHolder()),(0,j.IM)(this.buttonIndicatorHolder,"beforeend",function(e="#FFFFFF"){return`<svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.711 2.652a5.489 5.489 0 00-4.044 4.05 5.513 5.513 0 00.104 2.968.167.167 0 00.25.089l.893-.588a.667.667 0 011.02.692l-.61 2.937a.667.667 0 01-.786.52L.6 12.713a.667.667 0 01-.232-1.21l.933-.615a.166.166 0 00.063-.2 7.167 7.167 0 018.828-9.516.833.833 0 01-.507 1.587 5.489 5.489 0 00-2.974-.108zM15.75 3.542c.09.096.15.216.172.346a.667.667 0 01-.301.681l-.898.564a.166.166 0 00-.066.2 7.167 7.167 0 01-8.77 9.514.835.835 0 01-.154-1.544.831.831 0 01.646-.048 5.5 5.5 0 006.856-6.949.167.167 0 00-.176-.114.164.164 0 00-.071.026l-.962.604a.667.667 0 01-1.005-.713l.667-2.924a.667.667 0 01.8-.502l2.925.667c.129.03.246.096.336.192z" fill="${e}"/></svg>`}()),(0,j.bF)(this.allowButton,"onesignal-error-state-button")),this.isShowingFailureState=!0}setFailureStateForInvalidChannelInput(e){switch(e){case m.InvalidSms:t7.showSmsInputError(!0);break;case m.InvalidEmail:t7.showEmailInputError(!0);break;case m.InvalidEmailAndSms:t7.showSmsInputError(!0),t7.showEmailInputError(!0)}}removeFailureState(){(0,j.tf)("#onesignal-button-indicator-holder"),(0,j.BH)(this.allowButton,"onesignal-error-state-button"),eh.isSlidedownPushDependent(this.options.type)||t7.resetInputErrorStates(this.options.type),this.isShowingFailureState=!1}getPlatformNotificationIcon(){return(0,j.S6)(this.notificationIcons)}getIndicatorHolder(){let e=document.createElement("div");return e.id=e7.buttonIndicatorHolder,(0,j.bF)(e,e6.buttonIndicatorHolder),e}getTextSpan(e){let t=document.createElement("span");return t.textContent=e,t}get container(){return(0,j.gd)(`#${e7.container}`)}get dialog(){return(0,j.gd)(`#${e7.dialog}`)}get allowButton(){return(0,j.gd)(`#${e7.allowButton}`)}get cancelButton(){return(0,j.gd)(`#${e7.cancelButton}`)}get buttonIndicatorHolder(){return(0,j.gd)(`#${e7.buttonIndicatorHolder}`)}get slidedownFooter(){return(0,j.gd)(`#${e7.footer}`)}static get EVENTS(){return{ALLOW_CLICK:"slidedownAllowClick",CANCEL_CLICK:"slidedownCancelClick",SHOWN:"slidedownShown",CLOSED:"slidedownClosed",QUEUED:"slidedownQueued"}}}class tQ extends R.Z{constructor(e){super(`The permission message of type ${e||"unknown"} was previously dismissed.`),Object.setPrototypeOf(this,tQ.prototype)}}class tq{constructor(e){this.message=e}show(){return(0,w.mG)(this,void 0,void 0,function*(){let e=document.createElement("div"),t=document.createElement("p");t.innerText=this.message,e.appendChild(t);let i=document.createElement("div"),n=document.createElement("div");i.id=e7.container,e.id="onesignal-toast-text",(0,j.bF)(e,"onesignal-toast-text"),(0,j.bF)(i,e6.container),(0,j.bF)(i,e6.reset),(0,j.gd)("body").appendChild(i),n.id=e7.dialog,(0,j.bF)(n,e6.dialog),n.appendChild(e),this.container.appendChild(n),(0,j.bF)(this.container,(0,P.M)().mobile?e6.slideUp:e6.slideDown),tq.triggerSlidedownEvent(tq.EVENTS.SHOWN)})}static triggerSlidedownEvent(e){return(0,w.mG)(this,void 0,void 0,function*(){yield e1.Z.trigger(e)})}close(){(0,j.bF)(this.container,e6.closeSlidedown),(0,j.IH)(this.dialog,"animationend",(e,t)=>{e.target!==this.dialog||"slideDownExit"!==e.animationName&&"slideUpExit"!==e.animationName||((0,j.tf)(`#${e7.container}`),t())},!0)}get container(){return(0,j.gd)(`#${e7.container}`)}get dialog(){return(0,j.gd)(`#${e7.dialog}`)}static get EVENTS(){return{SHOWN:"toastShown",CLOSED:"toastClosed"}}}(d=f||(f={})).Push="push",d.NonPush="nonPush",(c=v||(v={})).PromptDismissCount="promptDismissCount",c.NonPushPromptsDismissCount="nonPushPromptsDismissCount",(u=$||($={})).OneSignalNotificationPrompt="onesignal-notification-prompt",u.OneSignalNonPushPrompt="onesignal-non-push-prompt";class tj extends R.Z{constructor(){super("This operation can only be performed when the user is not subscribed."),Object.setPrototypeOf(this,tj.prototype)}}class tK extends R.Z{constructor(e){super(`This operation can only be performed when the channel '${e}' does not yet exist.`),Object.setPrototypeOf(this,tK.prototype)}}class tz{static isLocalStorageSupported(){try{return"undefined"!=typeof localStorage&&(localStorage.getItem("test"),!0)}catch(e){return!1}}static setItem(e,t,i){if(!tz.isLocalStorageSupported())return;let n={value:JSON.stringify(t),timestamp:void 0!==i?(new Date).getTime()+(void 0!==i?60*i*1e3:0):void 0};localStorage.setItem(e,JSON.stringify(n))}static getItem(e){if(!tz.isLocalStorageSupported())return null;let t=localStorage.getItem(e),i;try{i=JSON.parse(t)}catch(n){return null}if(null===i)return null;if(i.timestamp&&(new Date).getTime()>=i.timestamp)return localStorage.removeItem(e),null;let o=i.value;try{o=JSON.parse(i.value)}catch(s){}return o}static removeItem(e){if(!tz.isLocalStorageSupported())return null;localStorage.removeItem(e)}}let tJ={[f.Push]:v.PromptDismissCount,[f.NonPush]:v.NonPushPromptsDismissCount},tY={[f.Push]:$.OneSignalNotificationPrompt,[f.NonPush]:$.OneSignalNonPushPrompt};class tX{static markPromptDismissedWithType(e){return(0,w.mG)(this,void 0,void 0,function*(){let t=tJ[e],i=tY[e],n=yield eB.ZP.get("Options",t);n||(n=0);let o=3;2==(n+=1)?o=7:n>2&&(o=30),Q.Z.debug(`(${A.Z.getWindowEnv().toString()}) OneSignal: User dismissed the ${e} notification prompt; reprompt after ${o} days.`),yield eB.ZP.put("Options",{key:t,value:n});let s=24*o*60;return tz.setItem(i,"dismissed",s)})}static wasPromptOfTypeDismissed(e){switch(e){case f.Push:return"dismissed"===tz.getItem($.OneSignalNotificationPrompt);case f.NonPush:return"dismissed"===tz.getItem($.OneSignalNonPushPrompt)}return!1}}class ie{static registerForPush(){return(0,w.mG)(this,void 0,void 0,function*(){return yield ie.internalRegisterForPush()})}static internalRegisterForPush(){return(0,w.mG)(this,void 0,void 0,function*(){let e=OneSignal.context,t=null;if(A.Z.getWindowEnv()!==_.Q.Host)throw new tu(tf.UnsupportedEnvironment);try{let i=yield e.subscriptionManager.subscribe(0);t=yield e.subscriptionManager.registerSubscription(i),e.pageViewManager.incrementPageViewCount(),yield t$.Q.triggerNotificationPermissionChanged(),yield tL.checkAndTriggerSubscriptionChanged()}catch(n){Q.Z.error(n)}return t})}}class it{constructor(e,t,i,n="shown",o=["opacity","transform"],s,r=500){this.selector=e,this.showClass=t,this.hideClass=i,this.state=n,this.targetTransitionEvents=o,this.nestedContentSelector=s,this.transitionCheckTimeout=r}show(){return this.hidden?new Promise(e=>{this.state="showing",e1.Z.trigger(it.EVENTS.SHOWING,this);let t=this.element;if(t?(this.hideClass&&(0,j.BH)(t,this.hideClass),this.showClass&&(0,j.bF)(t,this.showClass)):Q.Z.error(`(show) could not find animated element with selector ${this.selector}`),0==this.targetTransitionEvents.length)return e(this);{let i=setTimeout(()=>{Q.Z.debug(`Element did not completely show (state: ${this.state}).`)},this.transitionCheckTimeout);(0,j.IH)(this.element,"transitionend",(t,n)=>{if(t.target===this.element&&(0,j.r3)(this.targetTransitionEvents,t.propertyName))return clearTimeout(i),n(),this.state="shown",e1.Z.trigger(it.EVENTS.SHOWN,this),e(this)},!0)}}):Promise.resolve(this)}hide(){return this.shown?new Promise(e=>{this.state="hiding",e1.Z.trigger(it.EVENTS.HIDING,this);let t=this.element;if(t?(this.showClass&&(0,j.BH)(t,this.showClass),this.hideClass&&(0,j.bF)(t,this.hideClass)):Q.Z.error(`(hide) could not find animated element with selector ${this.selector}`),0==this.targetTransitionEvents.length)return e(this);(0,j.IH)(this.element,"transitionend",(t,i)=>{let n=setTimeout(()=>{Q.Z.debug(`Element did not completely hide (state: ${this.state}).`)},this.transitionCheckTimeout);if(t.target===this.element&&(0,j.r3)(this.targetTransitionEvents,t.propertyName))return clearTimeout(n),i(),this.state="hidden",e1.Z.trigger(it.EVENTS.HIDDEN,this),e(this)},!0)}):Promise.resolve(this)}waitUntilShown(){return"shown"===this.state?Promise.resolve(this):new Promise(e=>{OneSignal.emitter.once(it.EVENTS.SHOWN,t=>{if(t===this)return e(this)})})}waitUntilHidden(){return"hidden"===this.state?Promise.resolve(this):new Promise(e=>{OneSignal.emitter.once(it.EVENTS.HIDDEN,t=>{if(t===this)return e(this)})})}static get EVENTS(){return{SHOWING:"animatedElementShowing",SHOWN:"animatedElementShown",HIDING:"animatedElementHiding",HIDDEN:"animatedElementHidden"}}get content(){if(!this.element)return"";if(this.nestedContentSelector){let e=this.element.querySelector(this.nestedContentSelector);return e?e.innerHTML:""}return this.element.innerHTML}set content(e){if(this.element){if(this.nestedContentSelector){let t=this.element.querySelector(this.nestedContentSelector);t&&(t.textContent=e)}else this.element.textContent=e}}get element(){return document.querySelector(this.selector)}get showing(){return"showing"===this.state}get shown(){return"shown"===this.state}get hiding(){return"hiding"===this.state}get hidden(){return"hidden"===this.state}}class ii extends it{constructor(e,t,i,n,o,s="shown",r="active",a=["opacity","transform"],l){super(e,t,i,s,a),this.selector=e,this.showClass=t,this.hideClass=i,this.activeClass=n,this.inactiveClass=o,this.state=s,this.activeState=r,this.targetTransitionEvents=a,this.nestedContentSelector=l}activate(){return this.inactive&&this.shown?new Promise(e=>{this.activeState="activating",e1.Z.trigger(ii.EVENTS.ACTIVATING,this);let t=this.element;if(t?(this.inactiveClass&&(0,j.BH)(t,this.inactiveClass),this.activeClass&&(0,j.bF)(t,this.activeClass)):Q.Z.error("Could not find active animated element"),!this.shown)return Q.Z.debug("Ending activate() transition (alternative)."),this.activeState="active",e1.Z.trigger(ii.EVENTS.ACTIVE,this),e(this);if(0==this.targetTransitionEvents.length)return e(this);{let i=setTimeout(()=>{Q.Z.debug(`Element did not completely activate (state: ${this.state}, activeState: ${this.activeState}).`)},this.transitionCheckTimeout);(0,j.IH)(this.element,"transitionend",(t,n)=>{if(t.target===this.element&&(0,j.r3)(this.targetTransitionEvents,t.propertyName))return clearTimeout(i),n(),this.activeState="active",e1.Z.trigger(ii.EVENTS.ACTIVE,this),e(this)},!0)}}):Promise.resolve(this)}inactivate(){return this.active?new Promise(e=>{this.activeState="inactivating",e1.Z.trigger(ii.EVENTS.INACTIVATING,this);let t=this.element;if(t?(this.activeClass&&(0,j.BH)(t,this.activeClass),this.inactiveClass&&(0,j.bF)(t,this.inactiveClass)):Q.Z.error("Could not find active animated element"),!this.shown)return this.activeState="inactive",e1.Z.trigger(ii.EVENTS.INACTIVE,this),e(this);if(0==this.targetTransitionEvents.length)return e(this);{let i=setTimeout(()=>{Q.Z.debug(`Element did not completely inactivate (state: ${this.state}, activeState: ${this.activeState}).`)},this.transitionCheckTimeout);(0,j.IH)(this.element,"transitionend",(t,n)=>{if(t.target===this.element&&(0,j.r3)(this.targetTransitionEvents,t.propertyName))return clearTimeout(i),n(),this.activeState="inactive",e1.Z.trigger(ii.EVENTS.INACTIVE,this),e(this)},!0)}}):Promise.resolve(this)}waitUntilActive(){return this.active?Promise.resolve(this):new Promise(e=>{OneSignal.emitter.once(ii.EVENTS.ACTIVE,t=>{if(t===this)return e(this)})})}waitUntilInactive(){return this.inactive?Promise.resolve(this):new Promise(e=>{OneSignal.emitter.once(ii.EVENTS.INACTIVE,t=>{if(t===this)return e(this)})})}static get EVENTS(){return Object.assign(Object.assign({},it.EVENTS),{ACTIVATING:"activeAnimatedElementActivating",ACTIVE:"activeAnimatedElementActive",INACTIVATING:"activeAnimatedElementInactivating",INACTIVE:"activeAnimatedElementInactive"})}get activating(){return"activating"===this.activeState}get active(){return"active"===this.activeState}get inactivating(){return"inactivating"===this.activeState}get inactive(){return"inactive"===this.activeState}}class io extends ii{constructor(){super(".onesignal-bell-launcher-badge","onesignal-bell-launcher-badge-opened",null,"onesignal-bell-launcher-badge-active",null,"hidden")}increment(){if(!isNaN(this.content)){let e=+this.content;e+=1,this.content=e.toString()}}show(){let e=super.show();return OneSignal.notifyButton.setCustomColorsIfSpecified(),e}decrement(){if(!isNaN(this.content)){let e=+this.content;e-=1,this.content=e>0?e.toString():""}}}class is extends it{constructor(e){super(".onesignal-bell-launcher-message","onesignal-bell-launcher-message-opened",void 0,"hidden",["opacity","transform"],".onesignal-bell-launcher-message-body"),this.bell=e,this.contentType="",this.queued=[]}static get TIMEOUT(){return 2500}static get TYPES(){return{TIP:"tip",MESSAGE:"message",QUEUED:"queued"}}display(e,t,i=0){return Q.Z.debug(`Calling display(${e}, ${t}, ${i}).`),(this.shown?this.hide():(0,j.Ld)()).then(()=>{this.content=tc.decodeHtmlEntities(t),this.contentType=e}).then(()=>this.show()).then(()=>(0,j.gw)(i)).then(()=>this.hide()).then(()=>{this.content=this.getTipForState(),this.contentType="tip"})}getTipForState(){return this.bell.state===id.STATES.UNSUBSCRIBED?this.bell.options.text["tip.state.unsubscribed"]:this.bell.state===id.STATES.SUBSCRIBED?this.bell.options.text["tip.state.subscribed"]:this.bell.state===id.STATES.BLOCKED?this.bell.options.text["tip.state.blocked"]:""}enqueue(e){return this.queued.push(tc.decodeHtmlEntities(e)),new Promise(e=>{this.bell.badge.shown?this.bell.badge.hide().then(()=>this.bell.badge.increment()).then(()=>this.bell.badge.show()).then(e):(this.bell.badge.increment(),this.bell.initialized?this.bell.badge.show().then(e):e())})}dequeue(e){let t=this.queued.pop(e);return new Promise(e=>{this.bell.badge.shown?this.bell.badge.hide().then(()=>this.bell.badge.decrement()).then(e=>e>0?this.bell.badge.show():Promise.resolve(this)).then(e(t)):(this.bell.badge.decrement(),e(t))})}}class ir extends ii{constructor(e){super(".onesignal-bell-launcher-button",void 0,void 0,"onesignal-bell-launcher-button-active",void 0,"shown",""),this.bell=e,this.events={mouse:"bell.launcher.button.mouse"};let t=this.element;t&&(t.addEventListener("touchstart",()=>{this.onHovering(),this.onTap()},{passive:!0}),t.addEventListener("mouseenter",()=>{this.onHovering()}),t.addEventListener("mouseleave",()=>{this.onHovered()}),t.addEventListener("touchmove",()=>{this.onHovered()},{passive:!0}),t.addEventListener("mousedown",()=>{this.onTap()}),t.addEventListener("mouseup",()=>{this.onEndTap()}),t.addEventListener("click",()=>{this.onHovered(),this.onClick()}))}onHovering(){(td.isEmpty(this.events.mouse)||"out"===td.getLast(this.events.mouse))&&e1.Z.trigger(id.EVENTS.HOVERING),td.put(this.events.mouse,"over")}onHovered(){td.put(this.events.mouse,"out"),e1.Z.trigger(id.EVENTS.HOVERED)}onTap(){this.pulse(),this.activate(),this.bell.badge.activate()}onEndTap(){this.inactivate(),this.bell.badge.inactivate()}onClick(){if(e1.Z.trigger(id.EVENTS.BELL_CLICK),e1.Z.trigger(id.EVENTS.LAUNCHER_CLICK),this.bell.message.shown&&this.bell.message.contentType==is.TYPES.MESSAGE)return;let e=td.getLast("subscription.optedOut");return this.bell.unsubscribed?e?this.bell.launcher.activateIfInactive().then(()=>{this.bell.showDialogProcedure()}):(ic.registerForPushNotifications(),this.bell._ignoreSubscriptionState=!0,OneSignal.emitter.once(OneSignal.EVENTS.SUBSCRIPTION_CHANGED,()=>{this.bell.message.display(is.TYPES.MESSAGE,this.bell.options.text["message.action.subscribed"],is.TIMEOUT).then(()=>{this.bell._ignoreSubscriptionState=!1,this.bell.launcher.inactivate()})})):(this.bell.subscribed||this.bell.blocked)&&this.bell.launcher.activateIfInactive().then(()=>{this.bell.showDialogProcedure()}),this.bell.message.hide()}pulse(){(0,j.tf)(".pulse-ring"),this.element&&(0,j.IM)(this.element,"beforeend",'<div class="pulse-ring"></div>'),this.bell.setCustomColorsIfSpecified()}}class ia extends it{constructor(e){super(".onesignal-bell-launcher-dialog","onesignal-bell-launcher-dialog-opened",void 0,"hidden",["opacity","transform"],".onesignal-bell-launcher-dialog-body"),this.bell=e,this.subscribeButtonId="#onesignal-bell-container .onesignal-bell-launcher #subscribe-button",this.unsubscribeButtonId="#onesignal-bell-container .onesignal-bell-launcher #unsubscribe-button",this.notificationIcons=null}show(){return this.updateBellLauncherDialogBody().then(()=>super.show())}get subscribeButtonSelectorId(){return"subscribe-button"}get unsubscribeButtonSelectorId(){return"unsubscribe-button"}get subscribeButton(){return this.element?this.element.querySelector("#"+this.subscribeButtonSelectorId):null}get unsubscribeButton(){return this.element?this.element.querySelector("#"+this.unsubscribeButtonSelectorId):null}updateBellLauncherDialogBody(){return OneSignal.context.subscriptionManager.isPushNotificationsEnabled().then(e=>{this.nestedContentSelector&&(0,j.jI)(this.nestedContentSelector);let t="Nothing to show.",i="";if(this.bell.options.showCredit&&(i='<div class="divider"></div><div class="kickback">Powered by <a href="https://onesignal.com" class="kickback" target="_blank">OneSignal</a></div>'),this.bell.state===id.STATES.SUBSCRIBED&&!0===e||this.bell.state===id.STATES.UNSUBSCRIBED&&!1===e){let n="",o=(0,j.S6)(this.notificationIcons),s="";t=`<h1>${this.bell.options.text["dialog.main.title"]}</h1><div class="divider"></div><div class="push-notification">${n="default-icon"!=o?`<div class="push-notification-icon"><img src="${o}"></div>`:'<div class="push-notification-icon push-notification-icon-default"></div>'}<div class="push-notification-text-container"><div class="push-notification-text push-notification-text-short"></div><div class="push-notification-text"></div><div class="push-notification-text push-notification-text-medium"></div><div class="push-notification-text"></div><div class="push-notification-text push-notification-text-medium"></div></div></div><div class="action-container">${s=this.bell.state!==id.STATES.SUBSCRIBED?`<button type="button" class="action" id="${this.subscribeButtonSelectorId}">${this.bell.options.text["dialog.main.button.subscribe"]}</button>`:`<button type="button" class="action" id="${this.unsubscribeButtonSelectorId}">${this.bell.options.text["dialog.main.button.unsubscribe"]}</button>`}</div>${i}`}else if(this.bell.state===id.STATES.BLOCKED){let r=null;"chrome"===(0,P.M)().name?(0,P.M)().mobile||(0,P.M)().tablet||(r="/bell/chrome-unblock.jpg"):"firefox"===(0,P.M)().name?r="/bell/firefox-unblock.jpg":"safari"==(0,P.M)().name?r="/bell/safari-unblock.jpg":"msedge"===(0,P.M)().name&&(r="/bell/edge-unblock.png");let a="";r&&(r=A.Z.getOneSignalStaticResourcesUrl()+r,a=`<a href="${r}" target="_blank"><img src="${r}"></a></div>`),((0,P.M)().mobile||(0,P.M)().tablet)&&"chrome"===(0,P.M)().name&&(a="<ol><li>Access <strong>Settings</strong> by tapping the three menu dots <strong>⋮</strong></li><li>Click <strong>Site settings</strong> under Advanced.</li><li>Click <strong>Notifications</strong>.</li><li>Find and click this entry for this website.</li><li>Click <strong>Notifications</strong> and set it to <strong>Allow</strong>.</li></ol>"),t=`<h1>${this.bell.options.text["dialog.blocked.title"]}</h1><div class="divider"></div><div class="instructions"><p>${this.bell.options.text["dialog.blocked.message"]}</p>${a}</div>${i}`}this.nestedContentSelector&&(0,j.IM)(this.nestedContentSelector,"beforeend",t),this.subscribeButton&&this.subscribeButton.addEventListener("click",()=>{OneSignal.__doNotShowWelcomeNotification=!1,e1.Z.trigger(id.EVENTS.SUBSCRIBE_CLICK)}),this.unsubscribeButton&&this.unsubscribeButton.addEventListener("click",()=>e1.Z.trigger(id.EVENTS.UNSUBSCRIBE_CLICK)),this.bell.setCustomColorsIfSpecified()})}}class il extends ii{constructor(e){super(".onesignal-bell-launcher","onesignal-bell-launcher-active",void 0,void 0,"onesignal-bell-launcher-inactive","hidden","active"),this.bell=e,this.wasInactive=!1}resize(e){return(0,w.mG)(this,void 0,void 0,function*(){if(!this.element)throw new tu(tf.MissingDomElement);if("small"===e&&(0,j.Uj)(this.element,"onesignal-bell-launcher-sm")||"medium"===e&&(0,j.Uj)(this.element,"onesignal-bell-launcher-md")||"large"===e&&(0,j.Uj)(this.element,"onesignal-bell-launcher-lg"))return Promise.resolve(this);if((0,j.BH)(this.element,"onesignal-bell-launcher-sm"),(0,j.BH)(this.element,"onesignal-bell-launcher-md"),(0,j.BH)(this.element,"onesignal-bell-launcher-lg"),"small"===e)(0,j.bF)(this.element,"onesignal-bell-launcher-sm");else if("medium"===e)(0,j.bF)(this.element,"onesignal-bell-launcher-md");else{if("large"!==e)throw Error("Invalid OneSignal bell size "+e);(0,j.bF)(this.element,"onesignal-bell-launcher-lg")}return this.shown?yield new Promise(e=>{if(0==this.targetTransitionEvents.length)return e(this);{let t=setTimeout(()=>{Q.Z.debug(`Launcher did not completely resize (state: ${this.state}, activeState: ${this.activeState}).`)},this.transitionCheckTimeout);(0,j.IH)(this.element,"transitionend",(i,n)=>{if(i.target===this.element&&(0,j.r3)(this.targetTransitionEvents,i.propertyName))return clearTimeout(t),n(),e(this)},!0)}}):this})}activateIfInactive(){return this.inactive?(this.wasInactive=!0,this.activate()):(0,j.Ld)()}inactivateIfWasInactive(){return this.wasInactive?(this.wasInactive=!1,this.inactivate()):(0,j.Ld)()}clearIfWasInactive(){this.wasInactive=!1}inactivate(){return this.bell.message.hide().then(()=>this.bell.badge.content.length>0?this.bell.badge.hide().then(()=>Promise.all([super.inactivate(),this.resize("small")])).then(()=>this.bell.badge.show()):Promise.all([super.inactivate(),this.resize("small")]))}activate(){return this.bell.badge.content.length>0?this.bell.badge.hide().then(()=>Promise.all([super.activate(),this.resize(this.bell.options.size)])):Promise.all([super.activate(),this.resize(this.bell.options.size)])}}class id{static get EVENTS(){return{STATE_CHANGED:"notifyButtonStateChange",LAUNCHER_CLICK:"notifyButtonLauncherClick",BELL_CLICK:"notifyButtonButtonClick",SUBSCRIBE_CLICK:"notifyButtonSubscribeClick",UNSUBSCRIBE_CLICK:"notifyButtonUnsubscribeClick",HOVERING:"notifyButtonHovering",HOVERED:"notifyButtonHover"}}static get STATES(){return{UNINITIALIZED:"uninitialized",SUBSCRIBED:"subscribed",UNSUBSCRIBED:"unsubscribed",BLOCKED:"blocked"}}static get TEXT_SUBS(){return{"prompt.native.grant":{default:"Allow",chrome:"Allow",firefox:"Always Receive Notifications",safari:"Allow"}}}constructor(e,t){this.state=id.STATES.UNINITIALIZED,this._ignoreSubscriptionState=!1,this.hovering=!1,this.initialized=!1,this.DEFAULT_SIZE="medium",this.DEFAULT_POSITION="bottom-right",this.DEFAULT_THEME="default",this.options={enable:e.enable||!1,size:e.size||this.DEFAULT_SIZE,position:e.position||this.DEFAULT_POSITION,theme:e.theme||this.DEFAULT_THEME,showLauncherAfter:e.showLauncherAfter||10,showBadgeAfter:e.showBadgeAfter||300,text:this.setDefaultTextOptions(e.text||{}),prenotify:e.prenotify,showCredit:e.showCredit,colors:e.colors,offset:e.offset},t&&(this._launcher=t),this.options.enable&&(this.validateOptions(this.options),this.state=id.STATES.UNINITIALIZED,this._ignoreSubscriptionState=!1,this.installEventHooks(),this.updateState())}showDialogProcedure(){this.dialog.shown||this.dialog.show().then(()=>{(0,j.IH)(document,"click",(e,t)=>{this.dialog.element.contains(e.target)||(t(),this.dialog.shown&&this.dialog.hide().then(()=>{this.launcher.inactivateIfWasInactive()}))},!0)})}validateOptions(e){if(!e.size||!(0,j.r3)(["small","medium","large"],e.size))throw Error(`Invalid size ${e.size} for notify button. Choose among 'small', 'medium', or 'large'.`);if(!e.position||!(0,j.r3)(["bottom-left","bottom-right"],e.position))throw Error(`Invalid position ${e.position} for notify button. Choose either 'bottom-left', or 'bottom-right'.`);if(!e.theme||!(0,j.r3)(["default","inverse"],e.theme))throw Error(`Invalid theme ${e.theme} for notify button. Choose either 'default', or 'inverse'.`);if(!e.showLauncherAfter||e.showLauncherAfter<0)throw Error(`Invalid delay duration of ${this.options.showLauncherAfter} for showing the notify button. Choose a value above 0.`);if(!e.showBadgeAfter||e.showBadgeAfter<0)throw Error(`Invalid delay duration of ${this.options.showBadgeAfter} for showing the notify button's badge. Choose a value above 0.`)}setDefaultTextOptions(e){return{"tip.state.unsubscribed":e["tip.state.unsubscribed"]||"Subscribe to notifications","tip.state.subscribed":e["tip.state.subscribed"]||"You're subscribed to notifications","tip.state.blocked":e["tip.state.blocked"]||"You've blocked notifications","message.prenotify":e["message.prenotify"]||"Click to subscribe to notifications","message.action.subscribed":e["message.action.subscribed"]||"Thanks for subscribing!","message.action.resubscribed":e["message.action.resubscribed"]||"You're subscribed to notifications","message.action.subscribing":e["message.action.subscribing"]||"Click <strong>{{prompt.native.grant}}</strong> to receive notifications","message.action.unsubscribed":e["message.action.unsubscribed"]||"You won't receive notifications again","dialog.main.title":e["dialog.main.title"]||"Manage Site Notifications","dialog.main.button.subscribe":e["dialog.main.button.subscribe"]||"SUBSCRIBE","dialog.main.button.unsubscribe":e["dialog.main.button.unsubscribe"]||"UNSUBSCRIBE","dialog.blocked.title":e["dialog.blocked.title"]||"Unblock Notifications","dialog.blocked.message":e["dialog.blocked.message"]||"Follow these instructions to allow notifications:"}}installEventHooks(){iB.emitter.on(id.EVENTS.SUBSCRIBE_CLICK,()=>{this.dialog.subscribeButton.disabled=!0,this._ignoreSubscriptionState=!0,iB.User.PushSubscription.optIn().then(()=>(this.dialog.subscribeButton.disabled=!1,this.dialog.hide())).then(()=>this.message.display(is.TYPES.MESSAGE,this.options.text["message.action.resubscribed"],is.TIMEOUT)).then(()=>(this._ignoreSubscriptionState=!1,this.launcher.clearIfWasInactive(),this.launcher.inactivate())).then(()=>this.updateState()).catch(e=>{throw e})}),iB.emitter.on(id.EVENTS.UNSUBSCRIBE_CLICK,()=>{this.dialog.unsubscribeButton.disabled=!0,iB.User.PushSubscription.optOut().then(()=>(this.dialog.unsubscribeButton.disabled=!1,this.dialog.hide())).then(()=>(this.launcher.clearIfWasInactive(),this.launcher.activate())).then(()=>this.message.display(is.TYPES.MESSAGE,this.options.text["message.action.unsubscribed"],is.TIMEOUT)).then(()=>this.updateState())}),iB.emitter.on(id.EVENTS.HOVERING,()=>{this.hovering=!0,this.launcher.activateIfInactive(),this.message.shown||this.dialog.shown?this.hovering=!1:this.message.contentType!==is.TYPES.MESSAGE?new Promise(e=>{if(this.message.queued.length>0)return this.message.dequeue().then(t=>{this.message.content=t,this.message.contentType=is.TYPES.QUEUED,e()});this.message.content=tc.decodeHtmlEntities(this.message.getTipForState()),this.message.contentType=is.TYPES.TIP,e()}).then(()=>this.message.show()).then(()=>{this.hovering=!1}).catch(e=>{Q.Z.error(e)}):this.hovering=!1}),iB.emitter.on(id.EVENTS.HOVERED,()=>{this.message.contentType!==is.TYPES.MESSAGE&&this.dialog.hidden&&(this.hovering&&(this.hovering=!1,this.message.waitUntilShown().then(()=>(0,j.gw)(is.TIMEOUT)).then(()=>this.message.hide()).then(()=>{this.launcher.wasInactive&&this.dialog.hidden&&(this.launcher.inactivate(),this.launcher.wasInactive=!1)})),this.message.shown&&this.message.hide().then(()=>{this.launcher.wasInactive&&this.dialog.hidden&&(this.launcher.inactivate(),this.launcher.wasInactive=!1)}))}),iB.emitter.on(iB.EVENTS.SUBSCRIPTION_CHANGED,e=>(0,w.mG)(this,void 0,void 0,function*(){if(e.current.optedIn&&(this.badge.shown&&this.options.prenotify&&this.badge.hide(),null===this.dialog.notificationIcons)){let t=yield tb.getNotificationIcons();this.dialog.notificationIcons=t}let i=yield iB.context.permissionManager.getPermissionStatus(),n;n=e.current.optedIn?id.STATES.SUBSCRIBED:i===tU.Denied?id.STATES.BLOCKED:id.STATES.UNSUBSCRIBED,this.setState(n,this._ignoreSubscriptionState)})),iB.emitter.on(id.EVENTS.STATE_CHANGED,e=>{this.launcher.element&&(e.to===id.STATES.SUBSCRIBED?this.launcher.inactivate():(e.to===id.STATES.UNSUBSCRIBED||id.STATES.BLOCKED)&&this.launcher.activate())}),iB.emitter.on(iB.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_STRING,()=>{this.updateState()})}addDefaultClasses(){let e=this.container;if("bottom-left"===this.options.position)e&&(0,j.bF)(e,"onesignal-bell-container-bottom-left"),(0,j.bF)(this.launcher.selector,"onesignal-bell-launcher-bottom-left");else{if("bottom-right"!==this.options.position)throw Error(`Invalid OneSignal notify button position ${this.options.position}`);e&&(0,j.bF)(e,"onesignal-bell-container-bottom-right"),(0,j.bF)(this.launcher.selector,"onesignal-bell-launcher-bottom-right")}if("default"===this.options.theme)(0,j.bF)(this.launcher.selector,"onesignal-bell-launcher-theme-default");else{if("inverse"!==this.options.theme)throw Error(`Invalid OneSignal notify button theme ${this.options.theme}`);(0,j.bF)(this.launcher.selector,"onesignal-bell-launcher-theme-inverse")}}create(){return(0,w.mG)(this,void 0,void 0,function*(){if(!this.options.enable)return;if(0!==(yield iB.context.dynamicResourceLoader.loadSdkStylesheet()))return void Q.Z.debug("Not showing notify button because styles failed to load.");this.container&&(0,j.tf)("#onesignal-bell-container"),(0,j.IM)("body","beforeend",'<div id="onesignal-bell-container" class="onesignal-bell-container onesignal-reset"></div>'),this.container&&(0,j.IM)(this.container,"beforeend",'<div id="onesignal-bell-launcher" class="onesignal-bell-launcher"></div>'),(0,j.IM)(this.launcher.selector,"beforeend",'<div class="onesignal-bell-launcher-button"></div>'),(0,j.IM)(this.launcher.selector,"beforeend",'<div class="onesignal-bell-launcher-badge"></div>'),(0,j.IM)(this.launcher.selector,"beforeend",'<div class="onesignal-bell-launcher-message"></div>'),(0,j.IM)(this.message.selector,"beforeend",'<div class="onesignal-bell-launcher-message-body"></div>'),(0,j.IM)(this.launcher.selector,"beforeend",'<div class="onesignal-bell-launcher-dialog"></div>'),(0,j.IM)(this.dialog.selector,"beforeend",'<div class="onesignal-bell-launcher-dialog-body"></div>'),(0,j.IM)(this.button.selector,"beforeend",'<svg class="onesignal-bell-svg" xmlns="http://www.w3.org/2000/svg" width="99.7" height="99.7" viewBox="0 0 99.7 99.7"><circle class="background" cx="49.9" cy="49.9" r="49.9"/><path class="foreground" d="M50.1 66.2H27.7s-2-.2-2-2.1c0-1.9 1.7-2 1.7-2s6.7-3.2 6.7-5.5S33 52.7 33 43.3s6-16.6 13.2-16.6c0 0 1-2.4 3.9-2.4 2.8 0 3.8 2.4 3.8 2.4 7.2 0 13.2 7.2 13.2 16.6s-1 11-1 13.3c0 2.3 6.7 5.5 6.7 5.5s1.7.1 1.7 2c0 1.8-2.1 2.1-2.1 2.1H50.1zm-7.2 2.3h14.5s-1 6.3-7.2 6.3-7.3-6.3-7.3-6.3z"/><ellipse class="stroke" cx="49.9" cy="49.9" rx="37.4" ry="36.9"/></svg>');let e=yield iB.context.subscriptionManager.isPushNotificationsEnabled(),t=(tX.wasPromptOfTypeDismissed(f.Push),e?"small":this.options.size||this.DEFAULT_SIZE);yield this.launcher.resize(t),this.addDefaultClasses(),this.applyOffsetIfSpecified(),this.setCustomColorsIfSpecified(),this.patchSafariSvgFilterBug(),Q.Z.info("Showing the notify button."),yield(e?this.launcher.inactivate():(0,j.Ld)()).then(()=>e&&null===this.dialog.notificationIcons?tb.getNotificationIcons().then(e=>{this.dialog.notificationIcons=e}):(0,j.Ld)()).then(()=>(0,j.gw)(this.options.showLauncherAfter||0)).then(()=>this.launcher.show()).then(()=>(0,j.gw)(this.options.showBadgeAfter||0)).then(()=>this.options.prenotify&&!e&&iB._isNewVisitor?this.message.enqueue(this.options.text["message.prenotify"]).then(()=>this.badge.show()):(0,j.Ld)()).then(()=>this.initialized=!0)})}patchSafariSvgFilterBug(){if(!("safari"==(0,P.M)().name&&Number((0,P.M)().version)>=9.1)){let e="drop-shadow(0 2px 4px rgba(34,36,38,0.35));",t="drop-shadow(0 2px 4px rgba(34,36,38,0));",i="drop-shadow(0px 2px 2px rgba(34,36,38,.15));";this.graphic.setAttribute("style",`filter: ${e}; -webkit-filter: ${e};`),this.badge.element.setAttribute("style",`filter: ${t}; -webkit-filter: ${t};`),this.dialog.element.setAttribute("style",`filter: ${i}; -webkit-filter: ${i};`)}"safari"==(0,P.M)().name&&this.badge.element.setAttribute("style","display: none;")}applyOffsetIfSpecified(){let e=this.options.offset;if(e){let t=this.launcher.element;if(!t)return void Q.Z.error("Could not find bell dom element");t.style.cssText="",e.bottom&&(t.style.cssText+=`bottom: ${e.bottom};`),"bottom-right"===this.options.position?e.right&&(t.style.cssText+=`right: ${e.right};`):"bottom-left"===this.options.position&&e.left&&(t.style.cssText+=`left: ${e.left};`)}}setCustomColorsIfSpecified(){let e=this.dialog.element.querySelector("button.action"),t=this.button.element.querySelector(".pulse-ring");this.graphic.querySelector(".background").style.cssText="";let i=this.graphic.querySelectorAll(".foreground");for(let n=0;n<i.length;n++)i[n].style.cssText="";if(this.graphic.querySelector(".stroke").style.cssText="",this.badge.element.style.cssText="",e&&(e.style.cssText="",e.style.cssText=""),t&&(t.style.cssText=""),this.options.colors){let o=this.options.colors;if(o["circle.background"]&&(this.graphic.querySelector(".background").style.cssText+=`fill: ${o["circle.background"]}`),o["circle.foreground"]){let s=this.graphic.querySelectorAll(".foreground");for(let r=0;r<s.length;r++)s[r].style.cssText+=`fill: ${o["circle.foreground"]}`;this.graphic.querySelector(".stroke").style.cssText+=`stroke: ${o["circle.foreground"]}`}o["badge.background"]&&(this.badge.element.style.cssText+=`background: ${o["badge.background"]}`),o["badge.bordercolor"]&&(this.badge.element.style.cssText+=`border-color: ${o["badge.bordercolor"]}`),o["badge.foreground"]&&(this.badge.element.style.cssText+=`color: ${o["badge.foreground"]}`),e&&(o["dialog.button.background"]&&(this.dialog.element.querySelector("button.action").style.cssText+=`background: ${o["dialog.button.background"]}`),o["dialog.button.foreground"]&&(this.dialog.element.querySelector("button.action").style.cssText+=`color: ${o["dialog.button.foreground"]}`),o["dialog.button.background.hovering"]&&this.addCssToHead("onesignal-background-hover-style",`#onesignal-bell-container.onesignal-reset .onesignal-bell-launcher .onesignal-bell-launcher-dialog button.action:hover { background: ${o["dialog.button.background.hovering"]} !important; }`),o["dialog.button.background.active"]&&this.addCssToHead("onesignal-background-active-style",`#onesignal-bell-container.onesignal-reset .onesignal-bell-launcher .onesignal-bell-launcher-dialog button.action:active { background: ${o["dialog.button.background.active"]} !important; }`)),t&&o["pulse.color"]&&(this.button.element.querySelector(".pulse-ring").style.cssText=`border-color: ${o["pulse.color"]}`)}}addCssToHead(e,t){if(document.getElementById(e))return;let i=document.createElement("style");i.id=e,i.type="text/css",i.appendChild(document.createTextNode(t)),document.head.appendChild(i)}updateState(){Promise.all([iB.context.subscriptionManager.isPushNotificationsEnabled(),iB.context.permissionManager.getPermissionStatus()]).then(([e,t])=>{this.setState(e?id.STATES.SUBSCRIBED:id.STATES.UNSUBSCRIBED),t===tU.Denied&&this.setState(id.STATES.BLOCKED)}).catch(e=>{Q.Z.error(e)})}setState(e,t=!1){let i=this.state;this.state=e,i===e||t||e1.Z.trigger(id.EVENTS.STATE_CHANGED,{from:i,to:e})}get container(){return document.querySelector("#onesignal-bell-container")}get graphic(){return this.button.element.querySelector("svg")}get launcher(){return this._launcher||(this._launcher=new il(this)),this._launcher}get button(){return this._button||(this._button=new ir(this)),this._button}get badge(){return this._badge||(this._badge=new io),this._badge}get message(){return this._message||(this._message=new is(this)),this._message}get dialog(){return this._dialog||(this._dialog=new ia(this)),this._dialog}get subscribed(){return this.state===id.STATES.SUBSCRIBED}get unsubscribed(){return this.state===id.STATES.UNSUBSCRIBED}get blocked(){return this.state===id.STATES.BLOCKED}}class ic{static internalInit(){return(0,w.mG)(this,void 0,void 0,function*(){Q.Z.debug("Called internalInit()"),yield OneSignal.context.serviceWorkerManager.installWorker();let e=OneSignal.context.sessionManager;OneSignal.emitter.on(OneSignal.EVENTS.SESSION_STARTED,e.sendOnSessionUpdateFromPage.bind(e)),OneSignal.context.pageViewManager.incrementPageViewCount(),"visible"===document.visibilityState?yield ic.sessionInit():ic.postponeSessionInitUntilPageIsInFocus()})}static postponeSessionInitUntilPageIsInFocus(){(0,j.IH)(document,"visibilitychange",(e,t)=>{"visible"===document.visibilityState&&(t(),ic.sessionInit())},!0)}static sessionInit(){return(0,w.mG)(this,void 0,void 0,function*(){if(Q.Z.debug("Called sessionInit()"),OneSignal._sessionInitAlreadyRunning)return void Q.Z.debug("Returning from sessionInit because it has already been called.");OneSignal._sessionInitAlreadyRunning=!0;try{yield ic.doInitialize()}catch(e){if(e instanceof X)return;throw e}let t=yield OneSignal.context.subscriptionManager.isOptedOut(),i=yield eB.ZP.getSubscription();i.optedOut=t,yield eB.ZP.setSubscription(i),yield ic.handleAutoResubscribe(t);let n=yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled();yield eB.ZP.setIsPushEnabled(!!n),OneSignal.config.userConfig.promptOptions.autoPrompt&&!t&&OneSignal.context.promptsManager.spawnAutoPrompts(),OneSignal._sessionInitAlreadyRunning=!1,yield e1.Z.trigger(OneSignal.EVENTS.SDK_INITIALIZED)})}static registerForPushNotifications(){return(0,w.mG)(this,void 0,void 0,function*(){yield ie.registerForPush()})}static onSdkInitialized(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield ic.processExpiringSubscriptions();(yield OneSignal.context.subscriptionManager.isAlreadyRegisteredWithOneSignal())?(OneSignal.context.sessionManager.setupSessionEventListeners(),e||(yield OneSignal.context.updateManager.sendOnSessionUpdate())):OneSignal.config.userConfig.promptOptions.autoPrompt||OneSignal.config.userConfig.autoResubscribe||(yield OneSignal.context.updateManager.sendOnSessionUpdate()),yield e1.Z.trigger(OneSignal.EVENTS.SDK_INITIALIZED_PUBLIC)})}static storeInitialValues(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield OneSignal.context.subscriptionManager.isPushNotificationsEnabled(),t=yield OneSignal.context.permissionManager.getPermissionStatus(),i=yield OneSignal.context.subscriptionManager.isOptedOut();td.put("subscription.optedOut",i),yield eB.ZP.put("Options",{key:"isPushEnabled",value:e}),yield eB.ZP.put("Options",{key:"notificationPermission",value:t})})}static setWelcomeNotificationFlag(){return(0,w.mG)(this,void 0,void 0,function*(){(yield OneSignal.context.permissionManager.getNotificationPermission(OneSignal.context.appConfig.safariWebId))===tU.Granted&&(OneSignal.__doNotShowWelcomeNotification=!0)})}static establishServiceWorkerChannel(){return(0,w.mG)(this,void 0,void 0,function*(){if(navigator.serviceWorker&&window.isSecureContext)try{yield OneSignal.context.serviceWorkerManager.establishServiceWorkerChannel()}catch(e){Q.Z.error(e)}})}static processExpiringSubscriptions(){return(0,w.mG)(this,void 0,void 0,function*(){let e=OneSignal.context;if(Q.Z.debug("Checking subscription expiration..."),!(yield e.subscriptionManager.isSubscriptionExpiring()))return Q.Z.debug("Subscription is not considered expired."),!1;Q.Z.debug("Subscription is considered expiring.");let t=yield e.subscriptionManager.subscribe(1);return yield e.subscriptionManager.registerSubscription(t),!0})}static doInitialize(){return(0,w.mG)(this,void 0,void 0,function*(){let e=[];e.push(ic.storeInitialValues()),e.push(ic.installNativePromptPermissionChangedHook()),e.push(ic.setWelcomeNotificationFlag()),e.push(ic.establishServiceWorkerChannel()),e.push(ic.showNotifyButton()),e.push(ic.showPromptsFromWebConfigEditor());try{yield Promise.all(e)}catch(t){throw Q.Z.error(t),new X(eI.Unknown)}})}static showNotifyButton(){return(0,w.mG)(this,void 0,void 0,function*(){if(B.Z.isBrowser()&&!OneSignal.notifyButton){OneSignal.config.userConfig.notifyButton=OneSignal.config.userConfig.notifyButton||{},OneSignal.config.userConfig.bell&&(OneSignal.config.userConfig.bell=Object.assign(Object.assign({},OneSignal.config.userConfig.bell),OneSignal.config.userConfig.notifyButton),OneSignal.config.userConfig.notifyButton=Object.assign(Object.assign({},OneSignal.config.userConfig.notifyButton),OneSignal.config.userConfig.bell));let e=OneSignal.config.userConfig.notifyButton.displayPredicate;e&&"function"==typeof e?OneSignal.emitter.once(OneSignal.EVENTS.SDK_INITIALIZED,()=>(0,w.mG)(this,void 0,void 0,function*(){!1!==(yield Promise.resolve(OneSignal.config.userConfig.notifyButton.displayPredicate()))?(OneSignal.notifyButton=new id(OneSignal.config.userConfig.notifyButton),OneSignal.notifyButton.create()):Q.Z.debug("Notify button display predicate returned false so not showing the notify button.")})):(OneSignal.notifyButton=new id(OneSignal.config.userConfig.notifyButton),OneSignal.notifyButton.create())}})}static showPromptsFromWebConfigEditor(){return(0,w.mG)(this,void 0,void 0,function*(){let e=OneSignal.config;e.userConfig.promptOptions&&(yield new tl(e.userConfig.promptOptions.customlink).initialize())})}static installNativePromptPermissionChangedHook(){return(0,w.mG)(this,void 0,void 0,function*(){try{navigator.permissions&&((yield navigator.permissions.query({name:"notifications"})).onchange=function(){(0,j.bJ)()})}catch(e){Q.Z.warn(`Could not install native notification permission change hook w/ error: ${e}`)}})}static saveInitOptions(){return(0,w.mG)(this,void 0,void 0,function*(){let e=[],t=OneSignal.config.userConfig.persistNotification;e.push(eB.ZP.put("Options",{key:"persistNotification",value:null==t||t}));let i=OneSignal.config.userConfig.webhooks;return["notification.willDisplay","notification.clicked","notification.dismissed"].forEach(t=>{i&&i[t]?e.push(eB.ZP.put("Options",{key:`webhooks.${t}`,value:i[t]})):e.push(eB.ZP.put("Options",{key:`webhooks.${t}`,value:!1}))}),i&&i.cors?e.push(eB.ZP.put("Options",{key:"webhooks.cors",value:!0})):e.push(eB.ZP.put("Options",{key:"webhooks.cors",value:!1})),OneSignal.config.userConfig.notificationClickHandlerMatch?e.push(eB.ZP.put("Options",{key:"notificationClickHandlerMatch",value:OneSignal.config.userConfig.notificationClickHandlerMatch})):e.push(eB.ZP.put("Options",{key:"notificationClickHandlerMatch",value:"exact"})),OneSignal.config.userConfig.notificationClickHandlerAction?e.push(eB.ZP.put("Options",{key:"notificationClickHandlerAction",value:OneSignal.config.userConfig.notificationClickHandlerAction})):e.push(eB.ZP.put("Options",{key:"notificationClickHandlerAction",value:"navigate"})),Promise.all(e)})}static initSaveState(e){return(0,w.mG)(this,void 0,void 0,function*(){let t=yield tb.getAppId(),i=OneSignal.config;yield eB.ZP.put("Ids",{type:"appId",id:t});let n=e||i.siteName||document.title||"Notification";yield eB.ZP.put("Options",{key:"pageTitle",value:n}),Q.Z.info(`OneSignal: Set pageTitle to be '${n}'.`)})}static handleAutoResubscribe(e){return(0,w.mG)(this,void 0,void 0,function*(){Q.Z.info("handleAutoResubscribe",{autoResubscribe:OneSignal.config.userConfig.autoResubscribe,isOptedOut:e}),OneSignal.config.userConfig.autoResubscribe&&!e&&(yield OneSignal.context.permissionManager.getNotificationPermission(OneSignal.context.appConfig.safariWebId))==tU.Granted&&(yield ie.registerForPush())})}static polyfillSafariFetch(){return(0,w.mG)(this,void 0,void 0,function*(){if("safari"==(0,P.M)().name&&void 0===window.fetch){Q.Z.debug("Loading fetch polyfill for Safari..");try{yield(new e_).loadFetchPolyfill(),Q.Z.debug("Done loading fetch polyfill.")}catch(e){Q.Z.debug("Error loading fetch polyfill:",e)}}})}static errorIfInitAlreadyCalled(){if(OneSignal._initCalled)throw new X(eI.MultipleInitialization);OneSignal._initCalled=!0}}(h=b||(b={}))[h.Unknown=0]="Unknown",h[h.NoDeviceId=1]="NoDeviceId",h[h.NoEmailSet=2]="NoEmailSet",h[h.NoSMSSet=3]="NoSMSSet",h[h.OptedOut=4]="OptedOut";class iu extends R.Z{constructor(e){let t;switch(e){case b.Unknown||b.NoDeviceId:t="This operation can only be performed after the user is subscribed.";break;case b.NoEmailSet:t="No email is currently set.";break;case b.NoSMSSet:t="No sms is currently set.";break;case b.OptedOut:t="The user has manually opted out of receiving of notifications. This operation can only be performed after the user is fully resubscribed."}super(t),this.reason=b[e],Object.setPrototypeOf(this,iu.prototype)}}class ih{constructor(e){this.appConfig=e,"undefined"!=typeof OneSignal&&OneSignal.environmentInfo&&(this.environmentInfo=OneSignal.environmentInfo),this.subscriptionManager=t2.getSubscriptionManager(this),this.serviceWorkerManager=t2.getServiceWorkerManager(this),this.pageViewManager=new e8,this.permissionManager=new eU,this.workerMessenger=new class e{constructor(e,t=new class e{constructor(){this.replies={}}addListener(e,t,i){let n={callback:t,onceListenerOnly:i},o=this.replies[e.toString()];o?o.push(n):this.replies[e.toString()]=[n]}findListenersForMessage(e){return this.replies[e.toString()]||[]}deleteListenerRecords(e){this.replies[e.toString()]=null}deleteAllListenerRecords(){this.replies={}}deleteListenerRecord(e,t){let i=this.replies[e.toString()];if(null!=i)for(let n=i.length-1;n>=0;n--)i[n]===t&&i.splice(n,1)}}){this.context=e,this.replies=t}broadcast(e,t){return(0,w.mG)(this,void 0,void 0,function*(){if(A.Z.getWindowEnv()!==_.Q.ServiceWorker)return;let i=yield self.clients.matchAll({type:"window",includeUncontrolled:!0});for(let n of i)Q.Z.debug(`[Worker Messenger] [SW -> Page] Broadcasting '${e.toString()}' to window client ${n.url}.`),n.postMessage({command:e,payload:t})})}unicast(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){if(A.Z.getWindowEnv()===_.Q.ServiceWorker){if(!i)throw new eN.R("windowClient",eN.Q.Empty);Q.Z.debug(`[Worker Messenger] [SW -> Page] Unicasting '${e.toString()}' to window client ${i.url}.`),i.postMessage({command:e,payload:t})}else Q.Z.debug(`[Worker Messenger] [Page -> SW] Unicasting '${e.toString()}' to service worker.`),this.directPostMessageToSW(e,t)})}directPostMessageToSW(e,t){return(0,w.mG)(this,void 0,void 0,function*(){var i;Q.Z.debug(`[Worker Messenger] [Page -> SW] Direct command '${e.toString()}' to service worker.`);let n=yield null===(i=this.context)||void 0===i?void 0:i.serviceWorkerManager.getRegistration();if(!n)return void Q.Z.error("`[Worker Messenger] [Page -> SW] Could not get ServiceWorkerRegistration to postMessage!");let o=eA.getAvailableServiceWorker(n);o?o.postMessage({command:e,payload:t}):Q.Z.error("`[Worker Messenger] [Page -> SW] Could not get ServiceWorker to postMessage!")})}listen(){return(0,w.mG)(this,void 0,void 0,function*(){B.Z.supportsServiceWorkers()&&(A.Z.getWindowEnv()===_.Q.ServiceWorker?(self.addEventListener("message",this.onWorkerMessageReceivedFromPage.bind(this)),Q.Z.debug("[Worker Messenger] Service worker is now listening for messages.")):yield this.listenForPage())})}listenForPage(){return(0,w.mG)(this,void 0,void 0,function*(){navigator.serviceWorker.addEventListener("message",this.onPageMessageReceivedFromServiceWorker.bind(this)),Q.Z.debug(`(${location.origin}) [Worker Messenger] Page is now listening for messages.`)})}onWorkerMessageReceivedFromPage(e){let t=e.data;if(!t||!t.command)return;let i=this.replies.findListenersForMessage(t.command),n=[],o=[];for(let s of(Q.Z.debug("[Worker Messenger] Service worker received message:",e.data),i))s.onceListenerOnly&&n.push(s),o.push(s);for(let r=n.length-1;r>=0;r--){let a=n[r];this.replies.deleteListenerRecord(t.command,a)}for(let l of o)l.callback.apply(null,[t.payload])}onPageMessageReceivedFromServiceWorker(e){let t=e.data;if(!t||!t.command)return;let i=this.replies.findListenersForMessage(t.command),n=[],o=[];for(let s of(Q.Z.debug("[Worker Messenger] Page received message:",e.data),i))s.onceListenerOnly&&n.push(s),o.push(s);for(let r=n.length-1;r>=0;r--){let a=n[r];this.replies.deleteListenerRecord(t.command,a)}for(let l of o)l.callback.apply(null,[t.payload])}on(e,t){this.replies.addListener(e,t,!1)}once(e,t){this.replies.addListener(e,t,!0)}off(e){e?this.replies.deleteListenerRecords(e):this.replies.deleteAllListenerRecords()}}(this),this.updateManager=new class e{constructor(e){this.context=e,this.onSessionSent=e.pageViewManager.getPageViewCount()>1}sendPushDeviceRecordUpdate(){return(0,w.mG)(this,void 0,void 0,function*(){var e;(null===(e=t_.singletonInstance)||void 0===e?void 0:e.hasOneSignalId)?this.onSessionSent||(yield this.sendOnSessionUpdate()):Q.Z.debug("Not sending the update because user is not registered with OneSignal (no onesignal_id)")})}sendOnSessionUpdate(){return(0,w.mG)(this,void 0,void 0,function*(){var e;if(this.onSessionSent||!this.context.pageViewManager.isFirstPageView())return;if(!(yield this.context.subscriptionManager.isAlreadyRegisteredWithOneSignal()))return void Q.Z.debug("Not sending the on session because user is not registered with OneSignal (no device id)");let t=yield OneSignal.coreDirector.getPushSubscriptionModel();if((null==t?void 0:t.data.notification_types)===M.Subscribed||!0===(null===(e=OneSignal.config)||void 0===e?void 0:e.enableOnSession))try{this.context.sessionManager.upsertSession(e2.eB.UserNewSession),this.onSessionSent=!0}catch(i){Q.Z.error(`Failed to update user session. Error "${i.message}" ${i.stack}`)}})}sendOutcomeDirect(e,t,i,n){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("sendOutcomeDirect");let o=yield OneSignal.coreDirector.getPushSubscriptionModel();if(o&&tN(null==o?void 0:o.data)){let s={id:i,app_id:e,notification_ids:t,direct:!0,subscription:{id:o.data.id,type:F.getSubscriptionType()}};return void 0!==n&&(s.weight=n),void(yield et.sendOutcome(s))}Q.Z.warn("Send outcome aborted because pushSubscriptionModel is not available.")})}sendOutcomeInfluenced(e,t,i,n){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("sendOutcomeInfluenced");let o=yield OneSignal.coreDirector.getPushSubscriptionModel();if(o&&tN(null==o?void 0:o.data)){let s={id:i,app_id:e,notification_ids:t,direct:!1,subscription:{id:o.data.id,type:F.getSubscriptionType()}};return void 0!==n&&(s.weight=n),void(yield et.sendOutcome(s))}Q.Z.warn("Send outcome aborted because pushSubscriptionModel is not available.")})}sendOutcomeUnattributed(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("sendOutcomeUnattributed");let n=yield OneSignal.coreDirector.getPushSubscriptionModel();if(n&&tN(null==n?void 0:n.data)){let o={id:t,app_id:e,subscription:{id:n.data.id,type:F.getSubscriptionType()}};return void 0!==i&&(o.weight=i),void(yield et.sendOutcome(o))}Q.Z.warn("Send outcome aborted because pushSubscriptionModel is not available.")})}}(this),this.sessionManager=new class e{constructor(e){this.onSessionSent=!1,this.context=e}notifySWToUpsertSession(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){var n;let o={onesignalId:e,subscriptionId:t,appId:this.context.appConfig.appId,sessionThreshold:this.context.appConfig.sessionThreshold||0,enableSessionDuration:!!this.context.appConfig.enableSessionDuration,sessionOrigin:i,isSafari:Z.Q.isSafari(),outcomesConfig:this.context.appConfig.userConfig.outcomes};(null===(n=this.context.environmentInfo)||void 0===n?void 0:n.isBrowserAndSupportsServiceWorkers)?(Q.Z.debug("Notify SW to upsert session"),yield this.context.workerMessenger.unicast(ex.SessionUpsert,o)):Q.Z.debug("Notify upsert: do nothing")})}notifySWToDeactivateSession(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){var n;let o={appId:this.context.appConfig.appId,subscriptionId:t,onesignalId:e,sessionThreshold:this.context.appConfig.sessionThreshold,enableSessionDuration:this.context.appConfig.enableSessionDuration,sessionOrigin:i,isSafari:Z.Q.isSafari(),outcomesConfig:this.context.appConfig.userConfig.outcomes};(null===(n=this.context.environmentInfo)||void 0===n?void 0:n.isBrowserAndSupportsServiceWorkers)?(Q.Z.debug("Notify SW to deactivate session"),yield this.context.workerMessenger.unicast(ex.SessionDeactivate,o)):Q.Z.debug("Notify deactivate: do nothing")})}_getOneSignalAndSubscriptionIds(){return(0,w.mG)(this,void 0,void 0,function*(){let e=OneSignal.coreDirector.getIdentityModel(),t=yield OneSignal.coreDirector.getPushSubscriptionModel();if(!e||!e.onesignalId)throw new R.Z("Abort _getOneSignalAndSubscriptionIds: no identity");if(!t||!tN(t.data))throw new R.Z("Abort _getOneSignalAndSubscriptionIds: no subscription");let{onesignalId:i}=e,{id:n}=t.data;return{onesignalId:i,subscriptionId:n}})}handleVisibilityChange(){return(0,w.mG)(this,void 0,void 0,function*(){var e;if(null===(e=t_.singletonInstance)||void 0===e?void 0:e.hasOneSignalId)try{let t=document.visibilityState,{onesignalId:i,subscriptionId:n}=yield this._getOneSignalAndSubscriptionIds();if("visible"===t)return this.setupOnFocusAndOnBlurForSession(),Q.Z.debug("handleVisibilityChange","visible",`hasFocus: ${document.hasFocus()}`),void(document.hasFocus()&&(yield this.notifySWToUpsertSession(i,n,e2.eB.VisibilityVisible)));if("hidden"===t)return Q.Z.debug("handleVisibilityChange","hidden"),OneSignal.cache.focusHandler&&OneSignal.cache.isFocusEventSetup&&(window.removeEventListener("focus",OneSignal.cache.focusHandler,!0),OneSignal.cache.isFocusEventSetup=!1),OneSignal.cache.blurHandler&&OneSignal.cache.isBlurEventSetup&&(window.removeEventListener("blur",OneSignal.cache.blurHandler,!0),OneSignal.cache.isBlurEventSetup=!1),void(yield this.notifySWToDeactivateSession(i,n,e2.eB.VisibilityHidden));Q.Z.warn("Unhandled visibility state happened",t)}catch(o){Q.Z.error("Error handling visibility change:",o)}})}handleOnBeforeUnload(){return(0,w.mG)(this,void 0,void 0,function*(){var e;if(null===(e=t_.singletonInstance)||void 0===e?void 0:e.hasOneSignalId)try{let{onesignalId:t,subscriptionId:i}=yield this._getOneSignalAndSubscriptionIds(),n={appId:this.context.appConfig.appId,onesignalId:t,subscriptionId:i,sessionThreshold:this.context.appConfig.sessionThreshold,enableSessionDuration:this.context.appConfig.enableSessionDuration,sessionOrigin:e2.eB.BeforeUnload,isSafari:Z.Q.isSafari(),outcomesConfig:this.context.appConfig.userConfig.outcomes};Q.Z.debug("Notify SW to deactivate session (beforeunload)"),this.context.workerMessenger.directPostMessageToSW(ex.SessionDeactivate,n)}catch(o){Q.Z.error("Error handling onbeforeunload:",o)}})}handleOnFocus(e){return(0,w.mG)(this,void 0,void 0,function*(){var t;if(Q.Z.debug("handleOnFocus",e),null===(t=t_.singletonInstance)||void 0===t?void 0:t.hasOneSignalId)try{if(e.target!==window)return;let{onesignalId:i,subscriptionId:n}=yield this._getOneSignalAndSubscriptionIds();yield this.notifySWToUpsertSession(i,n,e2.eB.Focus)}catch(o){Q.Z.error("Error handling focus:",o)}})}handleOnBlur(e){return(0,w.mG)(this,void 0,void 0,function*(){var t;if(Q.Z.debug("handleOnBlur",e),null===(t=t_.singletonInstance)||void 0===t?void 0:t.hasOneSignalId)try{if(e.target!==window)return;let{onesignalId:i,subscriptionId:n}=yield this._getOneSignalAndSubscriptionIds();yield this.notifySWToDeactivateSession(i,n,e2.eB.Blur)}catch(o){Q.Z.error("Error handling blur:",o)}})}upsertSession(e){return(0,w.mG)(this,void 0,void 0,function*(){var t,i;if(null===(t=t_.singletonInstance)||void 0===t?void 0:t.hasOneSignalId){let{onesignalId:n,subscriptionId:o}=yield this._getOneSignalAndSubscriptionIds();yield this.notifySWToUpsertSession(n,o,e)}(null===(i=this.context.environmentInfo)||void 0===i?void 0:i.isBrowserAndSupportsServiceWorkers)?this.setupSessionEventListeners():(this.onSessionSent=e===e2.eB.UserCreate,OneSignal.emitter.emit(OneSignal.EVENTS.SESSION_STARTED))})}setupSessionEventListeners(){var e;(null===(e=this.context.environmentInfo)||void 0===e?void 0:e.isBrowserAndSupportsServiceWorkers)?(this.setupOnFocusAndOnBlurForSession(),OneSignal.cache.isVisibilityChangeEventSetup||(document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this),!0),OneSignal.cache.isVisibilityChangeEventSetup=!0),OneSignal.cache.isBeforeUnloadEventSetup||(window.addEventListener("beforeunload",e=>{this.handleOnBeforeUnload(),delete e.returnValue},!0),OneSignal.cache.isBeforeUnloadEventSetup=!0)):Q.Z.debug("Not setting session event listeners. No service worker possible.")}setupOnFocusAndOnBlurForSession(){Q.Z.debug("setupOnFocusAndOnBlurForSession"),OneSignal.cache.focusHandler||(OneSignal.cache.focusHandler=this.handleOnFocus.bind(this)),OneSignal.cache.isFocusEventSetup||(window.addEventListener("focus",OneSignal.cache.focusHandler,!0),OneSignal.cache.isFocusEventSetup=!0),OneSignal.cache.blurHandler||(OneSignal.cache.blurHandler=this.handleOnBlur.bind(this)),OneSignal.cache.isBlurEventSetup||(window.addEventListener("blur",OneSignal.cache.blurHandler,!0),OneSignal.cache.isBlurEventSetup=!0)}sendOnSessionUpdateFromPage(){return(0,w.mG)(this,void 0,void 0,function*(){var e,t;if(this.onSessionSent||!this.context.pageViewManager.isFirstPageView())return;let i=OneSignal.coreDirector.getIdentityModel(),n=null===(e=null==i?void 0:i.data)||void 0===e?void 0:e.id;if(!n)return void Q.Z.debug("Not sending the on session because user is not registered with OneSignal (no onesignal id)");let o=yield OneSignal.coreDirector.getPushSubscriptionModel();if((null==o?void 0:o.data.notification_types)!==M.Subscribed&&!0!==(null===(t=OneSignal.config)||void 0===t?void 0:t.enableOnSession))return;let s;tN(null==o?void 0:o.data)&&(s=null==o?void 0:o.data.id);try{let r=new L(L.ONESIGNAL_ID,n),a=yield tb.getAppId();E.Z.enforceAppId(a),E.Z.enforceAlias(r);try{yield ee.updateUser({appId:a,subscriptionId:s},r,{refresh_device_metadata:!0,deltas:{session_count:1}}),this.onSessionSent=!0}catch(l){Q.Z.debug("Error updating user session:",l)}}catch(d){Q.Z.error(`Failed to update user session. Error "${d.message}" ${d.stack}`)}})}}(this),this.tagManager=new class e{constructor(e){this.tagsFromTaggingContainer={},this.remoteTags={},this.context=e}sendTags(){return(0,w.mG)(this,void 0,void 0,function*(){Q.Z.info("Category Slidedown Local Tags:",this.tagsFromTaggingContainer);let e=eu.convertTagsBooleansToApi(this.tagsFromTaggingContainer),t=eu.getObjectDifference(e,this.remoteTags);return eu.isTagObjectEmpty(t)?(Q.Z.warn("OneSignal: no change detected in Category preferences. Skipping tag update."),t):yield OneSignal.User.addTags(t)})}storeTagValuesToUpdate(e){this.tagsFromTaggingContainer=e}storeRemotePlayerTags(e){this.context.tagManager.remoteTags=e}}(this),this.slidedownManager=new class e{constructor(e){this.context=e,this.slidedownQueue=[],this.isSlidedownShowing=!1}checkIfSlidedownShouldBeShown(e){return(0,w.mG)(this,void 0,void 0,function*(){var t;let i=(yield OneSignal.context.permissionManager.getPermissionStatus())===tU.Denied,n,o=yield OneSignal.context.subscriptionManager.getSubscriptionState(),{subscribed:s,optedOut:r}=o,a=null===(t=e.slidedownPromptOptions)||void 0===t?void 0:t.type,l=!1;if(a&&(l=eh.isSlidedownPushDependent(a)),l){if(s)return!!e.isInUpdateMode||(Q.Z.info(new tj),!1);if(n=tX.wasPromptOfTypeDismissed(f.Push),r)throw new iu(b.OptedOut);if(i)return Q.Z.info(new tR(tG.Blocked)),!1}else{if(!e.force){let d=yield OneSignal.coreDirector.hasSms(),c=yield OneSignal.coreDirector.hasEmail();if(d&&a===eE.Sms)return Q.Z.info(new tK(eE.Sms)),!1;if(c&&a===eE.Email)return Q.Z.info(new tK(eE.Email)),!1;if(d&&c&&a===eE.SmsAndEmail)return Q.Z.info(new tK(eE.SmsAndEmail)),!1}n=tX.wasPromptOfTypeDismissed(f.NonPush)}return!(n&&!e.force&&!e.isInUpdateMode)||(Q.Z.info(new tQ(a)),!1)})}registerForPush(){ic.registerForPushNotifications()}handleAllowForCategoryType(){return(0,w.mG)(this,void 0,void 0,function*(){if(!this.slidedown)throw new R.Z("SlidedownManager: handleAllowForCategoryType: this.slidedown is undefined");let e=t6.getValuesFromTaggingContainer();this.context.tagManager.storeTagValuesToUpdate(e),this.registerForPush(),yield this.context.tagManager.sendTags(!0)})}handleAllowForEmailType(){return(0,w.mG)(this,void 0,void 0,function*(){var e,t,i;if(!this.slidedown)throw new R.Z("SlidedownManager: handleAllowForEmailType: this.slidedown is undefined");let n=null===(e=this.slidedown.channelCaptureContainer)||void 0===e?void 0:e.emailInputFieldIsValid,o=null===(t=this.slidedown.channelCaptureContainer)||void 0===t?void 0:t.isEmailInputFieldEmpty();if(!n||o)throw new t5(m.InvalidEmail);let s=null===(i=this.slidedown.channelCaptureContainer)||void 0===i?void 0:i.getValueFromEmailInput();this.updateEmail(s)})}handleAllowForSmsType(){return(0,w.mG)(this,void 0,void 0,function*(){var e,t,i;if(!this.slidedown)throw new R.Z("SlidedownManager: handleAllowForSmsType: this.slidedown is undefined");let n=null===(e=this.slidedown.channelCaptureContainer)||void 0===e?void 0:e.smsInputFieldIsValid,o=null===(t=this.slidedown.channelCaptureContainer)||void 0===t?void 0:t.isSmsInputFieldEmpty();if(!n||o)throw new t5(m.InvalidSms);let s=null===(i=this.slidedown.channelCaptureContainer)||void 0===i?void 0:i.getValueFromSmsInput();this.updateSMS(s)})}handleAllowForSmsAndEmailType(){return(0,w.mG)(this,void 0,void 0,function*(){var e,t,i,n,o,s;if(!this.slidedown)throw new R.Z("SlidedownManager: handleAllowForSmsAndEmailType: this.slidedown is undefined");let r=null===(e=this.slidedown.channelCaptureContainer)||void 0===e?void 0:e.smsInputFieldIsValid,a=null===(t=this.slidedown.channelCaptureContainer)||void 0===t?void 0:t.emailInputFieldIsValid,l=null===(i=this.slidedown.channelCaptureContainer)||void 0===i?void 0:i.isEmailInputFieldEmpty(),d=null===(n=this.slidedown.channelCaptureContainer)||void 0===n?void 0:n.isSmsInputFieldEmpty();if(!r&&!a||l&&d)throw new t5(m.InvalidEmailAndSms);let c=null===(o=this.slidedown.channelCaptureContainer)||void 0===o?void 0:o.getValueFromEmailInput(),u=null===(s=this.slidedown.channelCaptureContainer)||void 0===s?void 0:s.getValueFromSmsInput();if(!a)throw new t5(m.InvalidEmail);if(l||this.updateEmail(c),!r)throw new t5(m.InvalidSms);d||this.updateSMS(u)})}updateEmail(e){e&&OneSignal.User.addEmail(e)}updateSMS(e){e&&OneSignal.User.addSms(e)}showConfirmationToast(){return(0,w.mG)(this,void 0,void 0,function*(){if(!this.slidedown)throw new R.Z("SlidedownManager: showConfirmationToast: this.slidedown is undefined");let e=this.slidedown.options.text.confirmMessage;if(!e)return;yield q(1e3);let t=new tq(e);yield t.show(),yield q(5e3),t.close(),tq.triggerSlidedownEvent(tq.EVENTS.CLOSED)})}mountAuxiliaryContainers(e){return(0,w.mG)(this,void 0,void 0,function*(){var t;switch(null===(t=e.slidedownPromptOptions)||void 0===t?void 0:t.type){case eE.Category:this.mountTaggingContainer(e);break;case eE.Email:case eE.Sms:case eE.SmsAndEmail:yield this.mountChannelCaptureContainer(e)}})}mountTaggingContainer(e){return(0,w.mG)(this,void 0,void 0,function*(){var t;Z.Q.logMethodCall("mountTaggingContainer");try{let i={},n=new t6,o=null===(t=e.slidedownPromptOptions)||void 0===t?void 0:t.categories;if(!o)throw Error("Categories not defined");let s=OneSignal.coreDirector.getPropertiesModel(),r=null==s?void 0:s.data.tags;e.isInUpdateMode&&r?(this.context.tagManager.storeRemotePlayerTags(r),i=eu.convertTagsApiToBooleans(r)):eu.markAllTagsAsSpecified(o,!0),n.mount(o,i)}catch(a){Q.Z.error("OneSignal: Attempted to create tagging container with error",a)}})}mountChannelCaptureContainer(e){return(0,w.mG)(this,void 0,void 0,function*(){Z.Q.logMethodCall("mountChannelCaptureContainer");try{if(e.slidedownPromptOptions){let t=new t7(e.slidedownPromptOptions);t.mount(),this.slidedown&&(this.slidedown.channelCaptureContainer=t)}}catch(i){Q.Z.error("OneSignal: Attempted to create channel capture container with error",i)}})}handleAllowClick(){return(0,w.mG)(this,void 0,void 0,function*(){if(!this.slidedown)throw new R.Z("SlidedownManager: handleAllowClick: this.slidedown is undefined");let e=this.slidedown.options.type;this.slidedown.isShowingFailureState&&this.slidedown.removeFailureState();try{switch(e){case eE.Push:this.registerForPush();break;case eE.Category:yield this.handleAllowForCategoryType();break;case eE.Email:yield this.handleAllowForEmailType();break;case eE.Sms:yield this.handleAllowForSmsType();break;case eE.SmsAndEmail:yield this.handleAllowForSmsAndEmailType()}}catch(t){return Q.Z.warn("OneSignal Slidedown failed to update:",t),this.slidedown.removeSaveState(),this.slidedown.setFailureState(),void(void 0!==t.reason&&this.slidedown.setFailureStateForInvalidChannelInput(t.reason))}switch(this.slidedown&&(this.slidedown.close(),eh.isSlidedownPushDependent(e)||(yield this.showConfirmationToast()),yield q(1e3),tH.triggerSlidedownEvent(tH.EVENTS.CLOSED)),e){case eE.Push:case eE.Category:Q.Z.debug("Setting flag to not show the slidedown to the user again."),tX.markPromptDismissedWithType(f.Push);break;default:Q.Z.debug("Setting flag to not show the slidedown to the user again."),tX.markPromptDismissedWithType(f.NonPush)}})}setIsSlidedownShowing(e){this.isSlidedownShowing=e}showQueued(){return(0,w.mG)(this,void 0,void 0,function*(){if(this.slidedownQueue.length>0){let e=this.dequeue();e&&(yield this.createSlidedown(e))}})}enqueue(e){this.slidedownQueue.push(e),tH.triggerSlidedownEvent(tH.EVENTS.QUEUED)}dequeue(){return this.slidedownQueue.shift()}createSlidedown(e){return(0,w.mG)(this,void 0,void 0,function*(){var t;Z.Q.logMethodCall("createSlidedown");try{if(!(yield this.checkIfSlidedownShouldBeShown(e)))return}catch(i){return void Q.Z.warn("checkIfSlidedownShouldBeShown returned an error",i)}if(function(){let e=OneSignal.notifyButton;e&&e.options.enable&&"hidden"!==OneSignal.notifyButton.launcher.state&&OneSignal.notifyButton.launcher.waitUntilShown().then(()=>{OneSignal.notifyButton.launcher.hide()}),OneSignal.emitter.once(tH.EVENTS.CLOSED,()=>{OneSignal.notifyButton&&OneSignal.notifyButton.options.enable&&OneSignal.notifyButton.launcher.show()})}(),this.isSlidedownShowing)this.enqueue(e);else try{this.setIsSlidedownShowing(!0);let n=e.slidedownPromptOptions||ec;this.slidedown=new tH(n),yield this.slidedown.create(e.isInUpdateMode),yield this.mountAuxiliaryContainers(e),Q.Z.debug("Showing OneSignal Slidedown"),tH.triggerSlidedownEvent(tH.EVENTS.SHOWN)}catch(o){Q.Z.error("There was an error showing the OneSignal Slidedown:",o),this.setIsSlidedownShowing(!1),null===(t=this.slidedown)||void 0===t||t.close()}})}}(this),this.promptsManager=new class e{constructor(e){this.isNativePromptShowing=!1,this.context=e,this.eventHooksInstalled=!1}shouldForceSlidedownOverNative(){let{environmentInfo:e}=OneSignal,{browserType:t,browserVersion:i,requiresUserInteraction:n}=e;return"chrome"===t&&Number(i)>=63&&((0,P.M)().tablet||(0,P.M)().mobile)||n}spawnAutoPrompts(){return(0,w.mG)(this,void 0,void 0,function*(){var e,t;let i=OneSignal.config.userConfig.promptOptions,n=this.shouldForceSlidedownOverNative(),o=this.getDelayedPromptOptions(i,eE.Native),s=this.isPageViewConditionMet(o),r=o.enabled&&s,a=n&&r;if(r&&!a)return void this.internalShowDelayedPrompt(eE.Native,o.timeDelay||0);let l=!!eh.getFirstSlidedownPromptOptionsWithType(null===(e=i.slidedown)||void 0===e?void 0:e.prompts,eE.Push);a&&!l&&this.internalShowDelayedPrompt(eE.Push,o.timeDelay||0);let d=null===(t=i.slidedown)||void 0===t?void 0:t.prompts;if(d&&(null==d?void 0:d.length)>0)for(let c=0;c<d.length;c++){let u=d[c],h=this.getDelayedPromptOptions(i,u.type),p=this.isPageViewConditionMet(h),g={slidedownPromptOptions:u};h.enabled&&p&&this.internalShowDelayedPrompt(u.type,h.timeDelay||0,g)}})}internalShowDelayedPrompt(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){if(Z.Z.logMethodCall("internalShowDelayedPrompt"),"number"!=typeof t)return void Q.Z.error("internalShowDelayedPrompt: timeDelay not a number");let{requiresUserInteraction:n}=O.getEnvironmentInfo();switch(n&&e===eE.Native&&(e=eE.Push),t>0&&(yield q(1e3*t)),e){case eE.Native:yield this.internalShowNativePrompt();break;case eE.Push:yield this.internalShowSlidedownPrompt(i);break;case eE.Category:yield this.internalShowCategorySlidedown(i);break;case eE.Sms:yield this.internalShowSmsSlidedown(i);break;case eE.Email:yield this.internalShowEmailSlidedown(i);break;case eE.SmsAndEmail:yield this.internalShowSmsAndEmailSlidedown(i);break;default:Q.Z.error("Invalid Delayed Prompt type")}})}internalShowNativePrompt(){return(0,w.mG)(this,void 0,void 0,function*(){Z.Z.logMethodCall("internalShowNativePrompt"),this.isNativePromptShowing?Q.Z.debug("Already showing autoprompt. Abort showing a native prompt."):(this.isNativePromptShowing=!0,yield ic.registerForPushNotifications(),this.isNativePromptShowing=!1,tX.markPromptDismissedWithType(f.Push))})}internalShowSlidedownPrompt(e={force:!1}){return(0,w.mG)(this,void 0,void 0,function*(){Z.Z.logMethodCall("internalShowSlidedownPrompt"),e.slidedownPromptOptions||(e.slidedownPromptOptions=ec),0===(yield this.context.dynamicResourceLoader.loadSdkStylesheet())?(this.eventHooksInstalled||this.installEventHooksForSlidedown(),yield this.context.slidedownManager.createSlidedown(e)):Q.Z.debug("Not showing slidedown permission message because styles failed to load.")})}internalShowCategorySlidedown(e){return(0,w.mG)(this,void 0,void 0,function*(){Z.Z.logMethodCall("internalShowCategorySlidedown"),yield this.internalShowParticularSlidedown(eE.Category,e)})}internalShowSmsSlidedown(e){return(0,w.mG)(this,void 0,void 0,function*(){Z.Z.logMethodCall("internalShowSmsSlidedown"),yield this.internalShowParticularSlidedown(eE.Sms,e)})}internalShowEmailSlidedown(e){return(0,w.mG)(this,void 0,void 0,function*(){Z.Z.logMethodCall("internalShowEmailSlidedown"),yield this.internalShowParticularSlidedown(eE.Email,e)})}internalShowSmsAndEmailSlidedown(e){return(0,w.mG)(this,void 0,void 0,function*(){Z.Z.logMethodCall("internalShowSmsAndEmailSlidedown"),yield this.internalShowParticularSlidedown(eE.SmsAndEmail,e)})}internalShowParticularSlidedown(e,t){return(0,w.mG)(this,void 0,void 0,function*(){var i,n;let o=null===(n=null===(i=this.context.appConfig.userConfig.promptOptions)||void 0===i?void 0:i.slidedown)||void 0===n?void 0:n.prompts,s=(null==t?void 0:t.slidedownPromptOptions)||eh.getFirstSlidedownPromptOptionsWithType(o,e);if(!s){if(e!==eE.Push)return void Q.Z.error(`OneSignal: slidedown of type '${e}' couldn't be shown. Check your configuration on the OneSignal dashboard or your custom code initialization.`);Q.Z.warn("The OneSignal 'push' slidedown will be shown with default text settings. To customize, see the OneSignal documentation.")}yield this.internalShowSlidedownPrompt(Object.assign(Object.assign({},t),{slidedownPromptOptions:s}))})}installEventHooksForSlidedown(){this.eventHooksInstalled=!0,OneSignal.emitter.on(tH.EVENTS.SHOWN,()=>{this.context.slidedownManager.setIsSlidedownShowing(!0)}),OneSignal.emitter.on(tH.EVENTS.CLOSED,()=>{this.context.slidedownManager.setIsSlidedownShowing(!1),this.context.slidedownManager.showQueued()}),OneSignal.emitter.on(tH.EVENTS.ALLOW_CLICK,()=>(0,w.mG)(this,void 0,void 0,function*(){yield this.context.slidedownManager.handleAllowClick(),e1.Z.trigger(OneSignal.EVENTS.TEST_FINISHED_ALLOW_CLICK_HANDLING)})),OneSignal.emitter.on(tH.EVENTS.CANCEL_CLICK,()=>{var e;if(this.context.slidedownManager.slidedown)switch(null===(e=this.context.slidedownManager.slidedown)||void 0===e?void 0:e.options.type){case eE.Push:case eE.Category:Q.Z.debug("Setting flag to not show the slidedown to the user again."),tX.markPromptDismissedWithType(f.Push);break;default:Q.Z.debug("Setting flag to not show the slidedown to the user again."),tX.markPromptDismissedWithType(f.NonPush)}})}isPageViewConditionMet(e){return!!e&&void 0!==e.pageViews&&!!e.autoPrompt&&!!e.enabled&&this.context.pageViewManager.getLocalPageViewCount()>=e.pageViews}getDelayedPromptOptions(e,t){var i,n,o,s;let r={enabled:!1,autoPrompt:!1,timeDelay:eo.timeDelay,pageViews:eo.pageViews};if(!e||!e.native||!e.slidedown)return r;switch(t){case eE.Native:{let a=e.native;return{enabled:null==a?void 0:a.enabled,autoPrompt:null==a?void 0:a.autoPrompt,timeDelay:null==a?void 0:a.timeDelay,pageViews:null==a?void 0:a.pageViews}}case eE.Push:case eE.Category:case eE.Email:case eE.Sms:case eE.SmsAndEmail:{let{userConfig:l}=this.context.appConfig,d=eh.getFirstSlidedownPromptOptionsWithType((null===(n=null===(i=l.promptOptions)||void 0===i?void 0:i.slidedown)||void 0===n?void 0:n.prompts)||[],t);return{enabled:!!d,autoPrompt:!!(null==d?void 0:d.autoPrompt),timeDelay:null===(o=null==d?void 0:d.delay)||void 0===o?void 0:o.timeDelay,pageViews:null===(s=null==d?void 0:d.delay)||void 0===s?void 0:s.pageViews}}default:return r}}}(this),this.dynamicResourceLoader=new e_}}class ip{static processItem(e,t){if("function"!=typeof t)throw new R.Z("Only accepts function type!");t(e)}}class ig extends tD{constructor(e){super(),this._permissionNative=e,this._permission=e===tU.Granted,iB.emitter.on(iB.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_STRING,e=>{this._permissionNative=e,this._permission=e===tU.Granted})}get permissionNative(){return this._permissionNative}get permission(){return this._permission}setDefaultUrl(e){return(0,w.mG)(this,void 0,void 0,function*(){if((0,j.tI)("setDefaultUrl",e),void 0===e)throw new eN.R("url",eN.Q.Empty);if("string"!=typeof e)throw new eN.R("url",eN.Q.WrongType);if(!tM.isValidUrl(e,{allowNull:!0}))throw new eN.R("url",eN.Q.Malformed);yield(0,j.JX)(),(0,j.tI)("setDefaultNotificationUrl",e);let t=yield eB.ZP.getAppState();t.defaultNotificationUrl=e,yield eB.ZP.setAppState(t)})}setDefaultTitle(e){return(0,w.mG)(this,void 0,void 0,function*(){if((0,j.tI)("setDefaultTitle",e),void 0===e)throw new eN.R("title",eN.Q.Empty);if("string"!=typeof e)throw new eN.R("title",eN.Q.WrongType);yield(0,j.JX)();let t=yield eB.ZP.getAppState();t.defaultNotificationTitle=e,yield eB.ZP.setAppState(t)})}isPushSupported(){return(0,j.tI)("isPushNotificationsSupported"),!0}requestPermission(){return(0,w.mG)(this,void 0,void 0,function*(){yield(0,j.JX)(),yield iB.context.promptsManager.internalShowNativePrompt()})}addEventListener(e,t){iB.emitter.on(e,t),"click"===e&&tL.fireStoredNotificationClicks()}removeEventListener(e,t){iB.emitter.off(e,t)}}class im extends tS{constructor(e,t){super(),this.modelCache=e,this.modelStores=t,Object.keys(t).forEach(e=>{t[e].subscribe(this.processModelChange.bind(this))})}processModelChange(e){(0,j.tI)("processModelChange",{modelStoreChange:e}),e.type===tv.Add&&this.processModelAdded(e),e.type===tv.Remove&&this.processModelRemoved(e),e.type===tv.Update&&this.processModelUpdated(e),e.type===tv.Hydrate&&this.processModelHydrated(e)}processModelAdded(e){(0,j.tI)("processModelAdded",{modelStoreChange:e});let{payload:t}=e;this.modelCache.add(t.modelName,t),this.broadcast({model:t,changeType:tv.Add})}processModelRemoved(e){(0,j.tI)("processModelRemoved",{modelStoreChange:e});let{modelId:t,payload:i}=e;this.modelCache.remove(i.modelName,t),this.broadcast({model:i,changeType:tv.Remove})}processModelUpdated(e){(0,j.tI)("processModelUpdated",{modelStoreChange:e});let{modelId:t,payload:i}=e;if(this.modelCache.update(i.model.modelName,t,i.property,i.newValue),i.oldValue!==i.newValue){let n={model:i.model,changeType:tv.Update,property:i.property,oldValue:i.oldValue,newValue:i.newValue};this.broadcast(n)}}processModelHydrated(e){(0,j.tI)("processModelHydrated",{modelStoreChange:e});let{modelId:t,payload:i}=e;this.modelCache.remove(i.modelName,t),this.modelCache.add(i.modelName,i)}}im.supportedModels=Object.values(tO.Q);class iv{constructor(e){this.result=e,this.success=!0,this.retriable=!1}}class i${constructor(e){this.result=e,this.success=!1,this.retriable=!0}}class ib{constructor(e){this.result=e,this.success=!1,this.retriable=!1}}function iy(e){var t;let i=e.model,n=null==i?void 0:i.data;if(!i)throw new R.Z(`processSubscriptionModel: bad subscription OSModel<SubscriptionModel>: ${JSON.stringify(i)}`);if(void 0===(null==(t=n)?void 0:t.type))throw new R.Z(`processSubscriptionModel: bad subscription object: ${JSON.stringify(n)}`);if(!i.onesignalId)throw new R.Z(`processSubscriptionModel: missing onesignalId: ${JSON.stringify(i)}`);let o;return tN(n)&&(o=null==n?void 0:n.id),{subscription:n,aliasPair:new L(L.ONESIGNAL_ID,i.onesignalId),subscriptionId:o,payload:e.payload}}function iS(e){var t;let i=null===(t=e.model)||void 0===t?void 0:t.data;if(!tx(i))throw new R.Z(`processIdentityModel: bad identity object: ${JSON.stringify(i)}`);let{onesignal_id:n}=i,o=JSON.parse(JSON.stringify(i));if(delete o.onesignal_id,!n)throw new R.Z(`processIdentityModel: missing onesignalId: ${JSON.stringify(i)}`);return{identity:o,aliasPair:new L(L.ONESIGNAL_ID,n)}}class iw{static addIdentity(e){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("addIdentity",e);let t=yield tb.getAppId(),{identity:i,aliasPair:n}=iS(e),o=yield ee.addAlias({appId:t},n,i);return iw._processIdentityResponse(o)})}static removeIdentity(e){return(0,w.mG)(this,void 0,void 0,function*(){if((0,j.tI)("removeIdentity",e),!e.payload)throw new R.Z("removeIdentity: operation.payload is not defined");if(1!==Object.keys(e.payload).length)throw new R.Z("removeIdentity: operation.payload must have exactly one key");let t=yield tb.getAppId(),i=Object.keys(e.payload)[0],{aliasPair:n}=iS(e),o=yield ee.deleteAlias({appId:t},n,i);return iw._processIdentityResponse(o)})}static _processIdentityResponse(e){if(!e)throw new R.Z("processIdentityResponse: response is not defined");let{status:t,result:i}=e,{identity:n}=i;if(t>=200&&t<300){if(!tx(n))throw new R.Z(`processIdentityResponse: result ${n} is not an identity object`);return new iv(n)}return t>=400&&t<500?new ib:new i$}}class iI{static addSubscription(e){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("SubscriptionRequests.addSubscription",e);let t=yield tb.getAppId(),{subscription:i,aliasPair:n}=iy(e),o=yield ee.createSubscription({appId:t},n,{subscription:i});return iI._processSubscriptionResponse(o)})}static removeSubscription(e){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("SubscriptionRequests.removeSubscription",e);let{subscriptionId:t}=iy(e);if(!t)throw new R.Z("removeSubscription: subscriptionId is not defined");let i=yield tb.getAppId(),n=yield ee.deleteSubscription({appId:i},t);return iI._processSubscriptionResponse(n)})}static updateSubscription(e){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("SubscriptionRequests.updateSubscription",e);let{payload:t,subscriptionId:i}=iy(e);if(!i)throw new R.Z("updateSubscription: subscriptionId is not defined");if(!t)throw new R.Z("updateSubscription: payload is not defined");let n=yield tb.getAppId(),o=yield ee.updateSubscription({appId:n},i,t);return iI._processSubscriptionResponse(o)})}static _processSubscriptionResponse(e){if(!e)throw Error("processSubscriptionResponse: response is not defined");let{status:t,result:i}=e,n=i.subscription;if(t>=200&&t<300){if(n&&!tN(n))throw new R.Z(`processSubscriptionResponse: bad subscription object: ${n}`);return new iv(n)}return t>=400&&t<500?new ib:new i$}}class iC{static updateUserProperties(e){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("UserPropertyRequests.updateUserProperties",e);let t=e.model,i=null==t?void 0:t.data;if(!i||!t)throw new R.Z(`updateUserProperty: bad identity model: ${t}`);if(!t.onesignalId)return Q.Z.info("Caching User Property update until subscription is created."),new ib;let n=new L(L.ONESIGNAL_ID,t.onesignalId),o=yield tb.getAppId(),s=yield OneSignal.coreDirector.getPushSubscriptionModel(),r;tN(null==s?void 0:s.data)&&(r=null==s?void 0:s.data.id);let a=yield ee.updateUser({appId:o,subscriptionId:r},n,{properties:i});return iC._processUserPropertyResponse(a)})}static _processUserPropertyResponse(e){if(!e)throw Error("processUserPropertyResponse: response is not defined");let{status:t,result:i}=e;return t>=200&&t<300?new iv(null==i?void 0:i.properties):t>=400&&t<500?new ib:new i$}}let iE={add:iI.addSubscription,remove:iI.removeSubscription,update:iI.updateSubscription},iP={[tO.Q.Identity]:{modelName:tO.Q.Identity,add:iw.addIdentity,remove:iw.removeIdentity},[tO.Q.Properties]:{modelName:tO.Q.Properties,update:iC.updateUserProperties},[tO.Q.PushSubscriptions]:Object.assign({modelName:tO.Q.PushSubscriptions},iE),[tO.Q.EmailSubscriptions]:Object.assign({modelName:tO.Q.EmailSubscriptions},iE),[tO.Q.SmsSubscriptions]:Object.assign({modelName:tO.Q.SmsSubscriptions},iE)};class iO{constructor(e,t,i){this.changeType=e,this.modelName=t,this.operationId=Math.random().toString(36).substring(2),this.payload=i?this.getPayload(i):void 0,this.model=i?i[i.length-1].model:void 0,this.timestamp=Date.now(),this.jwtTokenAvailable=new Promise(e=>(0,w.mG)(this,void 0,void 0,function*(){this.jwtToken=yield eB.ZP.getJWTToken(),e()}))}getPayload(e){return tT(e[0])?this.aggregateDeltas(e):e[0].model.data}aggregateDeltas(e){let t={};return e.forEach(e=>{if(tT(e)){let i=t.hasOwnProperty(e.property),n=tk(e.newValue);if(!(n===tk(e.oldValue)||void 0===e.oldValue))throw Error("Cannot merge incompatible values");let o=Object.assign(Object.assign({},t[e.property]),e.newValue);t[e.property]=i&&n?o:e.newValue}}),t}static getInstanceWithModelReference(e){var t;let{operationId:i,payload:n,modelName:o,changeType:s,timestamp:r,model:a}=e;if(!a)throw new R.Z("Operation.fromJSON: model is undefined");let l=null===(t=OneSignal.coreDirector)||void 0===t?void 0:t.getModelByTypeAndId(o,a.modelId);if(l){let d=new iO(s,o);return d.model=l,d.operationId=i,d.timestamp=r,d.payload=n,d.jwtToken=e.jwtToken,d.jwtTokenAvailable=Promise.resolve(),d}throw Error(`Could not find model with id ${a.modelId} of type ${o}. Maybe user logged out?`)}}class iT{static enqueue(e){(0,j.tI)("OperationCache.enqueue",{operation:e});let t=localStorage.getItem("operationCache"),i=t?JSON.parse(t):{};i[e.operationId]=e,localStorage.setItem("operationCache",JSON.stringify(i))}static getOperationsWithModelName(e){let t=localStorage.getItem("operationCache"),i=t?Object.values(JSON.parse(t)):[],n=[];for(let o=0;o<i.length;o++){let s=i[o];try{let r=iO.getInstanceWithModelReference(s);r&&n.push(r)}catch(a){Q.Z.warn(`Could not parse operation ${s.operationId} from cache`,a),this.delete(s.operationId)}}return n.sort((e,t)=>e.timestamp-t.timestamp).filter(t=>t.modelName===e)}static delete(e){(0,j.tI)("OperationCache.delete",{id:e});let t=localStorage.getItem("operationCache"),i=t?JSON.parse(t):{};delete i[e],localStorage.setItem("operationCache",JSON.stringify(i))}static flushOperations(){(0,j.tI)("OperationCache.flushOperations"),localStorage.removeItem("operationCache")}}class ik{constructor(e){this._deltaQueue=[],this._operationQueue=[],this.onlineStatus=!0,setInterval(()=>{this._deltaQueue.length>0&&this.processDeltaQueue.call(this)},1e3*ik.DELTAS_BATCH_PROCESSING_TIME),setInterval(()=>{Q.Z.debug("OneSignal: checking for operations to process from cache");let e=this.getOperationsFromCache();this._operationQueue=[...e,...this._operationQueue],this._operationQueue.length>0&&this._processOperationQueue.call(this)},1e3*ik.OPERATIONS_BATCH_PROCESSING_TIME),window.addEventListener("online",this._onNetworkChange.bind(this,!0)),window.addEventListener("offline",this._onNetworkChange.bind(this,!1)),this._executeAdd=e.add,this._executeUpdate=e.update,this._executeRemove=e.remove}enqueueDelta(e){(0,j.tI)("ExecutorBase.enqueueDelta",{delta:e});let t=JSON.parse(JSON.stringify(e));this._deltaQueue.push(t)}get deltaQueue(){return this._deltaQueue}get operationQueue(){return this._operationQueue}_enqueueOperation(e){(0,j.tI)("ExecutorBase.enqueueOperation",{operation:e}),this._operationQueue.push(e)}_flushDeltas(){(0,j.tI)("ExecutorBase._flushDeltas"),this._deltaQueue=[]}_flushOperations(){(0,j.tI)("ExecutorBase._flushOperations"),this._operationQueue=[]}_getChangeType(e,t){(0,j.tI)("ExecutorBase._getChangeType",{oldValue:e,newValue:t});let i;if(!e&&t)i=tv.Add;else if(!e||t){if(!(e!==t&&t&&e))throw Error("Unsupported change type");i=tv.Update}else i=tv.Remove;return i}_processOperationQueue(){return(0,w.mG)(this,void 0,void 0,function*(){let e=OneSignal.config.userConfig.requiresUserPrivacyConsent||eZ.getConsentRequired(),t=yield eB.ZP.getConsentGiven();if(!e||t)for(;this._operationQueue.length>0;){let i=this._operationQueue.shift();i&&(iT.enqueue(i),this.onlineStatus&&this._processOperation(i,ik.RETRY_COUNT).catch(e=>{Q.Z.error(e)}))}})}_processOperation(e,t){return(0,w.mG)(this,void 0,void 0,function*(){var i,n,o,s,r;(0,j.tI)("ExecutorBase._processOperation",{operation:e,retries:t}),yield null===(i=e.model)||void 0===i?void 0:i.awaitOneSignalIdAvailable,yield e.jwtTokenAvailable;let a={success:!1,retriable:!0};if((null==e?void 0:e.changeType)===tv.Add?a=yield null===(n=this._executeAdd)||void 0===n?void 0:n.call(this,e):(null==e?void 0:e.changeType)===tv.Remove?a=yield null===(o=this._executeRemove)||void 0===o?void 0:o.call(this,e):(null==e?void 0:e.changeType)===tv.Update&&(a=yield null===(s=this._executeUpdate)||void 0===s?void 0:s.call(this,e)),a.success){if(a.result){let l=yield iO.getInstanceWithModelReference(e);null===(r=null==l?void 0:l.model)||void 0===r||r.hydrate(a.result)}iT.delete(null==e?void 0:e.operationId)}else a.retriable&&t>0?setTimeout(()=>{this._processOperation(e,t-1).catch(e=>{Q.Z.error(e)})},5e3):iT.delete(null==e?void 0:e.operationId)})}_onNetworkChange(e){(0,j.tI)("ExecutorBase._onNetworkChange",{online:e}),this.onlineStatus=e,e&&this._processOperationQueue.call(this)}}ik.DELTAS_BATCH_PROCESSING_TIME=1,ik.OPERATIONS_BATCH_PROCESSING_TIME=5,ik.RETRY_COUNT=5;class ix extends ik{constructor(e){super(e)}processDeltaQueue(){if(0===this._deltaQueue.length)return;let e=[],t=[];this._deltaQueue.forEach(i=>{if(!tT(i))return;let n=this._getChangeType(i.oldValue,i.newValue);n===tv.Add||n===tv.Update?e.push(i):n===tv.Remove&&t.push(i)}),e.length>0&&this._enqueueOperation(new iO(tv.Add,tO.Q.Identity,e)),t.length>0&&this._enqueueOperation(new iO(tv.Remove,tO.Q.Identity,t)),this._flushDeltas()}getOperationsFromCache(){return iT.getOperationsWithModelName(tO.Q.Identity)}}class iN extends ik{constructor(e){super(e)}processDeltaQueue(){0!==this._deltaQueue.length&&(this._enqueueOperation(new iO(tv.Update,tO.Q.Properties,this._deltaQueue)),this._flushDeltas())}getOperationsFromCache(){return iT.getOperationsWithModelName(tO.Q.Properties)}}class iA extends ik{constructor(e){super(e)}processDeltaQueue(){this.separateDeltasByModelId().forEach(e=>{let t=this.separateDeltasByChangeType(e);Object.keys(t).forEach(e=>{let i=t[e];i.length>0&&this._enqueueOperation(new iO(e,i[0].model.modelName,i))})}),this._flushDeltas()}getOperationsFromCache(){return[...iT.getOperationsWithModelName(tO.Q.SmsSubscriptions),...iT.getOperationsWithModelName(tO.Q.EmailSubscriptions),...iT.getOperationsWithModelName(tO.Q.PushSubscriptions)]}separateDeltasByChangeType(e){let t={[tv.Add]:[],[tv.Remove]:[],[tv.Update]:[]};return e.forEach(e=>{var i;t[e.changeType]||(t[e.changeType]=[]),null===(i=t[e.changeType])||void 0===i||i.push(e)}),t}separateDeltasByModelId(){let e={};return this._deltaQueue.forEach(t=>{let{modelId:i}=t.model;e[i]||(e[i]=[]),e[i].push(t)}),Object.values(e)}}class i_{static build(e){switch(e.modelName){case tO.Q.Identity:return new ix(e);case tO.Q.Properties:return new iN(e);case tO.Q.PushSubscriptions:case tO.Q.EmailSubscriptions:case tO.Q.SmsSubscriptions:return new iA(e)}}}class iM{constructor(e){this.modelRepo=e,this.executorStore=new class e{constructor(){this.store={},Object.values(tO.Q).forEach(e=>{let t=iP[e];this.store[e]=i_.build(t)})}forceDeltaQueueProcessingOnAllExecutors(){Object.values(this.store).forEach(e=>{e.processDeltaQueue()})}},this._unsubscribeFromModelRepo=this.modelRepo.subscribe(e=>{this._processDelta(e)})}setModelRepoAndResubscribe(e){this.modelRepo=e,this._unsubscribeFromModelRepo(),this._unsubscribeFromModelRepo=this.modelRepo.subscribe(e=>{this._processDelta(e)})}forceDeltaQueueProcessingOnAllExecutors(){this.executorStore.forceDeltaQueueProcessingOnAllExecutors()}_processDelta(e){var t;(0,j.tI)("processDelta",{delta:e});let{modelName:i}=e.model;null===(t=this.executorStore.store[i])||void 0===t||t.enqueueDelta(e)}}class iD extends tS{constructor(e=[]){super(),this.models={},this.unsubscribeCallbacks={},e.forEach(e=>{this.models[e.modelId]=e,this.subscribeUpdateListener(e)})}add(e,t){this.subscribeUpdateListener(e),this.models[e.modelId]=e,t?this.broadcast(new tw(e.modelId,e)):this.broadcast(new tE(e.modelId,e))}remove(e){let t=JSON.stringify(this.models[e]);delete this.models[e],this.unsubscribeCallbacks[e](),this.broadcast(new tI(e,JSON.parse(t)))}subscribeUpdateListener(e){this.unsubscribeCallbacks[e.modelId]=e.subscribe(t=>{var i,n;let{payload:o}=t;t.type===tv.Update&&null!==(i=o)&&"object"==typeof i&&(null==i?void 0:i.constructor)===ty?this.broadcast(new tC(e.modelId,o)):t.type===tv.Hydrate&&null!==(n=o)&&"object"==typeof n&&(null==n?void 0:n.constructor)===tP&&this.broadcast(new tE(e.modelId,o))})}}class iZ{static build(e){let t={};return Object.values(tO.Q).forEach(i=>{let n=e?e[i]:void 0,o=new iD(n);t[i]=o}),t}}class i8{constructor(){this.initResolver=()=>null,this.initPromise=new Promise(e=>{this.initResolver=e}),this.modelCache=new class e{constructor(){this._mutexPromise=Promise.resolve(),this._mutexLocked=!1}add(e,t){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("ModelCache.add",{modelName:e,model:t});let i=t.encode(),n=Object.assign({},i);yield eB.ZP.put(e,n)})}remove(e,t){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("ModelCache.remove",{modelName:e,modelId:t}),yield eB.ZP.remove(e,t)})}update(e,t,i,n){return(0,w.mG)(this,void 0,void 0,function*(){this._mutexLocked&&(yield this._mutexPromise),this._mutexLocked=!0,this._mutexPromise=new Promise((o,s)=>(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("ModelCache.update",{modelName:e,modelId:t,key:i,value:n});let r=yield this.get(e,t);r||s("ModelCache: Attempting to update a model that does not exist"),r&&(r[i]=n,yield eB.ZP.put(e,r),this._mutexLocked=!1,o()),setTimeout(s.bind(this,"Database promise never resolved."),1e4)}))})}load(e){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("ModelCache.load",{modelNames:e});let t={};for(let i=0;i<e.length;i++){let n=e[i],o=yield this.getAndDecodeModelsWithModelName(n);o&&(t[n]=o)}return t})}get(e,t){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("ModelCache.get",{modelName:e,modelId:t});try{return yield this._mutexPromise,yield eB.ZP.get(e,t)}catch(i){return}})}getCachedEncodedModels(e){return(0,w.mG)(this,void 0,void 0,function*(){return(0,j.tI)("ModelCache.getCachedEncodedModels",{modelName:e}),yield eB.ZP.getAll(e)})}getAndDecodeModelsWithModelName(e){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("ModelCache.getAndDecodeModelsWithModelName",{modelName:e});let t=yield this.getCachedEncodedModels(e);if(0!==Object.keys(t).length)return t.map(tP.decode)})}reset(){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("ModelCache.reset");let e=[];Object.values(tO.Q).forEach(t=>(0,w.mG)(this,void 0,void 0,function*(){e.push(eB.ZP.singletonInstance.remove(t))})),yield Promise.all(e)})}},this.modelCache.load(im.supportedModels).then(e=>{let t=iZ.build(e);this.modelRepo=new im(this.modelCache,t),this.operationRepo=new iM(this.modelRepo),this.initResolver()}).catch(e=>{Q.Z.error(e)})}init(){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("CoreModule.init"),yield this.initPromise})}resetModelRepoAndCache(){return(0,w.mG)(this,void 0,void 0,function*(){var e;(0,j.tI)("CoreModule.resetModelRepo"),yield this.modelCache.reset();let t=iZ.build();this.modelRepo=new im(this.modelCache,t),null===(e=this.operationRepo)||void 0===e||e.setModelRepoAndResubscribe(this.modelRepo)})}forceDeltaQueueProcessingOnAllExecutors(){var e;null===(e=this.operationRepo)||void 0===e||e.forceDeltaQueueProcessingOnAllExecutors()}}class iU{constructor(e){this.core=e}generatePushSubscriptionModel(e){(0,j.tI)("CoreModuleDirector.generatePushSubscriptionModel",{rawPushSubscription:e});let t=new tP(tO.Q.PushSubscriptions,new F(e).serialize()),i=t_.createOrGetInstance();i.hasOneSignalId&&t.setOneSignalId(i.onesignalId),iB.coreDirector.add(tO.Q.PushSubscriptions,t,!1)}resetModelRepoAndCache(){return(0,w.mG)(this,void 0,void 0,function*(){yield this.core.resetModelRepoAndCache()})}hydrateUser(e){(0,j.tI)("CoreModuleDirector.hydrateUser",{user:e});try{let t=this.getIdentityModel(),i=this.getPropertiesModel(),{onesignal_id:n}=e.identity;if(!n)throw new R.Z("OneSignal ID is missing from user data");null==t||t.setOneSignalId(n),null==i||i.setOneSignalId(n),null==t||t.hydrate(e.identity),null==i||i.hydrate(e.properties),this._hydrateSubscriptions(e.subscriptions,n),tL.checkAndTriggerUserChanged()}catch(o){Q.Z.error(`Error hydrating user: ${o}`)}}_hydrateSubscriptions(e,t){if((0,j.tI)("CoreModuleDirector._hydrateSubscriptions",{subscriptions:e}),!e)return;let i=this.getModelStores();e.forEach(e=>(0,w.mG)(this,void 0,void 0,function*(){var n;let o="Email"===(n=e).type?tO.Q.EmailSubscriptions:"SMS"===n.type?tO.Q.SmsSubscriptions:tO.Q.PushSubscriptions,s=e.token?this.getSubscriptionOfTypeWithToken(o,e.token):void 0;if(s)s.setOneSignalId(t),s.hydrate(e);else{let r=new tP(o,e);r.setOneSignalId(t),i[o].add(r,!1)}}))}forceDeltaQueueProcessingOnAllExecutors(){(0,j.tI)("CoreModuleDirector.forceDeltaQueueProcessingOnAllExecutors"),this.core.forceDeltaQueueProcessingOnAllExecutors()}add(e,t,i=!0){(0,j.tI)("CoreModuleDirector.add",{modelName:e,model:t}),this.getModelStores()[e].add(t,i)}remove(e,t){(0,j.tI)("CoreModuleDirector.remove",{modelName:e,modelId:t}),this.getModelStores()[e].remove(t)}getModelByTypeAndId(e,t){return(0,j.tI)("CoreModuleDirector.getModelByTypeAndId",{modelName:e,modelId:t}),this.getModelStores()[e].models[t]}getEmailSubscriptionModels(){return(0,j.tI)("CoreModuleDirector.getEmailSubscriptionModels"),this.getModelStores().emailSubscriptions.models}hasEmail(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield this.getEmailSubscriptionModels();return Object.keys(e).length>0})}getSmsSubscriptionModels(){return(0,j.tI)("CoreModuleDirector.getSmsSubscriptionModels"),this.getModelStores().smsSubscriptions.models}hasSms(){return(0,w.mG)(this,void 0,void 0,function*(){let e=yield this.getSmsSubscriptionModels();return Object.keys(e).length>0})}getAllPushSubscriptionModels(){return(0,j.tI)("CoreModuleDirector.getAllPushSubscriptionModels"),this.getModelStores().pushSubscriptions.models}getPushSubscriptionModelByCurrentToken(){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("CoreModuleDirector.getPushSubscriptionModelByCurrentToken");let e=yield tb.getCurrentPushToken();if(e)return this.getSubscriptionOfTypeWithToken(tO.Q.PushSubscriptions,e)})}getPushSubscriptionModelByLastKnownToken(){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("CoreModuleDirector.getPushSubscriptionModelByLastKnownToken");let{lastKnownPushToken:e}=yield eB.ZP.getAppState();if(e)return this.getSubscriptionOfTypeWithToken(tO.Q.PushSubscriptions,e)})}getPushSubscriptionModel(){return(0,w.mG)(this,void 0,void 0,function*(){return(0,j.tI)("CoreModuleDirector.getPushSubscriptionModel"),(yield this.getPushSubscriptionModelByCurrentToken())||(yield this.getPushSubscriptionModelByLastKnownToken())})}getIdentityModel(){(0,j.tI)("CoreModuleDirector.getIdentityModel");let e=this.getModelStores(),t=Object.keys(e.identity.models);return e.identity.models[t[0]]}getPropertiesModel(){(0,j.tI)("CoreModuleDirector.getPropertiesModel");let e=this.getModelStores(),t=Object.keys(e.properties.models);return e.properties.models[t[0]]}getAllSubscriptionsModels(){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("CoreModuleDirector.getAllSubscriptionsModels");let e=this.getEmailSubscriptionModels(),t=this.getSmsSubscriptionModels(),i=yield this.getPushSubscriptionModel();return Object.values(e).concat(Object.values(t)).concat(i?[i]:[])})}getSubscriptionOfTypeWithToken(e,t){switch((0,j.tI)("CoreModuleDirector.getSubscriptionOfTypeWithToken",{type:e,token:t}),e){case tO.Q.EmailSubscriptions:{let i=this.getEmailSubscriptionModels();return Object.values(i).find(e=>e.data.token===t)}case tO.Q.SmsSubscriptions:{let n=this.getSmsSubscriptionModels();return Object.values(n).find(e=>e.data.token===t)}case tO.Q.PushSubscriptions:{let o=this.getAllPushSubscriptionModels();return Object.values(o).find(e=>e.data.token===t)}default:return}}getModelStores(){var e;return null===(e=this.core.modelRepo)||void 0===e?void 0:e.modelStores}}class iG{static login(e,t){return(0,w.mG)(this,void 0,void 0,function*(){var i,n;let o=eZ.getConsentRequired(),s=yield eB.ZP.getConsentGiven();if(o&&!s)throw new R.Z("Login: Consent required but not given, skipping login");try{iB.coreDirector.forceDeltaQueueProcessingOnAllExecutors(),t&&(yield eB.ZP.setJWTToken(t));let r=iB.coreDirector.getIdentityModel(),a=null==r?void 0:r.onesignalId;if(!r)throw new R.Z("Login: No identity model found");if((null===(i=null==r?void 0:r.data)||void 0===i?void 0:i.external_id)===e)return void Q.Z.debug("Login: External ID already set, skipping login");let l=yield iB.coreDirector.getPushSubscriptionModel(),d;l&&tN(l.data)&&(d=l.data.id);let c=iG.isIdentified(r.data),u;if(iG.setExternalId(r,e),c){u={identity:{external_id:e}};let h=yield iB.coreDirector.getPushSubscriptionModel();h&&(u.subscriptions=[h.data])}else u=yield tA.getAllUserData();yield iB.coreDirector.resetModelRepoAndCache(),yield tA.initializeUser(!0);try{let p=yield iG.identifyOrUpsertUser(u,c,d),g=null===(n=null==p?void 0:p.identity)||void 0===n?void 0:n.onesignal_id;if(!g)return void Q.Z.info("Caching login call, waiting on network or subscription creation.");yield iG.fetchAndHydrate(g)}catch(m){if(Q.Z.error(`Login: Error while identifying/upserting user: ${m.message}`),a){Q.Z.debug("Login: Restoring old user data");try{yield iG.fetchAndHydrate(a)}catch(f){Q.Z.error(`Login: Error while restoring old user data: ${f.message}`)}}throw m}}catch(v){Q.Z.error(v)}})}static logout(){return(0,w.mG)(this,void 0,void 0,function*(){let e=iB.coreDirector.getIdentityModel();if(!e||!e.data||!e.data.external_id)return void Q.Z.debug("Logout: User is not logged in, skipping logout");iB.coreDirector.forceDeltaQueueProcessingOnAllExecutors(),tA.resetUserMetaProperties();let t=yield iB.coreDirector.getPushSubscriptionModel();yield iB.coreDirector.resetModelRepoAndCache(),iB.coreDirector.add(tO.Q.PushSubscriptions,t,!1),yield tA.initializeUser(!1)})}static setExternalId(e,t){if((0,j.tI)("LoginManager.setExternalId",{externalId:t}),!e)throw new R.Z("login: no identity model found");e.set("external_id",t,!1)}static isIdentified(e){return(0,j.tI)("LoginManager.isIdentified",{identity:e}),void 0!==e.external_id}static identifyOrUpsertUser(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){let n;return(0,j.tI)("LoginManager.identifyOrUpsertUser",{userData:e,isIdentified:t,subscriptionId:i}),n=t?yield this.upsertUser(e,i):yield this.identifyUser(e,i)})}static upsertUser(e,t,i=5){return(0,w.mG)(this,void 0,void 0,function*(){if((0,j.tI)("LoginManager.upsertUser",{userData:e,subscriptionId:t}),0===i)throw new R.Z("Login: upsertUser failed: max retries reached");let n=yield tb.getAppId(),o=JSON.parse(JSON.stringify(e));this.stripAliasesOtherThanExternalId(e);let s=yield ee.createUser({appId:n,subscriptionId:t},e),r=null==s?void 0:s.result,a=null==s?void 0:s.status;if(a>=200&&a<300)Q.Z.info("Successfully created user",r);else if(a>=400&&a<500)Q.Z.error("Malformed request",r);else if(a>=500)return Q.Z.error("Server error. Retrying..."),yield q(K[i]),this.upsertUser(o,t,i-1);return r})}static identifyUser(e,t,i=5){return(0,w.mG)(this,void 0,void 0,function*(){var n;if((0,j.tI)("LoginManager.identifyUser",{userData:e,pushSubscriptionId:t}),0===i)throw new R.Z("Login: identifyUser failed: max retries reached");let{onesignal_id:o}=e.identity,s=JSON.parse(JSON.stringify(e));this.stripAliasesOtherThanExternalId(e);let{identity:r}=e;if(!r)throw new R.Z("identifyUser failed: no identity found");if(!o){let a=iB.coreDirector.getIdentityModel();return null==a||a.set(L.EXTERNAL_ID,r.external_id,!1),e}let l=yield tb.getAppId(),d=new L(L.ONESIGNAL_ID,o),c=yield ee.addAlias({appId:l},d,r),u=null==c?void 0:c.status;if(u>=200&&u<300)Q.Z.info("identifyUser succeeded");else{if(409===u&&t)return yield this.transferSubscription(l,t,r);if(u>=400&&u<500)throw new R.Z(`identifyUser: malformed request: ${JSON.stringify(null==c?void 0:c.result)}`);if(u>=500)return Q.Z.error("identifyUser failed: server error. Retrying..."),yield q(K[i]),this.identifyUser(s,t,i-1)}return{identity:null===(n=null==c?void 0:c.result)||void 0===n?void 0:n.identity}})}static fetchAndHydrate(e){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("LoginManager.fetchAndHydrate",{onesignalId:e});let t=yield ee.getUser({appId:yield tb.getAppId()},new L(L.ONESIGNAL_ID,e));iB.coreDirector.hydrateUser(null==t?void 0:t.result)})}static stripAliasesOtherThanExternalId(e){(0,j.tI)("LoginManager.stripAliasesOtherThanExternalId",{userData:e});let{identity:t}=e;if(!t)throw new R.Z("stripAliasesOtherThanExternalId failed: no identity found");let{external_id:i}=t;if(!i)throw new R.Z("stripAliasesOtherThanExternalId failed: no external_id found");e.identity={external_id:i}}static transferSubscription(e,t,i){return(0,w.mG)(this,void 0,void 0,function*(){Q.Z.error("^^^ Handling 409 HTTP response reported by the browser above. This is an expected result when the User already exists. Push subscription is being transferred the existing User.");let n=yield ee.transferSubscription({appId:e},t,i,!1),o=null==n?void 0:n.status,s=null==n?void 0:n.result;if(o&&o>=200&&o<300)return Q.Z.info("transferSubscription succeeded"),{identity:null==s?void 0:s.identity};throw new R.Z(`transferSubscription failed: ${JSON.stringify(s)}}`)})}}class iB{static _initializeCoreModuleAndOSNamespaces(){return(0,w.mG)(this,void 0,void 0,function*(){let e=new i8;yield e.initPromise,iB.coreDirector=new iU(e);let t=yield eB.ZP.getSubscription(),i=yield iB.context.permissionManager.getPermissionStatus();iB.User=new tF(!0,t,i),this.Notifications=new ig(i)})}static _initializeConfig(e){return(0,w.mG)(this,void 0,void 0,function*(){let t=yield(new em).getAppConfig(e);Q.Z.debug("OneSignal: Final web app config:",t),iB.config=t,iB.environmentInfo=O.getEnvironmentInfo(),iB.context=new ih(t),iB.config=iB.context.appConfig})}static login(e,t){return(0,w.mG)(this,void 0,void 0,function*(){if((0,j.tI)("login",{externalId:e,jwtToken:t}),void 0===e)throw new eN.R("externalId",eN.Q.Empty);if("string"!=typeof e)throw new eN.R("externalId",eN.Q.WrongType);if(void 0!==t&&"string"!=typeof t)throw new eN.R("jwtToken",eN.Q.WrongType);yield iG.login(e,t)})}static logout(){return(0,w.mG)(this,void 0,void 0,function*(){(0,j.tI)("logout"),iG.logout()})}static init(e){return(0,w.mG)(this,void 0,void 0,function*(){if((0,j.tI)("init"),Q.Z.debug(`Browser Environment: ${(0,P.M)().name} ${(0,P.M)().version}`),eZ.removeLegacySubscriptionOptions(),yield ic.polyfillSafariFetch(),ic.errorIfInitAlreadyCalled(),yield iB._initializeConfig(e),!iB.config)throw Error("OneSignal config not initialized!");if("safari"!=(0,P.M)().name||iB.config.safariWebId){if(yield iB._initializeCoreModuleAndOSNamespaces(),eZ.getConsentRequired()&&!(yield eB.ZP.getConsentGiven()))return void(iB.pendingInit=!0);yield iB._delayedInit()}else Q.Z.warn(new X(eI.MissingSafariWebId))})}static _delayedInit(){return(0,w.mG)(this,void 0,void 0,function*(){function e(){return(0,w.mG)(this,void 0,void 0,function*(){iB.__initAlreadyCalled||(iB.__initAlreadyCalled=!0,iB.emitter.on(iB.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_STRING,tL.onNotificationPermissionChange),iB.emitter.on(iB.EVENTS.SUBSCRIPTION_CHANGED,tL._onSubscriptionChanged),iB.emitter.on(iB.EVENTS.SDK_INITIALIZED,ic.onSdkInitialized),window.addEventListener("focus",()=>{tb.checkAndTriggerNotificationPermissionChanged()}),yield ic.initSaveState(),yield ic.saveInitOptions(),yield ic.internalInit())})}iB.pendingInit=!1,iB.context.workerMessenger.listen(),"complete"===document.readyState||"interactive"===document.readyState?yield e():(Q.Z.debug("OneSignal: Waiting for DOMContentLoaded or readyStateChange event before continuing initialization..."),window.addEventListener("DOMContentLoaded",()=>{e()}),document.onreadystatechange=()=>{"complete"!==document.readyState&&"interactive"!==document.readyState||e()})})}static setConsentGiven(e){return(0,w.mG)(this,void 0,void 0,function*(){if((0,j.tI)("setConsentGiven",{consent:e}),void 0===e)throw new eN.R("consent",eN.Q.Empty);if("boolean"!=typeof e)throw new eN.R("consent",eN.Q.WrongType);yield eB.ZP.setConsentGiven(e),e&&iB.pendingInit&&(yield iB._delayedInit())})}static setConsentRequired(e){return(0,w.mG)(this,void 0,void 0,function*(){if((0,j.tI)("setConsentRequired",{requiresConsent:e}),void 0===e)throw new eN.R("requiresConsent",eN.Q.Empty);if("boolean"!=typeof e)throw new eN.R("requiresConsent",eN.Q.WrongType);eZ.setConsentRequired(e)})}static push(e){ip.processItem(iB,e)}}iB.EVENTS={NOTIFICATION_PERMISSION_CHANGED_AS_STRING:"permissionChangeAsString",NOTIFICATION_PERMISSION_CHANGED_AS_BOOLEAN:"permissionChange",SUBSCRIPTION_CHANGED:"change",WELCOME_NOTIFICATION_SENT:"sendWelcomeNotification",NOTIFICATION_WILL_DISPLAY:"foregroundWillDisplay",NOTIFICATION_DISMISSED:"dismiss",NOTIFICATION_CLICKED:"click",SDK_INITIALIZED:"initializeInternal",SDK_INITIALIZED_PUBLIC:"initialize",REGISTERED:"register",PERMISSION_PROMPT_DISPLAYED:"permissionPromptDisplay",TEST_FINISHED_ALLOW_CLICK_HANDLING:"testFinishedAllowClickHandling",SESSION_STARTED:"os.sessionStarted"},iB.VERSION=B.Z.version(),iB._VERSION=B.Z.version(),iB.sdkEnvironment=A.Z,iB.config=null,iB._sessionInitAlreadyRunning=!1,iB._isNewVisitor=!1,iB.timedLocalStorage=tz,iB.initialized=!1,iB._didLoadITILibrary=!1,iB.notifyButton=null,iB.environment=B.Z,iB.database=eB.ZP,iB.event=e1.Z,iB.pendingInit=!0,iB.emitter=new t1.Z,iB.cache={},iB._LOGGING=!1,iB.LOGGING=!1,iB._initCalled=!1,iB.__initAlreadyCalled=!1,iB.Notifications=new ig,iB.Slidedown=new class extends tD{constructor(){super()}promptPush(e){return(0,w.mG)(this,void 0,void 0,function*(){yield(0,j.JX)(),yield iB.context.promptsManager.internalShowParticularSlidedown(eE.Push,e)})}promptPushCategories(e){return(0,w.mG)(this,void 0,void 0,function*(){yield(0,j.JX)();let t=yield iB.context.subscriptionManager.isPushNotificationsEnabled();yield iB.context.promptsManager.internalShowCategorySlidedown(Object.assign(Object.assign({},e),{isInUpdateMode:t}))})}promptSms(e){return(0,w.mG)(this,void 0,void 0,function*(){yield(0,j.JX)(),yield iB.context.promptsManager.internalShowSmsSlidedown(Object.assign({},e))})}promptEmail(e){return(0,w.mG)(this,void 0,void 0,function*(){yield(0,j.JX)(),yield iB.context.promptsManager.internalShowEmailSlidedown(Object.assign({},e))})}promptSmsAndEmail(e){return(0,w.mG)(this,void 0,void 0,function*(){yield(0,j.JX)(),yield iB.context.promptsManager.internalShowSmsAndEmailSlidedown(Object.assign({},e))})}addEventListener(e,t){iB.emitter.on(e,t)}removeEventListener(e,t){iB.emitter.off(e,t)}},iB.Session=new class{sendOutcome(e,t){return(0,w.mG)(this,void 0,void 0,function*(){let i=OneSignal.config.userConfig.outcomes;if(!i)return void Q.Z.error(`Could not send ${e}. No outcomes config found.`);let n=new e0(OneSignal.config.appId,i,e,!1);if(void 0!==t&&"number"!=typeof t)return void Q.Z.error("Outcome weight can only be a number if present.");if(!(yield n.beforeOutcomeSend()))return;let o=yield n.getAttribution();yield n.send({type:o.type,notificationIds:o.notificationIds,weight:t})})}sendUniqueOutcome(e){return(0,w.mG)(this,void 0,void 0,function*(){let t=OneSignal.config.userConfig.outcomes;if(!t)return void Q.Z.error(`Could not send ${e}. No outcomes config found.`);let i=new e0(OneSignal.config.appId,t,e,!0);if(!(yield i.beforeOutcomeSend()))return;let n=yield i.getAttribution();if(n.type===eC.NotSupported)return void Q.Z.warn("You are on a free plan. Please upgrade to use this functionality.");let{notificationIds:o}=n,s=yield i.getNotifsToAttributeWithUniqueOutcome(o);i.shouldSendUnique(n,s)?yield i.send({type:n.type,notificationIds:s}):Q.Z.warn(`'${e}' was already reported for all notifications.`)})}},iB.User=new tF(!1),iB.Debug=new class{setLogLevel(e){Q.Z.setLevel(e)}},Q.Z.info(`OneSignal Web SDK loaded (version ${iB._VERSION},
  ${A.Z.getWindowEnv().toString()} environment).`),Q.Z.debug(`Current Page URL: ${"undefined"==typeof location?"NodeJS":location.href}`)},191(e,t,i){"use strict";i.d(t,{Z:()=>o});var n=i(608);class o{static push(e){n.Z.push(e)}}},50(e,t,i){"use strict";i.d(t,{c:()=>s,Z:()=>r});var n=i(752);class o extends n.Z{constructor(e="The asynchronous operation has timed out."){super(e),this.message=e,Object.setPrototypeOf(this,o.prototype)}}class s{static contains(e,t){return!!e&&-1!==e.indexOf(t)}static trimUndefined(e){for(let t in e)void 0===e[t]&&delete e[t];return e}static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}static isNullOrUndefined(e){return null==e}static valueOrDefault(e,t){return null==e?t:e}static stringify(e){return JSON.stringify(e,(e,t)=>"function"==typeof t?"[Function]":t,4)}static encodeHashAsUriComponent(e){let t="",i=Object.keys(e);for(let n of i){let o=e[n];t+=`${encodeURIComponent(n)}=${encodeURIComponent(o)}`}return t}static timeoutPromise(e,t){let i=new Promise((e,i)=>{setTimeout(()=>{i(new o)},t)});return Promise.race([e,i])}static getValueOrDefault(e,t){return null!=e?e:t}static padStart(e,t,i){let n=e;for(;n.length<t;)n=i+n;return n}static parseVersionString(e){let t=e.toString().split("."),i=s.padStart(t[0],2,"0"),n;return Number(`${i}.${n=t[1]?s.padStart(t[1],2,"0"):"00"}`)}static lastParts(e,t,i){let n=e.split(t),o=Math.max(n.length-i,0);return n.slice(o).join(t)}static enforceAppId(e){if(!e)throw Error("App id cannot be empty")}static enforceAlias(e){if(!e.label)throw Error("Alias label cannot be empty");if(!e.id)throw Error("Alias id cannot be empty")}static sortArrayOfObjects(e,t,i=!1,n=!0){let o=n?e:e.slice();return o.sort((e,n)=>{let o=t(e),s=t(n);return o>s?i?-1:1:o<s?i?1:-1:0}),o}}let r=s},86(e,t,i){"use strict";i.d(t,{Q:()=>n,R:()=>r});var n,o,s=i(752);(o=n||(n={}))[o.Empty=0]="Empty",o[o.Malformed=1]="Malformed",o[o.EnumOutOfRange=2]="EnumOutOfRange",o[o.WrongType=3]="WrongType";class r extends s.Z{constructor(e,t,i){let o;switch(t){case n.Empty:o=`Supply a non-empty value to '${e}'. ${i}`;break;case n.Malformed:o=`The value for '${e}' was malformed. ${i}`;break;case n.EnumOutOfRange:o=`The value for '${e}' was out of range of the expected input enum. ${i}`;break;case n.WrongType:o=`The value for '${e}' was of the wrong type. ${i}`}super(o),this.argument=e,this.reason=n[t],Object.setPrototypeOf(this,r.prototype)}}},752(e,t,i){"use strict";i.d(t,{Z:()=>n});class n extends Error{constructor(e=""){super(e),Object.defineProperty(this,"message",{configurable:!0,enumerable:!1,value:e,writable:!0}),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:this.constructor.name,writable:!0}),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,this.constructor):(Object.defineProperty(this,"stack",{configurable:!0,enumerable:!1,value:Error(e).stack,writable:!0}),Object.setPrototypeOf(this,n.prototype))}}},930(e,t,i){"use strict";i.d(t,{Z:()=>r});var n=i(326),o=i(468),s=i(450);class r{static isBrowser(){return"undefined"!=typeof window}static useSafariLegacyPush(){var e;return this.isBrowser()&&null!=(null===(e=window.safari)||void 0===e?void 0:e.pushNotification)}static useSafariVapidPush(){return"safari"==(0,s.M)().name&&"undefined"!=typeof PushSubscriptionOptions&&PushSubscriptionOptions.prototype.hasOwnProperty("applicationServerKey")&&!this.useSafariLegacyPush()}static version(){return Number(160200)}static get TRADITIONAL_CHINESE_LANGUAGE_TAG(){return["tw","hant"]}static get SIMPLIFIED_CHINESE_LANGUAGE_TAG(){return["cn","hans"]}static getLanguage(){let e=navigator.language;if(e){e=e.toLowerCase();let t=e.split("-");if("zh"==t[0]){for(let i of r.TRADITIONAL_CHINESE_LANGUAGE_TAG)if(-1!==t.indexOf(i))return"zh-Hant";for(let n of r.SIMPLIFIED_CHINESE_LANGUAGE_TAG)if(-1!==t.indexOf(n))return"zh-Hans";return"zh-Hant"}return t[0].substring(0,2)}return"en"}static supportsServiceWorkers(){return n.Z.getWindowEnv()===o.Q.ServiceWorker||"undefined"!=typeof navigator&&"serviceWorker"in navigator}static getSdkStylesVersionHash(){return"undefined"==typeof __SRC_STYLESHEETS_MD5_HASH__?"2":__SRC_STYLESHEETS_MD5_HASH__}}},680(e,t,i){"use strict";i.d(t,{Z:()=>o});var n=i(655);class o{constructor(){this._events={}}on(e,t){return this._events[e]=this._events[e]||[],this._events[e].push(t),this}once(e,t){let i=this;function n(){i.off(e,n),t.apply(this,arguments)}return n.listener=t,this.on(e,n),this}off(e,t){let i=this._events[e];if(void 0!==i){for(let n=0;n<i.length;n+=1)if(i[n]===t||i[n].listener===t){i.splice(n,1);break}0===i.length&&this.removeAllListeners(e)}return this}removeAllListeners(e){return e?delete this._events[e]:this._events={},this}listeners(e){try{return this._events[e]}catch(t){return}}numberOfListeners(e){let t=this.listeners(e);return t?t.length:0}emit(...e){return(0,n.mG)(this,void 0,void 0,function*(){let t=e.shift(),i=this._events[t];if(void 0!==i){i=i.slice(0);let n=i.length;for(let o=0;o<n;o+=1)yield i[o].apply(this,e)}return this})}}},107(e,t,i){"use strict";i.d(t,{Z:()=>n});class n{static shouldLog(){try{if("undefined"==typeof window||void 0===window.localStorage)return!1;let e=window.localStorage.getItem("loglevel");return!(!e||"trace"!==e.toLowerCase())}catch(t){return!1}}static setLevel(e){if("undefined"!=typeof window&&void 0!==window.localStorage)try{window.localStorage.setItem("loglevel",e),n.proxyMethodsCreated=void 0,n.createProxyMethods()}catch(t){return}}static createProxyMethods(){if(void 0!==n.proxyMethodsCreated)return;n.proxyMethodsCreated=!0;let e={log:"debug",trace:"trace",info:"info",warn:"warn",error:"error"};for(let t of Object.keys(e)){let i=void 0!==console[t],o=e[t],s=i&&(n.shouldLog()||"error"===o);n[o]=s?console[t].bind(console):function(){}}}}n.createProxyMethods()},326(e,t,i){"use strict";i.d(t,{Z:()=>d}),(n=o||(o={})).Development="Development",n.Staging="Staging",n.Production="Production";var n,o,s=i(468),r=i(86),a=i(930);let l=["outcomes","on_focus"];class d{static getBuildEnv(){return o.Production}static getApiEnv(){return o.Production}static getOrigin(){return a.Z.isBrowser()?window.location.origin:"undefined"!=typeof self&&"undefined"!=typeof ServiceWorkerGlobalScope?self.location.origin:"Unknown"}static getWindowEnv(){if("undefined"==typeof window){if("undefined"!=typeof self&&"undefined"!=typeof ServiceWorkerGlobalScope)return s.Q.ServiceWorker;throw Error("OneSignalSDK: Unsupported JS runtime!")}return s.Q.Host}static getBuildEnvPrefix(e=d.getBuildEnv()){switch(e){case o.Development:return"Dev-";case o.Staging:return"Staging-";case o.Production:return"";default:throw new r.R("buildEnv",r.Q.EnumOutOfRange)}}static getOneSignalApiUrl(e=d.getApiEnv(),t){let i="onesignal.com";switch(e){case o.Development:return new URL(d.isTurbineEndpoint(t)?`https://${i}:18080/api/v1`:`https://${i}:3001/api/v1`);case o.Staging:return new URL(`https://${i}/api/v1`);case o.Production:return new URL("https://onesignal.com/api/v1");default:throw new r.R("buildEnv",r.Q.EnumOutOfRange)}}static getOneSignalStaticResourcesUrl(){return new URL("https://media.onesignal.com/web-sdk")}static getOneSignalResourceUrlPath(e=d.getBuildEnv()){let t="localhost",i;switch(e){case o.Development:i=`http://${t}:4000`;break;case o.Staging:i=`https://${t}`;break;case o.Production:i="https://onesignal.com";break;default:throw new r.R("buildEnv",r.Q.EnumOutOfRange)}return new URL(`${i}/sdks/web/v16`)}static getOneSignalCssFileName(e=d.getBuildEnv()){let t="OneSignalSDK.page.styles.css";switch(e){case o.Development:return`Dev-${t}`;case o.Staging:return`Staging-${t}`;case o.Production:return t;default:throw new r.R("buildEnv",r.Q.EnumOutOfRange)}}static isTurbineEndpoint(e){return!!e&&l.some(t=>e.indexOf(t)>-1)}}},392(e,t,i){"use strict";var n,o,s,r;i.d(t,{$y:()=>n,I0:()=>l,Ky:()=>a,eB:()=>o}),(s=n||(n={})).Active="active",s.Inactive="inactive",(r=o||(o={}))[r.UserCreate=1]="UserCreate",r[r.UserNewSession=2]="UserNewSession",r[r.VisibilityVisible=3]="VisibilityVisible",r[r.VisibilityHidden=4]="VisibilityHidden",r[r.BeforeUnload=5]="BeforeUnload",r[r.PageRefresh=6]="PageRefresh",r[r.Focus=7]="Focus",r[r.Blur=8]="Blur";let a="oneSignalSession";function l(e){let t=(new Date).getTime(),i=e&&e.notificationId||null;return{sessionKey:a,appId:e.appId,startTimestamp:t,accumulatedDuration:0,notificationId:i,status:n.Active,lastDeactivatedTimestamp:null,lastActivatedTimestamp:t}}},468(e,t,i){"use strict";var n,o;i.d(t,{Q:()=>n}),(o=n||(n={})).ServiceWorker="ServiceWorker",o.Host="Host"},934(e,t,i){"use strict";i.d(t,{H4:()=>$,ZP:()=>b});var n,o=i(655),s=i(680),r=i(894),a=i(50),l=i(107);class d{constructor(){this.lastKnownOptedIn=!0}}class c{}class u{serialize(){return{deviceId:this.deviceId,subscriptionToken:this.subscriptionToken,optedOut:this.optedOut,createdAt:this.createdAt,expirationTime:this.expirationTime}}static deserialize(e){let t=new u;return t.deviceId=e.deviceId,t.subscriptionToken=e.subscriptionToken,t.optedOut=e.optedOut,t.createdAt=e.createdAt,t.expirationTime=e.expirationTime,t}}var h,p=i(392);class g{static toDatabase(e){let t=e.notification,i=e.result;return{id:t.notificationId,heading:t.title,content:t.body,data:t.additionalData,url:i.url,rr:t.confirmDelivery,icon:t.icon,image:t.image,tag:t.topic,badge:t.badgeIcon,action:i.actionId,buttons:this.toDatabaseButtons(t.actionButtons),timestamp:e.timestamp}}static toDatabaseButtons(e){return null==e?void 0:e.map(e=>({action:e.actionId,title:e.text,icon:e.icon,url:e.launchURL}))}static fromDatabase(e){return{result:{actionId:e.action,url:e.url},notification:{notificationId:e.id,title:e.heading,body:e.content,additionalData:e.data,launchURL:e.url,confirmDelivery:e.rr,icon:e.icon,image:e.image,topic:e.tag,badgeIcon:e.badge,actionButtons:this.toOSNotificationButtons(e.buttons)},timestamp:e.timestamp}}static toOSNotificationButtons(e){return null==e?void 0:e.map(e=>({actionId:e.action,text:e.title,icon:e.icon,launchURL:e.url}))}}class m{static toDatabase(e,t){return{appId:e,notificationId:t.notification.notificationId,timestamp:t.timestamp}}static fromDatabase(e){return{appId:e.appId,notificationId:e.notificationId,timestamp:e.timestamp}}}class f{static toDatabase(e,t,i){return{appId:e,notificationId:t.notificationId,timestamp:i}}static fromDatabase(e){return{appId:e.appId,notificationId:e.notificationId,timestamp:e.timestamp}}}(n=h||(h={}))[n.SET=0]="SET";let v="Outcomes.NotificationClicked",$="Outcomes.NotificationReceived";class b{constructor(e){this.databaseName=e,this.emitter=new s.Z,this.database=new class e{constructor(e,t=5){this.databaseName=e,this.dbVersion=t,this.emitter=new s.Z}open(e){return new Promise(t=>{let i;try{i=indexedDB.open(e,this.dbVersion)}catch(n){}if(!i)return null;i.onerror=this.onDatabaseOpenError.bind(this),i.onblocked=this.onDatabaseOpenBlocked.bind(this),i.onupgradeneeded=this.onDatabaseUpgradeNeeded.bind(this),i.onsuccess=()=>{this.database=i.result,this.database.onerror=this.onDatabaseError,this.database.onversionchange=this.onDatabaseVersionChange,t(this.database)}})}close(){return(0,o.mG)(this,void 0,void 0,function*(){var e;(yield this.ensureDatabaseOpen()).close(),null===(e=this.database)||void 0===e||e.close()})}ensureDatabaseOpen(){return(0,o.mG)(this,void 0,void 0,function*(){return this.openLock||(this.openLock=this.open(this.databaseName)),yield this.openLock})}onDatabaseOpenError(e){e.preventDefault();let t=e.target.error;a.Z.contains(t.message,"The operation failed for reasons unrelated to the database itself and not covered by any other error code")||a.Z.contains(t.message,"A mutation operation was attempted on a database that did not allow mutations")?l.Z.warn("OneSignal: IndexedDb web storage is not available on this origin since this profile's IndexedDb schema has been upgraded in a newer version of Firefox. See: https://bugzilla.mozilla.org/show_bug.cgi?id=1236557#c6"):l.Z.warn("OneSignal: Fatal error opening IndexedDb database:",t)}onDatabaseError(e){l.Z.debug("IndexedDb: Generic database error",e.target.errorCode)}onDatabaseOpenBlocked(){l.Z.debug("IndexedDb: Blocked event")}onDatabaseVersionChange(e){l.Z.debug("IndexedDb: versionchange event")}onDatabaseUpgradeNeeded(e){l.Z.debug("IndexedDb: Database is being rebuilt or upgraded (upgradeneeded event).");let t=e.target,i=t.transaction;if(!i)throw Error("Can't migrate DB without a transaction");let n=t.result,o=e.newVersion||Number.MAX_SAFE_INTEGER;o>=1&&e.oldVersion<1&&(n.createObjectStore("Ids",{keyPath:"type"}),n.createObjectStore("NotificationOpened",{keyPath:"url"}),n.createObjectStore("Options",{keyPath:"key"})),o>=2&&e.oldVersion<2&&(n.createObjectStore("Sessions",{keyPath:"sessionKey"}),n.createObjectStore("NotificationReceived",{keyPath:"notificationId"}),n.createObjectStore("NotificationClicked",{keyPath:"notificationId"})),o>=3&&e.oldVersion<3&&n.createObjectStore("SentUniqueOutcome",{keyPath:"outcomeName"}),o>=4&&e.oldVersion<4&&(n.createObjectStore(r.Q.Identity,{keyPath:"modelId"}),n.createObjectStore(r.Q.Properties,{keyPath:"modelId"}),n.createObjectStore(r.Q.PushSubscriptions,{keyPath:"modelId"}),n.createObjectStore(r.Q.SmsSubscriptions,{keyPath:"modelId"}),n.createObjectStore(r.Q.EmailSubscriptions,{keyPath:"modelId"})),o>=5&&e.oldVersion<5&&(this.migrateOutcomesNotificationClickedTableForV5(n,i),this.migrateOutcomesNotificationReceivedTableForV5(n,i)),o>=6&&e.oldVersion,"undefined"!=typeof OneSignal&&(OneSignal._isNewVisitor=!0)}migrateOutcomesNotificationClickedTableForV5(e,t){let i="Outcomes.NotificationClicked";e.createObjectStore(i,{keyPath:"notificationId"});let n="NotificationClicked",o=t.objectStore(n).openCursor();o.onsuccess=()=>{if(!o.result)return void e.deleteObjectStore(n);let s=o.result.value;t.objectStore(i).put({notificationId:s.notificationId||s.notification.id,appId:s.appId,timestamp:s.timestamp}),o.result.continue()},o.onerror=()=>{console.error("Could not migrate NotificationClicked records",o.error)}}migrateOutcomesNotificationReceivedTableForV5(e,t){let i="Outcomes.NotificationReceived";e.createObjectStore(i,{keyPath:"notificationId"});let n="NotificationReceived",o=t.objectStore(n).openCursor();o.onsuccess=()=>{o.result?(t.objectStore(i).put(o.result.value),o.result.continue()):e.deleteObjectStore(n)},o.onerror=()=>{console.error("Could not migrate NotificationReceived records",o.error)}}get(e,t){return(0,o.mG)(this,void 0,void 0,function*(){let i=yield this.ensureDatabaseOpen();return t?yield new Promise((n,o)=>{let s=i.transaction(e).objectStore(e).get(t);s.onsuccess=()=>{n(s.result)},s.onerror=()=>{o(s.error)}}):yield new Promise((t,n)=>{let o={},s=i.transaction(e).objectStore(e).openCursor();s.onsuccess=e=>{let i=e.target.result;if(i){let n=i.key;o[n]=i.value,i.continue()}else t(o)},s.onerror=()=>{n(s.error)}})})}getAll(e){return(0,o.mG)(this,void 0,void 0,function*(){let t=yield this.ensureDatabaseOpen();return yield new Promise((i,n)=>{let o=t.transaction(e).objectStore(e).openCursor(),s=[];o.onsuccess=e=>{let t=e.target.result;t?(s.push(t.value),t.continue()):i(s)},o.onerror=()=>{n(o.error)}})})}put(e,t){return(0,o.mG)(this,void 0,void 0,function*(){return yield this.ensureDatabaseOpen(),yield new Promise((i,n)=>{try{let o=this.database.transaction([e],"readwrite").objectStore(e).put(t);o.onsuccess=()=>{i(t)},o.onerror=e=>{l.Z.error("Database PUT Transaction Error:",e),n(e)}}catch(s){l.Z.error("Database PUT Error:",s),n(s)}})})}remove(e,t){return(0,o.mG)(this,void 0,void 0,function*(){let i=yield this.ensureDatabaseOpen();return new Promise((n,o)=>{try{let s=i.transaction([e],"readwrite").objectStore(e),r=t?s.delete(t):s.clear();r.onsuccess=()=>{n(t)},r.onerror=e=>{l.Z.error("Database REMOVE Transaction Error:",e),o(e)}}catch(a){l.Z.error("Database REMOVE Error:",a),o(a)}})})}}(this.databaseName)}static resetInstance(){b.databaseInstance=null}static get singletonInstance(){return b.databaseInstanceName||(b.databaseInstanceName="ONE_SIGNAL_SDK_DB"),b.databaseInstance||(b.databaseInstance=new b(b.databaseInstanceName)),b.databaseInstance}static applyDbResultFilter(e,t,i){switch(e){case"Options":return i&&t?i.value:i&&!t?i:null;case"Ids":return i&&t?i.id:i&&!t?i:null;default:return i||null}}get(e,t){return(0,o.mG)(this,void 0,void 0,function*(){let i=yield this.database.get(e,t);return b.applyDbResultFilter(e,t,i)})}getAll(e){return(0,o.mG)(this,void 0,void 0,function*(){return yield this.database.getAll(e)})}put(e,t){return(0,o.mG)(this,void 0,void 0,function*(){yield new Promise((i,n)=>{this.database.put(e,t).then(()=>i())}),this.emitter.emit(b.EVENTS.SET,t)})}remove(e,t){return this.database.remove(e,t)}getAppConfig(){return(0,o.mG)(this,void 0,void 0,function*(){let e={},t=yield this.get("Ids","appId");return e.appId=t,e.vapidPublicKey=yield this.get("Options","vapidPublicKey"),e})}setAppConfig(e){return(0,o.mG)(this,void 0,void 0,function*(){e.appId&&(yield this.put("Ids",{type:"appId",id:e.appId})),e.vapidPublicKey&&(yield this.put("Options",{key:"vapidPublicKey",value:e.vapidPublicKey}))})}getAppState(){return(0,o.mG)(this,void 0,void 0,function*(){let e=new d;return e.defaultNotificationUrl=yield this.get("Options","defaultUrl"),e.defaultNotificationTitle=yield this.get("Options","defaultTitle"),e.lastKnownPushEnabled=yield this.get("Options","isPushEnabled"),e.pendingNotificationClickEvents=yield this.getAllPendingNotificationClickEvents(),e.lastKnownPushId=yield this.get("Options","lastPushId"),e.lastKnownPushToken=yield this.get("Options","lastPushToken"),e.lastKnownOptedIn=yield this.get("Options","lastOptedIn"),e})}setIsPushEnabled(e){return(0,o.mG)(this,void 0,void 0,function*(){yield this.put("Options",{key:"isPushEnabled",value:e})})}setAppState(e){return(0,o.mG)(this,void 0,void 0,function*(){if(e.defaultNotificationUrl&&(yield this.put("Options",{key:"defaultUrl",value:e.defaultNotificationUrl})),(e.defaultNotificationTitle||""===e.defaultNotificationTitle)&&(yield this.put("Options",{key:"defaultTitle",value:e.defaultNotificationTitle})),null!=e.lastKnownPushEnabled&&(yield this.setIsPushEnabled(e.lastKnownPushEnabled)),null!=e.lastKnownPushId&&(yield this.put("Options",{key:"lastPushId",value:e.lastKnownPushId})),null!=e.lastKnownPushToken&&(yield this.put("Options",{key:"lastPushToken",value:e.lastKnownPushToken})),null!=e.lastKnownOptedIn&&(yield this.put("Options",{key:"lastOptedIn",value:e.lastKnownOptedIn})),e.pendingNotificationClickEvents){let t=Object.keys(e.pendingNotificationClickEvents);for(let i of t){let n=e.pendingNotificationClickEvents[i];n?yield this.put("NotificationOpened",{url:i,data:n.data,timestamp:n.timestamp}):null===n&&(yield this.remove("NotificationOpened",i))}}})}getUserState(){return(0,o.mG)(this,void 0,void 0,function*(){let e=new c;return e.previousOneSignalId="",e.previousExternalId="",e.previousOneSignalId=yield this.get("Options","previousOneSignalId"),e.previousExternalId=yield this.get("Options","previousExternalId"),e})}setUserState(e){return(0,o.mG)(this,void 0,void 0,function*(){yield this.put("Options",{key:"previousOneSignalId",value:e.previousOneSignalId}),yield this.put("Options",{key:"previousExternalId",value:e.previousExternalId})})}getSubscription(){return(0,o.mG)(this,void 0,void 0,function*(){let e=new u;e.deviceId=yield this.get("Ids","userId"),e.subscriptionToken=yield this.get("Ids","registrationId");let t=yield this.get("Options","optedOut"),i=yield this.get("Options","subscription"),n=yield this.get("Options","subscriptionCreatedAt"),o=yield this.get("Options","subscriptionExpirationTime");return e.optedOut=null!=t?t:null!=i&&!i,e.createdAt=n,e.expirationTime=o,e})}setDeviceId(e){return(0,o.mG)(this,void 0,void 0,function*(){yield this.put("Ids",{type:"userId",id:e})})}setSubscription(e){return(0,o.mG)(this,void 0,void 0,function*(){e.deviceId&&(yield this.setDeviceId(e.deviceId)),void 0!==e.subscriptionToken&&(yield this.put("Ids",{type:"registrationId",id:e.subscriptionToken})),null!=e.optedOut&&(yield this.put("Options",{key:"optedOut",value:e.optedOut})),null!=e.createdAt&&(yield this.put("Options",{key:"subscriptionCreatedAt",value:e.createdAt})),null!=e.expirationTime?yield this.put("Options",{key:"subscriptionExpirationTime",value:e.expirationTime}):yield this.remove("Options","subscriptionExpirationTime")})}setJWTToken(e){return(0,o.mG)(this,void 0,void 0,function*(){yield this.put("Ids",{type:"jwtToken",id:e})})}getJWTToken(){return(0,o.mG)(this,void 0,void 0,function*(){return yield this.get("Ids","jwtToken")})}setProvideUserConsent(e){return(0,o.mG)(this,void 0,void 0,function*(){yield this.put("Options",{key:"userConsent",value:e})})}getConsentGiven(){return(0,o.mG)(this,void 0,void 0,function*(){return yield this.get("Options","userConsent")})}getSession(e){return(0,o.mG)(this,void 0,void 0,function*(){return yield this.get("Sessions",e)})}setSession(e){return(0,o.mG)(this,void 0,void 0,function*(){yield this.put("Sessions",e)})}removeSession(e){return(0,o.mG)(this,void 0,void 0,function*(){yield this.remove("Sessions",e)})}getLastNotificationClickedForOutcomes(e){return(0,o.mG)(this,void 0,void 0,function*(){let t=[];try{t=yield this.getAllNotificationClickedForOutcomes()}catch(i){l.Z.error("Database.getLastNotificationClickedForOutcomes",i)}return t.find(t=>t.appId===e)||null})}getAllNotificationClickedForOutcomes(){return(0,o.mG)(this,void 0,void 0,function*(){return(yield this.getAll(v)).map(e=>m.fromDatabase(e))})}putNotificationClickedForOutcomes(e,t){return(0,o.mG)(this,void 0,void 0,function*(){yield this.put(v,m.toDatabase(e,t))})}putNotificationClickedEventPendingUrlOpening(e){return(0,o.mG)(this,void 0,void 0,function*(){yield this.put("NotificationOpened",g.toDatabase(e))})}getAllPendingNotificationClickEvents(){return(0,o.mG)(this,void 0,void 0,function*(){let e={},t=yield this.getAll("NotificationOpened");for(let i of t){let n=g.fromDatabase(i),o=n.result.url;o&&(e[o]=n)}return e})}removeAllNotificationClickedForOutcomes(){return(0,o.mG)(this,void 0,void 0,function*(){yield this.remove(v)})}getAllNotificationReceivedForOutcomes(){return(0,o.mG)(this,void 0,void 0,function*(){return(yield this.getAll($)).map(e=>f.fromDatabase(e))})}putNotificationReceivedForOutcomes(e,t){return(0,o.mG)(this,void 0,void 0,function*(){yield this.put($,f.toDatabase(e,t,(new Date).getTime()))})}resetSentUniqueOutcomes(){return(0,o.mG)(this,void 0,void 0,function*(){let e=(yield this.getAll("SentUniqueOutcome")).map(e=>(e.sentDuringSession=null,b.put("SentUniqueOutcome",e)));yield Promise.all(e)})}static rebuild(){return(0,o.mG)(this,void 0,void 0,function*(){return Promise.all([b.singletonInstance.remove("Ids"),b.singletonInstance.remove("NotificationOpened"),b.singletonInstance.remove("Options"),b.singletonInstance.remove($),b.singletonInstance.remove(v),b.singletonInstance.remove("SentUniqueOutcome")])})}static on(...e){return(0,o.mG)(this,void 0,void 0,function*(){return b.singletonInstance.emitter.on.apply(b.singletonInstance.emitter,e)})}static setIsPushEnabled(e){return(0,o.mG)(this,void 0,void 0,function*(){return b.singletonInstance.setIsPushEnabled(e)})}static getCurrentSession(){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.getSession(p.Ky)})}static upsertSession(e){return(0,o.mG)(this,void 0,void 0,function*(){yield b.singletonInstance.setSession(e)})}static cleanupCurrentSession(){return(0,o.mG)(this,void 0,void 0,function*(){yield b.singletonInstance.removeSession(p.Ky)})}static setSubscription(e){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.setSubscription(e)})}static getSubscription(){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.getSubscription()})}static setJWTToken(e){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.setJWTToken(e)})}static getJWTToken(){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.getJWTToken()})}static setConsentGiven(e){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.setProvideUserConsent(e)})}static getConsentGiven(){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.getConsentGiven()})}static setAppState(e){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.setAppState(e)})}static getAppState(){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.getAppState()})}static setUserState(e){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.setUserState(e)})}static getUserState(){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.getUserState()})}static setAppConfig(e){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.setAppConfig(e)})}static getAppConfig(){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.getAppConfig()})}static getLastNotificationClickedForOutcomes(e){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.getLastNotificationClickedForOutcomes(e)})}static removeAllNotificationClickedForOutcomes(){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.removeAllNotificationClickedForOutcomes()})}static getAllNotificationReceivedForOutcomes(){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.getAllNotificationReceivedForOutcomes()})}static putNotificationReceivedForOutcomes(e,t){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.putNotificationReceivedForOutcomes(e,t)})}static getAllNotificationClickedForOutcomes(){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.getAllNotificationClickedForOutcomes()})}static putNotificationClickedForOutcomes(e,t){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.putNotificationClickedForOutcomes(e,t)})}static putNotificationClickedEventPendingUrlOpening(e){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.putNotificationClickedEventPendingUrlOpening(e)})}static resetSentUniqueOutcomes(){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.resetSentUniqueOutcomes()})}static setDeviceId(e){return(0,o.mG)(this,void 0,void 0,function*(){yield b.singletonInstance.setDeviceId(e)})}static remove(e,t){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.remove(e,t)})}static put(e,t){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.put(e,t)})}static get(e,t){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.get(e,t)})}static getAll(e){return(0,o.mG)(this,void 0,void 0,function*(){return yield b.singletonInstance.getAll(e)})}}b.EVENTS=h},644(e,t,i){"use strict";i.d(t,{Z:()=>d});var n=i(655),o=i(930),s=i(326),r=i(50),a=i(107);let l=["notifyButtonHovering","notifyButtonHover","notifyButtonButtonClick","notifyButtonLauncherClick","animatedElementHiding","animatedElementHidden","animatedElementShowing","animatedElementShown","activeAnimatedElementActivating","activeAnimatedElementActive","activeAnimatedElementInactivating","activeAnimatedElementInactive"];class d{static trigger(e,t,i){return(0,n.mG)(this,void 0,void 0,function*(){if(!r.Z.contains(l,e)){let n=t,d=r.Z.capitalize(s.Z.getWindowEnv().toString());n||!1===n?a.Z.debug(`(${d}) \xbb ${e}:`,n):a.Z.debug(`(${d}) \xbb ${e}`)}if(o.Z.isBrowser()){if(e===OneSignal.EVENTS.SDK_INITIALIZED){if(OneSignal.initialized)return;OneSignal.initialized=!0}i?yield i.emit(e,t):yield OneSignal.emitter.emit(e,t)}})}}},271(e,t,i){"use strict";i.d(t,{Q:()=>d,Z:()=>c});var n=i(470),o=i.n(n),s=i(930),r=i(50),a=i(107),l=i(450);class d{static getBaseUrl(){return location.origin}static isLocalhostAllowedAsSecureOrigin(){return OneSignal.config&&OneSignal.config.userConfig&&!0===OneSignal.config.userConfig.allowLocalhostAsSecureOrigin}static redetectBrowserUserAgent(){return""===(0,l.M)().name&&""===(0,l.M)().version?o()._detect(navigator.userAgent):o()}static isValidUuid(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/.test(e)}static getRandomUuid(){let e="undefined"==typeof window?i.g.crypto:window.crypto||window.msCrypto;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let i=e.getRandomValues(new Uint8Array(1))[0]%16|0;return("x"==t?i:3&i|8).toString(16)})}static logMethodCall(e,...t){return a.Z.debug(`Called ${e}(${t.map(r.c.stringify).join(", ")})`)}static isSafari(){return s.Z.isBrowser()&&void 0!==window.safari}}let c=d},985(e,t,i){"use strict";i.d(t,{Q:()=>r});var n=i(655),o=i(934),s=i(644);class r{static triggerNotificationPermissionChanged(e=!1){return(0,n.mG)(this,void 0,void 0,function*(){if(!r.executing){r.executing=!0;try{yield r.privateTriggerNotificationPermissionChanged(e)}finally{r.executing=!1}}})}static privateTriggerNotificationPermissionChanged(e){return(0,n.mG)(this,void 0,void 0,function*(){let t=yield OneSignal.context.permissionManager.getPermissionStatus(),i=yield o.ZP.get("Options","notificationPermission");(t!==i||e)&&(yield o.ZP.put("Options",{key:"notificationPermission",value:t}),s.Z.trigger(OneSignal.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_STRING,t),this.triggerBooleanPermissionChangeEvent(i,t,e))})}static triggerBooleanPermissionChangeEvent(e,t,i){let n="granted"===t;(n!==("granted"===e)||i)&&s.Z.trigger(OneSignal.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_BOOLEAN,n)}}r.executing=!1},450(e,t,i){"use strict";i.d(t,{M:()=>o});var n=i(470);function o(){return{mobile:n.mobile,tablet:n.tablet,name:n.name.toLowerCase(),version:n.version}}},353(e,t,i){"use strict";i.d(t,{BH:()=>$,ER:()=>E,IH:()=>function e(t,i,n,o=!1){var s;if(i||a.Z.error("Cannot call on() with no event: ",i),n||a.Z.error("Cannot call on() with no task: ",n),"string"==typeof t){let r=document.querySelectorAll(t);if(r.length>0)for(let l=0;l<r.length;l++)e(r[l],i,n)}else if(s=t,"[object Array]"===Object.prototype.toString.call(s))for(let d=0;d<t.length;d++)e(t[d],i,n);else{if("object"!=typeof t)throw Error(`${t} must be a CSS selector string or DOM Element object.`);{let c=function(e){let i=function(){t.removeEventListener(e.type,c)};o||i(),n(e,i)};t.addEventListener(i,c)}}},IM:()=>m,IV:()=>h,JX:()=>c,Ld:()=>S,S6:()=>P,TP:()=>I,Uj:()=>b,bF:()=>v,bJ:()=>u,gd:()=>O,gw:()=>y,iJ:()=>C,jI:()=>f,p$:()=>T,r3:()=>w,tI:()=>p,tf:()=>d,vV:()=>g});var n=i(655),o=(i(326),i(468),i(271)),s=i(985),r=i(50),a=i(107),l=i(450);function d(e){let t=document.querySelectorAll(e);if(t.length>0)for(let i=0;i<t.length;i++){let n=t[i].parentNode;n&&n.removeChild(t[i])}}function c(){return(0,n.mG)(this,void 0,void 0,function*(){return new Promise(e=>{OneSignal.initialized?e():OneSignal.emitter.once(OneSignal.EVENTS.SDK_INITIALIZED,e)})})}function u(e=!1){return(0,n.mG)(this,void 0,void 0,function*(){return s.Q.triggerNotificationPermissionChanged(e)})}function h(e,...t){if(e)return e.apply(null,t)}function p(e,...t){return o.Q.logMethodCall(e,...t)}function g(e){return!!e&&!!e.match(/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/)}function m(e,t,i){let n;if(!(n="string"==typeof e?document.querySelector(e):e))throw Error(`${e} must be a CSS selector string or DOM Element object.`);n.insertAdjacentHTML(t,i)}function f(e){if("string"==typeof e){let t=document.querySelector(e);if(null===t)throw Error(`Cannot find element with selector "${e}"`);for(;t.firstChild;)t.removeChild(t.firstChild)}else{if("object"!=typeof e)throw Error(`${e} must be a CSS selector string or DOM Element object.`);for(;e.firstChild;)e.removeChild(e.firstChild)}}function v(e,t){if("string"==typeof e){let i=document.querySelector(e);if(null===i)throw Error(`Cannot find element with selector "${e}"`);i.classList.add(t)}else{if("object"!=typeof e)throw Error(`${e} must be a CSS selector string or DOM Element object.`);e.classList.add(t)}}function $(e,t){if("string"==typeof e){let i=document.querySelector(e);if(null===i)throw Error(`Cannot find element with selector "${e}"`);i.classList.remove(t)}else{if("object"!=typeof e)throw Error(`${e} must be a CSS selector string or DOM Element object.`);e.classList.remove(t)}}function b(e,t){if("string"==typeof e){let i=document.querySelector(e);if(null===i)throw Error(`Cannot find element with selector "${e}"`);return i.classList.contains(t)}if("object"==typeof e)return e.classList.contains(t);throw Error(`${e} must be a CSS selector string or DOM Element object.`)}function y(e){return new Promise(t=>{setTimeout(t,e)})}function S(){return Promise.resolve()}function w(e,t){return r.c.contains(e,t)}function I(e){return o.Q.isValidUuid(e)}function C(){return window.__oneSignalSdkLoadCount||0}function E(){window.__oneSignalSdkLoadCount=C()+1}function P(e){return e?"safari"==(0,l.M)().name&&e.safari?e.safari:"firefox"===(0,l.M)().name&&e.firefox?e.firefox:e.chrome||e.firefox||e.safari||"default-icon":"default-icon"}function O(e){let t=document.querySelector(e);return t||(a.Z.debug(`No instance of ${e} found. Returning stub.`),document.createElement("div"))}function T(e){return JSON.parse(JSON.stringify(e))}},655(e,t,i){"use strict";function n(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)0>t.indexOf(n[o])&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i}function o(e,t,i,n){return new(i||(i=Promise))(function(o,s){function r(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(r,a)}l((n=n.apply(e,t||[])).next())})}i.d(t,{_T:()=>n,mG:()=>o})}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.amdD=function(){throw Error("define cannot be used indirect")},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=i(353),t=i(107),n=i(608);class o{static processOneSignalDeferredArray(e){for(let i of e)try{n.Z.push(i)}catch(o){t.Z.error(o)}}}!function(){if((0,e.ER)(),(0,e.iJ)()>1)return t.Z.warn("OneSignal: The web push SDK is included more than once. For optimal performance, please include our SDK only once on your page."),void t.Z.debug(`OneSignal: Exiting from SDK initialization to prevent double-initialization errors. Occurred ${(0,e.iJ)()} times.`);window.OneSignal=i(608).Z;let n=window.OneSignalDeferred;window.OneSignalDeferred=i(191).Z,o.processOneSignalDeferredArray(n)}()})()})();